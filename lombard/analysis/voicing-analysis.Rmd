---
title: "Pilot study of Lombard voicing"
author: "Stefano Coretta"
date: "20/09/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = normalizePath("../../"))
library(tidyverse)
theme_set(theme_minimal())
library(speakr)
library(lme4)
library(lmerTest)
library(effects)
```

```{r speakr}
lmt("./lombard/code/get-measurements.praat.md")
praat_run("./lombard/code/get-measurements.praat")
```

```{r read-data}
stimuli <- read_csv("./lombard/task/prompts.csv")

acoustics <- read_csv("./lombard/results/acoustics.csv", na = "--undefined--") %>%
    left_join(y = stimuli)

durations <- read_csv("./lombard/results/durations.csv", na = "--undefined--") %>%
    left_join(y = stimuli) %>%
    mutate_if(is.character, as.factor) %>%
    mutate(
        voicing = factor(voicing, levels = c("voiceless", "voiced")),
        position = factor(position, levels = c("medial", "final")),
        place = factor(place, levels = c("velar", "coronal", "labial"))
    )
```


```{r vowel-duration-speaker-plot}
durations %>%
    ggplot(aes(voicing, vowel_duration, colour = position)) +
    geom_boxplot() +
    facet_grid(speaker ~ vowel)
```

```{r vowel-duration-plot}
durations %>%
    ggplot(aes(voicing, vowel_duration, colour = position)) +
    geom_boxplot() +
    facet_grid( ~ vowel)
```

```{r duration-plot}
durations %>%
    ggplot(aes(position, vowel_duration, colour = voicing)) +
    geom_boxplot()
```

```{r duration-lmer}
vowel_dur_lm <- lmer(
    vowel_duration ~
        voicing *
        position +
        manner +
        place +
        (1|speaker) +
        (1|word),
    data = durations
)

summary(vowel_dur_lm)

vowel_dur_lm_null <- lmer(
    vowel_duration ~
        voicing *
#        position +
        manner +
        place +
        (1|speaker) +
        (1|word),
    data = durations
)

anova(vowel_dur_lm_null, vowel_dur_lm)
```

```{r duration-lmer-effects}
plot(allEffects(vowel_dur_lm))
```

```{r c-duration-plot}
durations %>%
    ggplot(aes(position, consonant_duration, colour = voicing)) +
    geom_boxplot()
```

```{r}
durations %>%
    ggplot(aes(consonant_duration, vowel_duration, colour = voicing)) +
    geom_point() +
    geom_smooth(method = "lm") +
    facet_grid(position ~ .)
```


```{r}
acoustics %>%
    ggplot(aes(point, f1, colour = voicing)) +
    geom_jitter(alpha = 0.5) +
    geom_smooth() +
    facet_wrap(~ vowel)
```

```{r}
acoustics %>%
    ggplot(aes(time_norm, f1, colour = voicing)) +
    geom_point(alpha = 0.5) +
    geom_smooth() +
    facet_wrap(~ vowel)
```

```{r}
acoustics %>%
    ggplot(aes(point, f2, colour = voicing)) +
    geom_jitter(alpha = 0.5) +
    geom_smooth() +
    facet_wrap(~ vowel)
```

```{r}
acoustics %>%
    filter(pitch < 400) %>%
    ggplot(aes(point, pitch, colour = voicing)) +
    geom_jitter(alpha = 0.5) +
    geom_smooth() +
    facet_wrap(~ vowel)
```
