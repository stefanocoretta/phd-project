---
title: "Voicing duration and vowel height"
author: "Stefano Coretta"
date: "13/11/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = normalizePath("../"))
library(tidyverse)
theme_set(theme_minimal())
library(coretta2018itaegg)
library(lme4)
library(lmerTest)
library(sjPlot)

scale_fill_discrete <- function(...) scale_fill_brewer(..., type = "qual")
scale_colour_discrete <- function(...) scale_fill_brewer(..., type = "qual")

data("ita_egg")
ita_egg <- ita_egg %>%
  mutate(
    vowel = factor(vowel, levels = c("a", "o", "e", "i", "u")),
    height = factor(height, levels = c("low", "mid-low", "mid-high", "high")),
    vofft = (voice_off - c1_rel) * 1000
  ) %>%
  mutate_if(is.character, as.factor)
```

# Data checks

```{r glimpse}
glimpse(ita_egg)
```

There are a total of 3268 observations (172 sentences * 19 speakers).
Measurements from 15 tokens have not been taken because they contained speech errors/disfluencies.
Depending on the specific measurement, there is from 5% to 20% of missing data.

```{r voi-dur}
ita_egg %>%
  ggplot(aes(voice_duration)) +
  geom_density() +
  geom_rug()
```

```{r voi-dur-box}
ita_egg %>%
  ggplot(aes(y = voice_duration)) +
  geom_boxplot() +
  coord_flip() +
  scale_x_continuous(labels = NULL)
```

```{r vow-dur}
ita_egg %>%
  ggplot(aes(v1_duration)) +
  geom_density() +
  geom_rug()
```

```{r vow-dur-box}
ita_egg %>%
  ggplot(aes(y = v1_duration)) +
  geom_boxplot() +
  coord_flip() +
  scale_x_continuous(labels = NULL)
```

```{r speech-rate}
ita_egg %>%
  ggplot(aes(speech_rate)) +
  geom_density() +
  geom_rug()
```

```{r speech-rate-box}
ita_egg %>%
  ggplot(aes(y = speech_rate)) +
  geom_boxplot() +
  coord_flip() +
  scale_x_continuous(labels = NULL)
```

```{r sent-dur}
ita_egg %>%
  ggplot(aes(sent_duration)) +
  geom_density() +
  geom_rug()
```

# Plots

```{r vow-sent-dur}
ita_egg %>%
  ggplot(aes(v1_duration, voice_duration)) +
  geom_point(alpha = 0.2)
```

```{r vow-sent-dur-2}
ita_egg %>%
  ggplot(aes(v1_duration, voice_duration)) +
  geom_point(alpha = 0.1) +
  geom_smooth(method = "lm") +
  coord_fixed()
```

Vowel duration and voicing duration are clearly correlated.

```{r vow-height}
ita_egg %>%
  ggplot(aes(v1_duration, fill = height)) +
  geom_density(alpha = 0.5, size = 0) +
  geom_rug(alpha = 0.1)
```

```{r vow-height-box}
ita_egg %>%
  ggplot(aes(height, v1_duration, fill = height)) +
  geom_boxplot()
```

```{r vow-height-box}
ita_egg %>%
  ggplot(aes(vowel, v1_duration, fill = height)) +
  geom_boxplot()
```

```{r voi-height}
ita_egg %>%
  ggplot(aes(voice_duration, fill = height)) +
  geom_density(alpha = 0.5, size = 0) +
  geom_rug(alpha = 0.1)
```

```{r voi-height-box}
ita_egg %>%
  ggplot(aes(height, voice_duration, fill = height)) +
  geom_boxplot()
```

```{r voi-vow-box}
ita_egg %>%
  ggplot(aes(vowel, voice_duration, fill = height)) +
  geom_boxplot()
```

```{r vot-height}
ita_egg %>%
  ggplot(aes(vot, fill = height)) +
  geom_density(alpha = 0.5, size = 0) +
  geom_rug(alpha = 0.1)
```

```{r vot-height-box}
ita_egg %>%
  ggplot(aes(height, vot, fill = height)) +
  geom_boxplot()
```

```{r}
ita_egg %>%
  ggplot(aes(c2_place, c2_clos_duration)) +
  geom_boxplot()
```


# Modelling

## Hypothesis testing

**Note**: Centered speech rate has been used instead of uncentered (in pre-registration I use uncentered).

### Voicing duration

```{r voice-lm}
voice_lm_1 <- lme4::lmer(
  voice_duration ~
    height +
    c2_place +
    speech_rate_c +
    (1+height|speaker) +
    (1|word),
  data = ita_egg,
  REML = FALSE
)

voice_lm_0 <- lme4::lmer(
  voice_duration ~
    # height +
    c2_place +
    speech_rate_c +
    (1+height|speaker) +
    (1|word),
  data = ita_egg,
  REML = FALSE
)
```

```{r voice-lm-bf}
bf_01 <- exp((BIC(voice_lm_1) - BIC(voice_lm_0)) / 2)
bf_01
1/bf_01
```

```{r voice-lm-sum}
summary(voice_lm_1)
```

```{r plot-voice-lm-1}
plot_model(voice_lm_1, show.values = TRUE, value.offset = .3, show.p = FALSE, order.terms = c(1:6))
```

### Vowel duration

```{r vowel-lm}
vowel_lm <- lmer(
  v1_duration ~
    height +
    c2_place +
    height:c2_place +
    speech_rate_c +
    (1|speaker) +
    (1|word),
  data = ita_egg,
  control = lmerControl(optimizer = "Nelder_Mead")
)
# https://stats.stackexchange.com/a/243225/128897

summary(vowel_lm)
```

```{r plot-vowel-lm}
plot_model(vowel_lm, show.values = TRUE, value.offset = .3, show.p = FALSE, order.terms = c(1:12))
```

Relative to the duration of low vowels (/a/), mid-low vowels are 13 ms shorter, mid-high vowels (/e/) are 18.5 ms shorter, and high vowels (/i/, /u/) are 32 ms shorter.
In comparison, voicing in mid-low vowels is 3.5, in mid-high vowels is 16.5 ms shorter, and it is 27 ms shorter in high vowels.
Low vowels are 98 ms long and voicing in low vowels is 126 ms.
There's seems to be a small gap in shortnening between vowel and voicing duration (vowel shortening magnitude is slightly greater).
There seems not to be an interaction between height and vowel vs. voicing (the difference between the effect in midh-high and high is around 12 ms in both cases).

### VOT

```{r vot-lm}
vot_lm <- lmer(
  vot ~
    height +
    c1_place +
    height:c1_place +
    speech_rate_c +
    (1|speaker) +
    (1|word),
  data = ita_egg
)
# singularity problem: reduce random structure

summary(vot_lm)
```

```{r vot-lm-plot}
plot_model(vot_lm, type = "pred", terms = "height")
```

### Release to vowel offset

```{r rel-voff-lm}
rel_voff_lm <- lmer(
  rel_voff ~
    height +
    c1_place +
    height:c1_place +
    speech_rate_c +
    (1|speaker) +
    (1|word),
  data = ita_egg
)

summary(rel_voff_lm)
```

## Exploratory

### Voicing duration

```{r voice-lm-2}
voice_lm_2 <- lmer(
  voice_duration ~
    height *
    speech_rate_c +
    (1+height|speaker) +
    (1|word),
  data = ita_egg
)

summary(voice_lm_2)
```

```{r voice-lm-2-plot}
plot_model(voice_lm_2, type = "pred", terms = c("height", "speech_rate_c"))
```

### VOT

```{r vot-lm-2}
vot_lm_2 <- lmer(
  vot ~
    height +
    c1_place +
    # height:c1_place +
    speech_rate_c +
    height:speech_rate_c +
    (1|speaker) +
    (1|word),
  data = ita_egg
)
# singularity problem: reduce random structure

summary(vot_lm_2)
```

```{r vot-lm-2-plot}
plot_model(vot_lm_2, type = "pred", terms = c("height", "speech_rate_c"))
```

```{r vot-lm-3}
vot_lm_3 <- lmer(
  vot ~
    vowel *
    # c2_place +
    # height:c2_place +
    speech_rate_c +
    (1|speaker) +
    (1|word),
  data = ita_egg
)
# singularity problem: reduce random structure

summary(vot_lm_3)
```

### VOffT

```{r vofft-lm}
vofft_lm <- lmer(
  vofft ~
    height +
    c1_place +
    # height:c1_place +
    speech_rate +
    (1+height|speaker) +
    (1|word),
  data = ita_egg
)

summary(vofft_lm)
```
