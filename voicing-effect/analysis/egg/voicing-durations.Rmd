---
title: "Voicing durations"
author: "Stefano Coretta"
date: "02/03/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = normalizePath("../../../"))
library(tidyverse)
theme_set(theme_minimal())
library(lmerTest)
library(effects)
```

# Read data

```{r read-data}
languages <- read_csv("./voicing-effect/data/datasets/speakers.csv")
words <- read_csv("./voicing-effect/data/datasets/stimuli.csv")

voicing <- list.files(
  path = "voicing-effect/data/datasets/egg/",
  pattern = "*-voicing.csv",
  full.names = TRUE
) %>%
  map_df(~read_csv(., na = "--undefined--")) %>%
  left_join(., languages) %>%
  left_join(y = words) %>%
  mutate_if(is.character, as.factor) %>%
  mutate(
    index = as.factor(index)
  )


voicing_voiceless <- filter(voicing, c2phonation == "voiceless", c1phonation == "voiceless")

voicing_norm <- voicing_voiceless %>%
  filter(voicing.duration < 300) %>%
  group_by(speaker) %>%
  mutate(voicing_duration_norm = scale(voicing.duration))
```

# Plots

```{r}
voicing_voiceless %>%
  filter(voicing.duration < 300) %>%
  ggplot(aes(vowel, voicing.duration)) +
  geom_boxplot() +
  facet_wrap(~ speaker)
```

```{r vowel-boxplot}
voicing_voiceless %>%
  filter(voicing.duration < 300) %>%
  ggplot(aes(vowel, voicing.duration)) +
  geom_boxplot()
```

```{r vowel-language-boxplot}
voicing_voiceless %>%
  filter(voicing.duration < 300) %>%
  ggplot(aes(vowel, voicing.duration)) +
  geom_boxplot() +
  facet_grid(~ language)
```

```{r norm-vowel-boxplot}
voicing_norm %>%
  ggplot(aes(vowel, voicing_duration_norm)) +
  geom_boxplot()
```

```{r norm-vowel-language-boxplot}
voicing_norm %>%
  ggplot(aes(vowel, voicing_duration_norm)) +
  geom_boxplot() +
  facet_grid(~ language)
```

# Lmer

```{r voicing-lm}
voicing_lm <- lmer(
  voicing.duration ~
    vowel *
    language +
    (1|speaker) +
    (1|word),
  data = voicing_voiceless
)
summary(voicing_lm)
```

```{r voicing-effect}
plot(allEffects(voicing_lm))
```

