---
title: "Durations"
author: "Stefano Coretta"
date: "09/03/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = normalizePath("../../../"))
library(tidyverse)
theme_set(theme_minimal())
library(lme4)
```

# Data import

```{r}
speakers <- read_csv("./voicing-effect/data/datasets/speakers.csv")
stimuli <- read_csv("./voicing-effect/data/datasets/stimuli.csv")

duration <- list.files(
  path = "voicing-effect/data/datasets/acoustics/",
  pattern = "*-durations.csv",
  full.names = TRUE
) %>%
  map_df(~read_csv(., na = "--undefined--")) %>%
  left_join(y = speakers) %>%
  left_join(y = stimuli) %>%
  filter(c1_phonation == "voiceless") %>%
  mutate(c2_phonation = factor(c2_phonation, levels = c("voiceless", "voiced"))) %>%
  mutate_if(is.character, as.factor)
```

# Plotting data

```{r}
duration %>%
  group_by(speaker) %>%
  mutate(vowel_duration = scale(vowel_duration)) %>%
  ggplot(aes(vowel, vowel_duration)) +
  geom_boxplot() +
  facet_grid(~ language)
```

```{r}
duration %>%
  ggplot(aes(vowel, vowel_duration, fill = c2_phonation)) +
  geom_boxplot() +
  facet_wrap(~ speaker)
```

```{r}
duration %>%
  filter(speaker == "pl05") %>%
  ggplot(aes(vowel, vowel_duration, fill = c2_phonation)) +
  geom_boxplot() +
  facet_grid(~ c2_place)
```

```{r}
duration %>%
  filter(speaker == "pl05") %>%
  ggplot(aes(vowel_duration, fill = c2_phonation)) +
  geom_density(alpha = 0.5, linetype = 0) +
  facet_grid(~ c2_place)
```

```{r}
duration %>%
  ggplot(aes(vowel_duration, colour = c2_phonation, fill = c2_phonation)) +
  geom_density(alpha = 0.5) +
  facet_grid(vowel ~ c2_place)
```

```{r}
duration %>%
  ggplot(aes(vowel, c1_rvot, fill = c2_phonation)) +
  geom_boxplot()
```

```{r}
duration %>%
  ggplot(aes(vowel, c1_closure, fill = c2_phonation)) +
  geom_boxplot()
```

## Closure duration

```{r}
duration %>%
  group_by(speaker) %>%
  mutate(closure_duration = scale(closure_duration)) %>%
  ggplot(aes(vowel, closure_duration)) +
  geom_boxplot()
```


## Release to release

```{r rr-density}
duration %>%
  group_by(speaker) %>%
  mutate(rel_rel = scale(rel_rel)) %>%
  ggplot(aes(rel_rel, fill = c2_phonation, colour = c2_phonation)) +
  geom_density(alpha = 0.5)
```

```{r rr-density-vow-c2_place}
duration %>%
  group_by(speaker) %>%
  mutate(rel_rel = scale(rel_rel)) %>%
  ggplot(aes(rel_rel, fill = c2_phonation, colour = c2_phonation)) +
  geom_density(alpha = 0.5) +
  facet_grid(c2_place ~ vowel)
```

```{r rr-box}
duration %>%
  group_by(speaker) %>%
  mutate(rel_rel = scale(rel_rel)) %>%
  ggplot(aes(vowel, rel_rel, fill = c2_phonation)) +
  geom_boxplot()
```

The Release-Release interval duration does not seem to be affected by the voicing of C2.

## Word durations

```{r word-dur-density}
duration %>%
  ggplot(aes(word_duration, fill = c2_phonation)) +
  geom_density(alpha = 0.5) +
  facet_grid(~ language)
```

```{r word-dur-density}
duration %>%
  group_by(speaker) %>%
  mutate(word_duration_z = scale(word_duration)) %>%
  ggplot(aes(word_duration_z, fill = c2_phonation)) +
  geom_density(alpha = 0.5) +
  facet_grid(~ language)
```

```{r}
duration %>%
  group_by(speaker) %>%
  mutate(word_duration_z = scale(word_duration)) %>%
  ggplot(aes(c2_phonation, word_duration_z, fill = c2_phonation)) +
  geom_boxplot() +
  facet_wrap(~ speaker)
```

```{r}
duration %>%
  group_by(speaker) %>%
  mutate(word_duration_z = scale(word_duration)) %>%
  ggplot(aes(c2_phonation, word_duration_z, fill = c2_phonation)) +
  geom_boxplot() +
  facet_wrap(~ language)
```

# Analysis

```{r}
vowdur_lm <- lmer(
  vowel_duration ~
    c2_phonation +
    language +
    c2_place +
    vowel +
    c2_phonation:vowel +
    language:vowel +
    sentence_duration +
    (1+c2_phonation|speaker) +
    (1|word),
  REML = FALSE,
  data = duration
)
summary(vowdur_lm)
```

```{r}
round(ranef(vowdur_lm)$speaker)
```

