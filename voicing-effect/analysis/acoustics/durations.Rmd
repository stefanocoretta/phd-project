---
title: "Durations"
author: "Stefano Coretta"
date: "09/03/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = normalizePath("../../../"))
library(tidyverse)
theme_set(theme_minimal())
library(lme4)
```

# Data import

```{r}
speakers <- read_csv("./voicing-effect/data/datasets/speakers.csv")
stimuli <- read_csv("./voicing-effect/data/datasets/stimuli.csv")

duration <- list.files(
  path = "voicing-effect/data/datasets/acoustics/",
  pattern = "*-durations.csv",
  full.names = TRUE
) %>%
  map_df(~read_csv(., na = "--undefined--")) %>%
  left_join(y = speakers) %>%
  left_join(y = stimuli) %>%
  mutate(c2_phonation = factor(c2_phonation, levels = c("voiceless", "voiced"))) %>%
  mutate_if(is.character, as.factor)
```

# Plotting data

```{r}
duration %>%
  ggplot(aes(vowel, vowel.duration, fill = c2_phonation)) +
  geom_boxplot() +
  facet_wrap(~ speaker)
```

```{r}
duration %>%
  filter(speaker == "pl05") %>%
  ggplot(aes(vowel, vowel.duration, fill = c2_phonation)) +
  geom_boxplot() +
  facet_grid(~ c2_place)
```

```{r}
duration %>%
  filter(speaker == "pl05") %>%
  ggplot(aes(vowel.duration, fill = c2_phonation)) +
  geom_density(alpha = 0.5, linetype = 0) +
  facet_grid(~ c2_place)
```

```{r}
duration %>%
  ggplot(aes(vowel.duration, colour = c2_phonation, fill = c2_phonation)) +
  geom_density(alpha = 0.5) +
  facet_grid(vowel ~ c2_place)
```

# Analysis

```{r}
vowdur_lm <- lmer(
  vowel_duration ~
    c2_phonation +
    language +
    c2_place +
    vowel +
    c2_phonation:vowel +
    language:vowel +
    sentence_duration +
    (1+c2_phonation|speaker) +
    (1|word),
  REML = FALSE,
  data = duration
)
summary(vowdur_lm)
```

```{r}
round(ranef(vowdur_lm)$speaker)
```

