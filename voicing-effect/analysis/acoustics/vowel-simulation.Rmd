---
title: "Simulating vowel height and F1"
author: "Stefano Coretta"
date: "06/04/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(mvtnorm)
library(ggplot2)
library(effects)
```

# No correlation

## Model 1: categorical F1 and duration, and no correlation within categories

```{r}
a <- rmvnorm(n=5000,mean=c(25,100),sigma=matrix(c(5,0*sqrt(50), 
0*sqrt(50),10),2,2)) %>%
    data.frame() %>%
    mutate(vowel = "a")
o <- rmvnorm(n=5000,mean=c(15,90),sigma=matrix(c(5,0*sqrt(50), 
0*sqrt(50),10),2,2)) %>%
    data.frame() %>%
    mutate(vowel = "o")
u <- rmvnorm(n=5000,mean=c(5,80),sigma=matrix(c(5,0*sqrt(50), 
0*sqrt(50),10),2,2)) %>%
    data.frame() %>%
    mutate(vowel = "u")

vowels.3 <- rbind(a, o, u) %>%
    rename(duration = X1, f1 = X2) %>%
    mutate_if(is.character, as.factor)
```

```{r}
vowels.3 %>%
    ggplot(aes(duration, f1)) +
    geom_point(aes(colour = vowel)) +
    geom_smooth(method = "lm")
```

```{r}
vowels.3.lm <- lm(
    duration ~
        f1 *
        vowel,
    data = vowels.3
)

summary(vowels.3.lm)
```

```{r}
plot(allEffects(vowels.3.lm))
```

# Correlation: stored and physiological duration

## Model 2: categorical F1 and duration, and correlation within categories

```{r}
a <- rmvnorm(n=5000,mean=c(25,100),sigma=matrix(c(5,0.4*sqrt(50), 
0.4*sqrt(50),10),2,2)) %>%
    data.frame() %>%
    mutate(vowel = "a")
o <- rmvnorm(n=5000,mean=c(15,90),sigma=matrix(c(5,0.4*sqrt(50), 
0.4*sqrt(50),10),2,2)) %>%
    data.frame() %>%
    mutate(vowel = "o")
u <- rmvnorm(n=5000,mean=c(5,80),sigma=matrix(c(5,0.4*sqrt(50), 
0.4*sqrt(50),10),2,2)) %>%
    data.frame() %>%
    mutate(vowel = "u")

vowels <- rbind(a, o, u) %>%
    rename(duration = X1, f1 = X2) %>%
    mutate_if(is.character, as.factor)
```

```{r}
vowels %>%
    ggplot(aes(duration, f1)) +
    geom_point(aes(colour = vowel)) +
    geom_smooth(method = "lm")
```

```{r}
vowels.lm <- lm(
    duration ~
        f1 *
        vowel,
    data = vowels
)

summary(vowels.lm)
```

```{r}
plot(allEffects(vowels.lm))
```

```{r}
vowels.lm <- lm(
    duration ~
        f1,
    data = filter(vowels, vowel == "u")
)

summary(vowels.lm)
```

## Model 3: categorical F1 and correlated duration across F1

```{r}
n     <- 15000                    # length of vector
rho   <- 0.6                   # desired correlation = cos(angle)
theta <- acos(rho)             # corresponding angle
x1    <- c(rnorm(5000, 100, 5), rnorm(5000, 90, 5), rnorm(5000, 80, 5))        # fixed given data
x2    <- rnorm(n, 2, 0.5)      # new random data
X     <- cbind(x1, x2)         # matrix
Xctr  <- scale(X, center=TRUE, scale=FALSE)   # centered columns (mean 0)

Id   <- diag(n)                               # identity matrix
Q    <- qr.Q(qr(Xctr[ , 1, drop=FALSE]))      # QR-decomposition, just matrix Q
P    <- tcrossprod(Q)          # = Q Q'       # projection onto space defined by x1
x2o  <- (Id-P) %*% Xctr[ , 2]                 # x2ctr made orthogonal to x1ctr
Xc2  <- cbind(Xctr[ , 1], x2o)                # bind to matrix
Y    <- Xc2 %*% diag(1/sqrt(colSums(Xc2^2)))  # scale columns to length 1

x <- Y[ , 2] + (1 / tan(theta)) * Y[ , 1]     # final new vector
cor(x1, x)
X3 <- rep(c("a", "o", "u"), each = 5000)
vowels.2 <- data.frame(x1, x, X3) %>%
    rename(f1 = x1, duration = x, vowel = X3)
```

```{r}
vowels.2 %>%
    ggplot(aes(duration, f1)) +
    geom_point(aes(colour = vowel)) +
    geom_smooth(method = "lm")
```

```{r}
vowels.2.lm <- lm(
    duration ~
        f1 *
        vowel,
    data = vowels.2
)

summary(vowels.2.lm)
```

```{r}
plot(allEffects(vowels.2.lm))
```

```{r}
vowels.2.lm <- lm(
    duration ~
        f1,
    data = filter(vowels.2, vowel == "u")
)

summary(vowels.2.lm)
```

# Discussion

The results so far are inconclusive. The problem now is differentiating between Model 2 and Model 3. 
