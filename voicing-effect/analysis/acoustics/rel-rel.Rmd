---
title: "Release to release"
author: "Stefano Coretta"
date: "15/11/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = normalizePath("../../../"))
library(tidyverse)
library(brms)
library(bayesplot)
library(coretta2018itapol)
data("token_measures")

token_measures <- token_measures %>%
  filter(c1_phonation == "voiceless") %>%
  mutate(
    rel_rel = (c2_rel - c1_rel) * 1000,
    c2_phonation = factor(c2_phonation, levels = c("voiceless", "voiced"))
  ) %>%
  na.omit()
```

```{r rr-bm}
priors <- c(
  set_prior("normal(200, 50)", class = "Intercept"),
  set_prior("normal(0, 50)", class = "b", coef = "c2_phonationvoiced"),
  set_prior("normal(0, 50)", class = "b", coef = "vowelo"),
  set_prior("normal(0, 50)", class = "b", coef = "vowelu"),
  set_prior("normal(0, 50)", class = "b", coef = "c2_placevelar"),
  set_prior("normal(0, 100)", class = "b", coef = "speech_rate_c"),
  set_prior("normal(0, 100)", class = "sd"),
  set_prior("cauchy(0, 50)", class = "sigma")
)

rr_mb <- brm(
  rel_rel ~
    c2_phonation +
    vowel +
    c2_place +
    speech_rate_c +
    (1|speaker) +
    (1|item),
  data = token_measures,
  prior = priors,
  cores = 4,
  seed = 8788
)
```

```{r rr-bm-summary}
summary(rr_mb)
```

```{r rr-bm-intervals}
mcmc_intervals(as.array(rr_mb), pars = c("b_c2_phonationvoiced", "b_vowelo", "b_vowelu", "b_c2_placevelar", "b_speech_rate_c"))
```

```{r rr-bm-2}
priors_2 <- c(
  set_prior("normal(200, 50)", class = "Intercept"),
  set_prior("normal(0, 50)", class = "b", coef = "c2_phonationvoiced"),
  set_prior("normal(0, 50)", class = "b", coef = "vowelo"),
  set_prior("normal(0, 50)", class = "b", coef = "vowelu"),
  set_prior("normal(0, 50)", class = "b", coef = "c2_placevelar"),
  set_prior("normal(0, 20)", class = "b", coef = "c2_phonationvoiced:vowelo"),
  set_prior("normal(0, 20)", class = "b", coef = "c2_phonationvoiced:vowelu"),
  set_prior("normal(0, 20)", class = "b", coef = "c2_phonationvoiced:c2_placevelar"),
  set_prior("normal(0, 20)", class = "b", coef = "c2_phonationvoiced:vowelo:c2_placevelar"),
  set_prior("normal(0, 20)", class = "b", coef = "c2_phonationvoiced:vowelu:c2_placevelar"),
  set_prior("normal(0, 100)", class = "b", coef = "speech_rate_c"),
  set_prior("normal(0, 100)", class = "sd"),
  set_prior("cauchy(0, 50)", class = "sigma")
)

rr_bm_2 <- brm(
  rel_rel ~
    c2_phonation *
    vowel *
    c2_place +
    speech_rate_c +
    (1|speaker) +
    (1|item),
  data = token_measures,
  prior = priors_2,
  cores = 4,
  seed = 8788
)
```

```{r rr-bm-2-summary}
summary(rr_bm_2)
```

```{r rr-bm-2-intervals}
mcmc_intervals(as.array(rr_bm_2), pars = c("b_c2_phonationvoiced", "b_vowelo", "b_vowelu", "b_c2_placevelar", "b_speech_rate_c"))
```

```{r rr-bm-2-intervals-1}
mcmc_intervals(as.array(rr_bm_2), pars = c("b_c2_phonationvoiced"), prob = 0.6)
```

```{r rr-bm-2-intervals-2}
mcmc_intervals(as.array(rr_bm_2), pars = c("b_c2_phonationvoiced:vowelo", "b_c2_phonationvoiced:vowelu", "b_c2_phonationvoiced:c2_placevelar", "b_c2_phonationvoiced:vowelo:c2_placevelar", "b_c2_phonationvoiced:vowelu:c2_placevelar"))
```

```{r rr-bm-2-pp-check}
pp_check(rr_bm_2, nsamples = 100)
```

