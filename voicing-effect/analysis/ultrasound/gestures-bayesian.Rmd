---
title: "Bayesial modelling of gestures"
author: "Stefano Coretta"
date: "16/11/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = normalizePath("../../../"))

library(tidyverse)
scale_fill_discrete <- function(...) scale_fill_brewer(..., type = "qual")
scale_colour_discrete <- function(...) scale_colour_brewer(..., type = "qual")
library(brms)
library(bayesplot)

library(coretta2018itapol)
data("token_measures")

gestures <- token_measures %>%
  mutate(
    syl_rate_c = syl_rate - mean(syl_rate),
    c2_phonation = factor(c2_phonation, levels = c("voiceless", "voiced")),
    c2_place = factor(c2_place, levels = c("coronal", "velar")),
    vowel = factor(vowel, levels = c("a", "o", "u"))
  ) %>%
  mutate_if(is_character, as_factor)
```

# GONS to MAX

```{r gons-max-bm}
priors <- c(
  set_prior("normal(150, 50)", class = "Intercept"),
  set_prior("normal(0, 10)", class = "b", coef = "c2_phonationvoiced"),
  set_prior("normal(0, 10)", class = "b", coef = "vowelo"),
  set_prior("normal(0, 10)", class = "b", coef = "vowelu"),
  set_prior("normal(0, 10)", class = "b", coef = "c2_placevelar"),
  set_prior("normal(0, 10)", class = "b", coef = "c2_phonationvoiced:vowelo"),
  set_prior("normal(0, 10)", class = "b", coef = "c2_phonationvoiced:vowelu"),
  set_prior("normal(0, 10)", class = "b", coef = "c2_phonationvoiced:c2_placevelar"),
  set_prior("normal(0, 50)", class = "b", coef = "syl_rate_c"),
  set_prior("normal(0,200)", class = "sd"),
  set_prior("normal(0,50)", class = "sigma")
)

gons_max_bm <- brm(
  gons_max ~
    c2_phonation +
    c2_place +
    vowel +
    c2_phonation:c2_place +
    c2_phonation:vowel +
    syl_rate_c +
    (1|speaker) +
    (1|item),
  prior = priors,
  data = gestures,
  cores = 2
)
```

```{r gons-max-summary}
summary(gons_max_bm)
```

```{r gos-max-intervals}
mcmc_intervals(as.array(gons_max_bm), pars = c("b_c2_phonationvoiced", "b_c2_placevelar", "b_vowelo", "b_vowelu"))
```

# C1 release to GONS

```{r rel-gons-bm}
priors <- c(
  set_prior("normal(150, 50)", class = "Intercept"),
  set_prior("normal(0, 10)", class = "b", coef = "c2_phonationvoiced"),
  set_prior("normal(0, 10)", class = "b", coef = "vowelo"),
  set_prior("normal(0, 10)", class = "b", coef = "vowelu"),
  set_prior("normal(0, 10)", class = "b", coef = "c2_placevelar"),
  set_prior("normal(0, 10)", class = "b", coef = "c2_phonationvoiced:vowelo"),
  set_prior("normal(0, 10)", class = "b", coef = "c2_phonationvoiced:vowelu"),
  set_prior("normal(0, 10)", class = "b", coef = "c2_phonationvoiced:c2_placevelar"),
  set_prior("normal(0, 50)", class = "b", coef = "syl_rate_c"),
  set_prior("normal(0,200)", class = "sd"),
  set_prior("normal(0,50)", class = "sigma")
)

rel_gons_bm <- brm(
  rel_gons ~
    c2_phonation +
    c2_place +
    vowel +
    c2_phonation:c2_place +
    c2_phonation:vowel +
    syl_rate_c +
    (1|speaker) +
    (1|item),
  prior = priors,
  data = gestures,
  cores = 2
)
```

```{r rel-gons-summary}
summary(rel_gons_bm)
```

```{r rel-gons-intervals}
mcmc_intervals(as.array(rel_gons_bm), pars = c("b_c2_phonationvoiced", "b_c2_placevelar", "b_vowelo", "b_vowelu"))
```

