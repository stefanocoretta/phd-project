---
title: "Tongue contours"
author: "Stefano Coretta"
date: "09/03/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = normalizePath("../../../"))
library(tidyverse)
theme_set(theme_minimal())
library(tidymv)
library(rticulate)
library(itsadug)
library(beepr)
```

# Data import

```{r read-data}
columns <- c(
  "speaker",
  "seconds",
  "rec_date",
  "prompt",
  "label",
  "TT_displacement_sm",
  "TT_velocity",
  "TT_velocity_abs",
  "TD_displacement_sm",
  "TD_velocity",
  "TD_velocity_abs",
  "TR_displacement_sm",
  "TR_velocity",
  "TR_velocity_abs"
)

speakers <- read_csv("./voicing-effect/data/datasets/speakers.csv")
stimuli <- read_csv("./voicing-effect/data/datasets/stimuli.csv")

tongue <- list.files(
  path = "./voicing-effect/data/datasets/ultrasound",
  pattern = "*-tongue-cart.tsv",
  full.names = TRUE
) %>%
  read_aaa(., columns) %>%
  na.omit() %>%
  mutate(word = word(prompt, 2)) %>%
  left_join(y = speakers) %>%
  left_join(y = stimuli) %>%
  filter(c1_phonation == "voiceless") %>%
  mutate(
    c2_phonation = ordered(c2_phonation, levels = c("voiceless", "voiced")),
    vowel = ordered(vowel, levels = c("a", "o", "u")),
    c2_place = ordered(c2_place, levels = c("coronal", "velar")),
    speaker_phon = interaction(speaker, c2_phonation)
  ) %>%
  mutate_if(is.character, as.factor)

contrasts(tongue$c2_phonation) <- "contr.treatment"
contrasts(tongue$vowel) <- "contr.treatment"
contrasts(tongue$c2_place) <- "contr.treatment"
```

# IT01

## Maximum displacement

```{r it01-max}
it01_max <- tongue %>%
  filter(
    speaker == "it01",
    label %in% c("max_TT", "max_TD")
  )
```

```{r it01-max-gam}
it01_max_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it01_max,
  method = "ML"
)
summary(it01_max_gam)

it01_max_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
  c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it01_max,
  method = "ML"
)

compareML(it01_max_gam_null, it01_max_gam)
```

## Closure

```{r it01-clos}
it01_clo <- tongue %>%
  filter(
    speaker == "it01",
    label %in% c("closure_")
  )
```

```{r it01-clo-gam}
it01_clo_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it01_clo,
  method = "ML",
  fan_lines = c(15, 22)
)
summary(it01_clo_gam)

it01_clo_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it01_clo,
  method = "ML",
  fan_lines = c(15, 22)
)

compareML(it01_clo_gam_null, it01_clo_gam)
```

```{r it01-clo-smooths}
plot_polar_smooths(
  it01_clo_gam,
  X,
  c2_phonation,
  facet_terms = c2_place + vowel
)
```

# IT02

## Maximum displacement

```{r it02-max}
it02_max <- tongue %>%
  filter(
    speaker == "it02",
    label %in% c("max_TT", "max_TD"),
    fan_line > 5, fan_line < 40
  )
```

```{r it02-max-gam}
it02_max_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it02_max,
  method = "ML"
)
summary(it02_max_gam)

it02_max_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
  c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it02_max,
  method = "ML"
)

compareML(it02_max_gam_null, it02_max_gam)
```

## Closure

```{r it02-clos}
it02_clo <- tongue %>%
  filter(
    speaker == "it02",
    label %in% c("closure_"),
    fan_line > 5, fan_line < 40
  )
```

```{r it02-clo-gam}
it02_clo_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it02_clo,
  method = "ML",
  fan_lines = c(15, 22)
)
summary(it02_clo_gam)

it02_clo_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it02_clo,
  method = "ML",
  fan_lines = c(15, 22)
)

compareML(it02_clo_gam_null, it02_clo_gam)
```

```{r it02-clo-smooths}
plot_polar_smooths(
  it02_clo_gam,
  X,
  c2_phonation,
  facet_terms = c2_place + vowel
)
```

# IT03

## Maximum displacement

```{r it03-max}
it03_max <- tongue %>%
  filter(
    speaker == "it03",
    label %in% c("max_TT", "max_TD"),
    fan_line < 40
  )
```

```{r it03-max-gam}
it03_max_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it03_max,
  method = "ML"
)
summary(it03_max_gam)

it03_max_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
  c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it03_max,
  method = "ML"
)

compareML(it03_max_gam_null, it03_max_gam)
```

## Closure

```{r it03-clos}
it03_clo <- tongue %>%
  filter(
    speaker == "it03",
    label %in% c("closure_"),
    fan_line < 40
  )
```

```{r it03-clo-gam}
it03_clo_gam <- polar_gam(
  Y ~
    c2_phonation +
    c2_place +
    vowel +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it03_clo,
  method = "ML",
  fan_lines = c(15, 22)
)
summary(it03_clo_gam)

it03_clo_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    c2_place +
    vowel+
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it03_clo,
  method = "ML",
  fan_lines = c(15, 22)
)

compareML(it03_clo_gam_null, it03_clo_gam)
```

```{r it03-clo-smooths}
plot_polar_smooths(
  it03_clo_gam,
  X,
  c2_phonation,
  facet_terms = c2_place
)
```

# IT04

## Maximum displacement

```{r it04-max}
it04_max <- tongue %>%
  filter(
    speaker == "it04",
    label %in% c("max_TT", "max_TD")
  )
```

```{r it04-max-gam}
it04_max_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it04_max,
  method = "ML"
)
summary(it04_max_gam)

it04_max_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
  c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it04_max,
  method = "ML"
)

compareML(it04_max_gam_null, it04_max_gam)
```

## Closure

```{r it04-clos}
it04_clo <- tongue %>%
  filter(
    speaker == "it04",
    label %in% c("closure_")
  )
```

```{r it04-clo-gam}
it04_clo_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it04_clo,
  method = "ML",
  fan_lines = c(15, 22)
)
summary(it04_clo_gam)

it04_clo_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it04_clo,
  method = "ML",
  fan_lines = c(15, 22)
)

compareML(it04_clo_gam_null, it04_clo_gam)
```

# IT05

## Maximum displacement

```{r it05-max}
it05_max <- tongue %>%
  filter(
    speaker == "it05",
    label %in% c("max_TT", "max_TD")
  )
```

```{r it05-max-plot}
it05_max %>%
  ggplot(aes(X, Y, colour = c2_phonation)) +
  geom_point(alpha = 0.5) +
  facet_grid(c2_place ~ vowel)
```

```{r it05-max-gam}
it05_max_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it05_max,
  method = "ML",
  fan_lines = c(15, 22)
)
summary(it05_max_gam)

it05_max_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
  c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it05_max,
  method = "ML",
  fan_lines = c(15, 22)
)

compareML(it05_max_gam_null, it05_max_gam)
```

## Closure

```{r it05-clos}
it05_clo <- tongue %>%
  filter(
    speaker == "it05",
    label %in% c("closure_")
  )
```

```{r it05-clo-gam}
it05_clo_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it05_clo,
  method = "ML",
  fan_lines = c(15, 22)
)
summary(it05_clo_gam)

it05_clo_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
  c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it05_clo,
  method = "ML",
  fan_lines = c(15, 22)
)

compareML(it05_clo_gam_null, it05_clo_gam)
```

# IT07

## Maximum displacement

```{r it07-max}
it07_max <- tongue %>%
  filter(
    speaker == "it07",
    label %in% c("max_TT", "max_TD")
  )
```

```{r it07-max-plot}
it07_max %>%
  ggplot(aes(X, Y, colour = c2_phonation)) +
  geom_point(alpha = 0.5) +
  facet_grid(c2_place ~ vowel)
```

```{r it07-max-gam}
it07_max_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it07_max,
  method = "ML",
  fan_lines = c(15, 22)
)
summary(it07_max_gam)

it07_max_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
  c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it07_max,
  method = "ML",
  fan_lines = c(15, 22)
)

compareML(it07_max_gam_null, it07_max_gam)
```

## Closure

```{r it07-clos}
it07_clo <- tongue %>%
  filter(
    speaker == "it07",
    label %in% c("closure_")
  )
```

```{r it07-clo-gam}
it07_clo_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it07_clo,
  method = "ML",
  fan_lines = c(15, 22)
)
summary(it07_clo_gam)

it07_clo_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
  c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it07_clo,
  method = "ML",
  fan_lines = c(15, 22)
)

compareML(it07_clo_gam_null, it07_clo_gam)
```

# IT09

## Maximum displacement

```{r it09-max}
it09_max <- tongue %>%
  filter(
    speaker == "it09",
    label %in% c("max_TT", "max_TD")
  )
```

```{r it09-max-plot}
it09_max %>%
  ggplot(aes(X, Y, colour = c2_phonation)) +
  geom_point(alpha = 0.5) +
  facet_grid(c2_place ~ vowel)
```

```{r it09-max-plot-filt}
it09_max %>%
  filter(Y > -40) %>%
  ggplot(aes(X, Y, colour = c2_phonation)) +
  geom_point(alpha = 0.5) +
  facet_grid(c2_place ~ vowel)
```

```{r it09-max-filt}
it09_max_filt <- tongue %>%
  filter(
    speaker == "it09",
    label %in% c("max_TT", "max_TD"),
    Y > -40
  )
```

```{r it09-max-gam}
it09_max_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it09_max_filt,
  method = "ML",
  fan_lines = c(15, 22)
)
summary(it09_max_gam)

it09_max_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
  c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it09_max_filt,
  method = "ML",
  fan_lines = c(15, 22)
)

compareML(it09_max_gam_null, it09_max_gam)
```

## Closure

```{r it09-clos}
it09_clo <- tongue %>%
  filter(
    speaker == "it09",
    label %in% c("closure_"),
    Y > -40
  )
```

```{r it09-clo-gam}
it09_clo_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it09_clo,
  method = "ML",
  fan_lines = c(15, 22)
)
summary(it09_clo_gam)

it09_clo_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
  c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it09_clo,
  method = "ML",
  fan_lines = c(15, 22)
)

compareML(it09_clo_gam_null, it09_clo_gam)
```

# IT11

## Maximum displacement

```{r it11-max}
it11_max <- tongue %>%
  filter(
    speaker == "it11",
    label %in% c("max_TT", "max_TD")
  )
```

```{r it11-max-plot}
it11_max %>%
  ggplot(aes(X, Y, colour = c2_phonation)) +
  geom_point(alpha = 0.5) +
  facet_grid(c2_place ~ vowel)
```

```{r it11-max-gam}
it11_max_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it11_max,
  method = "ML",
  fan_lines = c(15, 22)
)
summary(it11_max_gam)

it11_max_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
  c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it11_max,
  method = "ML",
  fan_lines = c(15, 22)
)

compareML(it11_max_gam_null, it11_max_gam)
```

```{r it11-max-smooths}
plot_polar_smooths(
  it11_max_gam,
  X,
  c2_phonation,
  facet_terms = c2_place + vowel
)
```

IT11 show different contours: voiced has retracted tongue and higher tongue tip/body.

## Closure

```{r it11-clos}
it11_clo <- tongue %>%
  filter(
    speaker == "it11",
    label %in% c("closure_")
  )
```

```{r it11-clo-gam}
it11_clo_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it11_clo,
  method = "ML",
  fan_lines = c(15, 22)
)
summary(it11_clo_gam)

it11_clo_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
  c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it11_clo,
  method = "ML",
  fan_lines = c(15, 22)
)

compareML(it11_clo_gam_null, it11_clo_gam)
```

```{r it11-clo-smooths}
plot_polar_smooths(
  it11_clo_gam,
  X,
  c2_phonation,
  facet_terms = c2_place + vowel
)
```

Same for closure: tongue root retraction in voiced and tongue tip raised.

# IT12

## Maximum displacement

```{r it12-max}
it12_max <- tongue %>%
  filter(
    speaker == "it12",
    label %in% c("max_TT", "max_TD")
  )
```

```{r it12-max-plot}
it12_max %>%
  ggplot(aes(X, Y, colour = c2_phonation)) +
  geom_point(alpha = 0.5) +
  facet_grid(c2_place ~ vowel)
```

```{r it12-max-plot-filt}
it12_max %>%
  filter(X < 35, Y > -40) %>%
  ggplot(aes(X, Y, colour = c2_phonation)) +
  geom_point(alpha = 0.5) +
  facet_grid(c2_place ~ vowel)
```

```{r it12-max-filt}
it12_max_filt <- tongue %>%
  filter(
    speaker == "it12",
    label %in% c("max_TT", "max_TD"),
    X < 35
  )
```

```{r it12-max-gam}
it12_max_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it12_max_filt,
  method = "ML",
  fan_lines = c(15, 22)
)
summary(it12_max_gam)

it12_max_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
  c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it12_max_filt,
  method = "ML",
  fan_lines = c(15, 22)
)

compareML(it12_max_gam_null, it12_max_gam)
```

```{r it12-max-smooths}
plot_polar_smooths(
  it12_max_gam,
  X,
  c2_phonation,
  facet_terms = c2_place + vowel
)
``` 

IT12 tongue contours do not differ.

## Closure

```{r it12-clos}
it12_clo <- tongue %>%
  filter(
    speaker == "it12",
    label %in% c("closure_"),
    X < 35, Y > -40
  )
```

IT13 closure data are fileterd as the maximum displacement data.

```{r it12-clo-plot}
it12_clo %>%
  ggplot(aes(X, Y, colour = c2_phonation)) +
  geom_point(alpha = 0.5) +
  facet_grid(c2_place ~ vowel)
```

```{r it12-clo-gam}
it12_clo_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it12_clo,
  method = "ML",
  fan_lines = c(15, 22)
)
summary(it12_clo_gam)

it12_clo_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
  c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it12_clo,
  method = "ML",
  fan_lines = c(15, 22)
)

compareML(it12_clo_gam_null, it12_clo_gam)
```

```{r it12-clo-smooths}
plot_polar_smooths(
  it12_clo_gam,
  X,
  c2_phonation,
  facet_terms = c2_place + vowel
)
```

Nor at closure there are differences.

# IT13

## Maximum displacement

```{r it13-max}
it13_max <- tongue %>%
  filter(
    speaker == "it13",
    label %in% c("max_TT", "max_TD")
  )
```

```{r it13-max-plot}
it13_max %>%
  ggplot(aes(X, Y, colour = c2_phonation)) +
  geom_point(alpha = 0.5) +
  facet_grid(c2_place ~ vowel)
```

```{r it13-max-plot-filt}
it13_max %>%
  filter(Y > -30) %>%
  ggplot(aes(X, Y, colour = c2_phonation)) +
  geom_point(alpha = 0.5) +
  facet_grid(c2_place ~ vowel)
```

```{r it13-max-filt}
it13_max_filt <- tongue %>%
  filter(
    speaker == "it13",
    label %in% c("max_TT", "max_TD"),
    Y > -30
  )
```

```{r it13-max-gam}
it13_max_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it13_max_filt,
  method = "ML"
)
summary(it13_max_gam)

it13_max_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
  c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it13_max_filt,
  method = "ML"
)

compareML(it13_max_gam_null, it13_max_gam)
```

```{r it13-max-smooths}
plot_polar_smooths(
  it13_max_gam,
  X,
  c2_phonation,
  facet_terms = c2_place + vowel
)
```

c2_phonation improves the fit of the model. There is TRA and tongue dorsum lowering.

## Closure

```{r it13-clos}
it13_clo <- tongue %>%
  filter(
    speaker == "it13",
    label %in% c("closure_"),
    Y > -30
  )
```

IT13 closure data are fileterd as the maximum displacement data (Y > -30).

```{r it13-clo-plot}
it13_clo %>%
  ggplot(aes(X, Y, colour = c2_phonation)) +
  geom_point(alpha = 0.5) +
  facet_grid(c2_place ~ vowel)
```

```{r it13-clo-gam}
it13_clo_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it13_clo,
  method = "ML"
)
summary(it13_clo_gam)

it13_clo_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
  c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it13_clo,
  method = "ML"
)

compareML(it13_clo_gam_null, it13_clo_gam)
```

```{r it13-clo-smooths}
plot_polar_smooths(
  it13_clo_gam,
  X,
  c2_phonation,
  facet_terms = c2_place + vowel
)
```

c2_phonation improves the fit of the model. There is TRA and tongue dorsum lowering at closure in IT13.

# IT14

IT14 does not have data for velars and you don't see much of the tongue tip.

## Maximum displacement

```{r it14-max}
it14_max <- tongue %>%
  filter(
    speaker == "it14",
    label %in% c("max_TT", "max_TD")
  )
```

```{r it14-max-plot}
it14_max %>%
  ggplot(aes(X, Y, colour = c2_phonation)) +
  geom_point(alpha = 0.5) +
  facet_grid(. ~ vowel)
```

I think the kinematics are so off that it is probably safer not to use this data.

## Closure

```{r it14-clo}
it14_clo <- tongue %>%
  filter(
    speaker == "it14",
    label %in% c("closure_")
  )
```

```{r it14-clo-plot}
it14_clo %>%
  ggplot(aes(X, Y, colour = c2_phonation)) +
  geom_point(alpha = 0.5) +
  facet_grid(. ~ vowel)
```

Data at closure are somewhat better, although still not great.

```{r it14-clo-gam}
it14_clo_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it14_clo,
  method = "ML"
)
summary(it14_clo_gam)

it14_clo_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it14_clo,
  method = "ML"
)

compareML(it14_clo_gam_null, it14_clo_gam)
```

```{r it14-clo-smooths}
plot_polar_smooths(
  it14_clo_gam,
  X,
  c2_phonation,
  facet_terms = vowel
)
```

# PL02

## Maximum displacement

```{r pl02-max}
pl02_max <- tongue %>%
  filter(
    speaker == "pl02",
    label %in% c("max_TT", "max_TD"),
    fan_line < 40
  )
```

```{r pl02-max-gam}
pl02_max_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl02_max,
  method = "ML"
)
summary(pl02_max_gam)

pl02_max_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
  c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl02_max,
  method = "ML"
)

compareML(pl02_max_gam_null, pl02_max_gam)
```

## Closure

```{r pl02-clos}
pl02_clo <- tongue %>%
  filter(
    speaker == "pl02",
    label %in% c("closure_")
  )
```

```{r pl02-clo-gam}
pl02_clo_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl02_clo,
  method = "ML"
)
summary(pl02_clo_gam)

pl02_clo_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
  c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl02_clo,
  method = "ML"
)

compareML(pl02_clo_gam_null, pl02_clo_gam)
```

# PL03

## Maximum displacement

```{r pl03-max}
pl03_max <- tongue %>%
  filter(
    speaker == "pl03",
    label %in% c("max_TT", "max_TD")
  )
```

```{r pl03-max-gam}
pl03_max_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl03_max,
  method = "ML"
)
summary(pl03_max_gam)

pl03_max_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
  c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl03_max,
  method = "ML"
)

compareML(pl03_max_gam_null, pl03_max_gam)
```

## Closure

```{r pl03-clos}
pl03_clo <- tongue %>%
  filter(
    speaker == "pl03",
    label %in% c("closure_")
  )
```

```{r pl03-clo-gam}
pl03_clo_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl03_clo,
  method = "ML"
)
summary(pl03_clo_gam)

pl03_clo_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
  c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl03_clo,
  method = "ML"
)

compareML(pl03_clo_gam_null, pl03_clo_gam)
```

# PL04

## Maximum displacement

```{r pl04-max}
pl04_max <- tongue %>%
  filter(
    speaker == "pl04",
    label %in% c("max_TT", "max_TD")
  )
```

```{r pl04-max-gam}
pl04_max_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl04_max,
  method = "ML"
)
summary(pl04_max_gam)

pl04_max_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
  c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl04_max,
  method = "ML"
)

compareML(pl04_max_gam_null, pl04_max_gam)
```

## Closure

```{r pl04-clos}
pl04_clo <- tongue %>%
  filter(
    speaker == "pl04",
    label %in% c("closure_")
  )
```

```{r pl04-clo-gam}
pl04_clo_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl04_clo,
  method = "ML"
)
summary(pl04_clo_gam)

pl04_clo_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
  c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl04_clo,
  method = "ML"
)

compareML(pl04_clo_gam_null, pl04_clo_gam)
```

# PL05

## Maximum displacement

```{r pl05-max}
pl05_max <- tongue %>%
  filter(
    speaker == "pl05",
    label %in% c("max_TT", "max_TD")
  )
```

```{r pl05-max-gam}
pl05_max_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl05_max,
  method = "ML"
)
summary(pl05_max_gam)

pl05_max_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
  c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl05_max,
  method = "ML"
)

compareML(pl05_max_gam_null, pl05_max_gam)
```

## Closure

```{r pl05-clos}
pl05_clo <- tongue %>%
  filter(
    speaker == "pl05",
    label %in% c("closure_")
  )
```

```{r pl05-clo-gam}
pl05_clo_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl05_clo,
  method = "ML"
)
summary(pl05_clo_gam)

pl05_clo_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
  c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl05_clo,
  method = "ML"
)

compareML(pl05_clo_gam_null, pl05_clo_gam)
```

```{r pl05-clo-smooths}
plot_polar_smooths(
  pl05_clo_gam,
  X,
  c2_phonation,
  facet_terms = c2_place + vowel
)
```

# PL06

## Maximum displacement

```{r pl06-max}
pl06_max <- tongue %>%
  filter(
    speaker == "pl06",
    label %in% c("max_TT", "max_TD"),
    X < 26,
    Y > -30
  )
```

```{r pl06-max-gam}
pl06_max_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl06_max,
  method = "ML",
  fan_lines = c(16, 19)
)
summary(pl06_max_gam)

pl06_max_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
  c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl06_max,
  method = "ML",
  fan_lines = c(16, 19)
)

compareML(pl06_max_gam_null, pl06_max_gam)
```

## Closure

```{r pl06-clos}
pl06_clo <- tongue %>%
  filter(
    speaker == "pl06",
    label %in% c("closure_"),
    X < 26,
    Y > -30
  )
```

```{r pl06-clo-plot}
pl06_clo %>%
  ggplot(aes(X, Y, colour = c2_phonation)) +
  geom_point(alpha = 0.5) +
  facet_grid(c2_place ~ vowel)
```

```{r pl06-clo-gam}
pl06_clo_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl06_clo,
  method = "ML",
  fan_lines = c(16, 19)
)
summary(pl06_clo_gam)

pl06_clo_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
  c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl06_clo,
  method = "ML",
  fan_lines = c(16, 19)
)

compareML(pl06_clo_gam_null, pl06_clo_gam)
```

```{r pl06-clo-smooths}
plot_polar_smooths(
  pl06_clo_gam,
  X,
  c2_phonation,
  facet_terms = c2_place + vowel
)
```

# PL07

## Maximum displacement

```{r pl07-max}
pl07_max <- tongue %>%
  filter(
    speaker == "pl07",
    label %in% c("max_TT", "max_TD"),
    Y > -26
  )
```

```{r pl07-max-gam}
pl07_max_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl07_max,
  method = "ML",
  fan_lines = c(16, 19)
)
summary(pl07_max_gam)

pl07_max_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
  c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl07_max,
  method = "ML",
  fan_lines = c(16, 19)
)

compareML(pl07_max_gam_null, pl07_max_gam)
```

## Closure

```{r pl07-clos}
pl07_clo <- tongue %>%
  filter(
    speaker == "pl07",
    label %in% c("closure_"),
    Y > -26
  )
```

```{r pl07-clo-plot}
pl07_clo %>%
  ggplot(aes(X, Y, colour = c2_phonation)) +
  geom_point(alpha = 0.5) +
  facet_grid(c2_place ~ vowel)
```

```{r pl07-clo-gam}
pl07_clo_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl07_clo,
  method = "ML"
)
summary(pl07_clo_gam)

pl07_clo_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
  c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl07_clo,
  method = "ML"
)

compareML(pl07_clo_gam_null, pl07_clo_gam)
```









```{r beep}
beep(2)
```

