---
title: "Tracegram"
author: "Stefano Coretta"
date: "20/12/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
knitr::opts_knit$set(root.dir = normalizePath("../../"))
library(tidyverse)
theme_set(theme_bw())
```

# Data import

```{r import}
languages <- read_csv("./voicing-effect/data/datasets/languages.csv")
words <- read_csv("./voicing-effect/data/datasets/stimuli.csv")

degg <- list.files(path = "./voicing-effect/data/datasets/egg",
                   pattern = "*-degg-tracing.csv",
                   full.names = TRUE) %>%
    map_df(~read_csv(.)) %>%
    left_join(y = languages) %>%
    left_join(y = words) %>%
    filter(c1phonation == "voiceless") %>%
    mutate_if(is.character, as.factor) %>%
    mutate(
        c2phonation_o = ordered(
            c2phonation,
            levels = c("voiceless", "voiced")
        ),
        closed_quotient = minimum - maximum,
        quotient_centre = (minimum + maximum) / 2,
        weighted_quotient_centre = ((minimum + maximum) / 2 ) * (minimum),
        peaks_ratio = maximum / minimum
    ) %>%
    filter(minimum > 0, minimum < 1)
```

# Data exploration

## Tracegrams

Let's save some `ggplot` layers to speed up plotting.

```{r tracegram-layers}
tracegram_layers <- list(
    xlab("proportion of vowel duration"),
    ylab("proportion of glottal period"),
    xlim(0, 1),
    ylim(0, 1),
    scale_color_discrete(name = "C2 voicing"),
    scale_linetype_discrete(name = "C2 voicing")
)
```


```{r tracegram-point-speakers}
degg %>%
    ggplot(aes(x = proportion, colour = c2phonation_o)) +
        facet_wrap(~ speaker, nrow = 2) +
        geom_point(aes(y = maximum), alpha = 0.5) +
        geom_point(aes(y = minimum), alpha = 0.5) +
        tracegram_layers
```

```{r tracegram-smooth-speakers}
degg %>%
    ggplot(aes(x = proportion, colour = c2phonation_o, linetype = c2phonation_o)) +
        facet_wrap(~ speaker, nrow = 2) +
        geom_smooth(aes(y = maximum), size = 0.5, alpha = 0.2) +
        geom_smooth(aes(y = minimum), size = 0.5, alpha = 0.2) +
        tracegram_layers
```

```{r tracegram-smooth-languages}
degg %>%
    ggplot(aes(x = proportion, colour = c2phonation_o, linetype = c2phonation_o)) +
        facet_wrap(~ language) +
        geom_smooth(aes(y = maximum), size = 0.5, alpha = 0.2) +
        geom_smooth(aes(y = minimum), size = 0.5, alpha = 0.2) +
        tracegram_layers +
    labs(title = "Vocal fold activity through vowel duration", subtitle = "The lines in the lower half of the graphs are traces of the dEGG maximum,\nwhile the lines in the upper half are traces of the dEGG minimum.")
```

As a first impression, it seems that both in Italian and Polish vocal folds start abducting in the voiceless condition before closure is achieved.
It looks like the abduction gesture starts earlier in Italian (60% of vowel duration) than in Polish (75% of vowel duration).

```{r tracegram-smooth-languages-vowels}
degg %>%
    ggplot(aes(x = proportion, colour = c2phonation_o, linetype = c2phonation_o)) +
        geom_smooth(aes(y = maximum), size = 0.5, alpha = 0.2) +
        geom_smooth(aes(y = minimum), size = 0.5, alpha = 0.2) +
        tracegram_layers +
        facet_grid(language ~ vowel)
```


## Closed qotient

```{r cq-layers}
cq_layers <- list(
    xlim(0, 1),
    xlab("vowel duration"),
    ylab("proportion of glottal period"),
    scale_color_discrete(name = "C2 voicing"),
    scale_linetype_discrete(name = "C2 voicing")
)
```


```{r cq-points}
degg %>%
    ggplot(aes(x = proportion, colour = c2phonation_o)) +
        facet_wrap(~ speaker, nrow = 2) +
        geom_point(aes(y = closed_quotient), alpha = 0.5) +
        cq_layers
```

```{r cq-smooth-speakers}
degg %>%
    ggplot(aes(proportion, closed_quotient, colour = c2phonation_o, linetype = c2phonation_o)) +
        facet_wrap(~ speaker, nrow = 2) +
        geom_point(size = 0.2, alpha = 0.1) +
        geom_smooth(size = 0.5, alpha = 0.5) +
        cq_layers
```

```{r cq-smooth-language}
degg %>%
    ggplot(aes(proportion, closed_quotient, colour = c2phonation_o, linetype = c2phonation_o)) +
        facet_wrap(~ language) +
        geom_point(size = 0.2, alpha = 0.1) +
        geom_smooth(alpha = 0.5) +
        cq_layers
```

```{r cq-smooth-language-vowel}
degg %>%
    ggplot(aes(proportion, closed_quotient, colour = c2phonation_o, linetype = c2phonation_o)) +
        facet_grid(language ~ vowel) +
        geom_point(size = 0.2, alpha = 0.1) +
        geom_smooth(alpha = 0.5) +
        cq_layers
```

## Closed Quotient Centre

```{r cq-centre-speaker}
degg %>%
    ggplot(aes(proportion, quotient_centre, colour = c2phonation_o, linetype = c2phonation_o)) +
    geom_smooth() +
    facet_wrap(~ speaker, nrow = 2)
```

```{r cq-centre-language}
degg %>%
    ggplot(aes(proportion, quotient_centre, colour = c2phonation_o, linetype = c2phonation_o)) +
    geom_smooth() +
    facet_grid(~ language) +
    ylim(0, 1)
```

```{r weighted-cq-centre-speaker}
degg %>%
    ggplot(aes(proportion, weighted_quotient_centre, colour = c2phonation_o, linetype = c2phonation_o)) +
    geom_smooth() +
    facet_wrap(~ speaker, nrow = 2)
```

```{r weighted-cq-centre-language}
degg %>%
    ggplot(aes(proportion, weighted_quotient_centre, colour = c2phonation_o, linetype = c2phonation_o)) +
    geom_smooth() +
    facet_grid(~ language) +
    ylim(0, 1)
```

## Peaks ratio

The peaks ratio is `dEGG_max / dEGG_min`.

```{r peaks-ratio-speaker}
degg %>%
    ggplot(aes(proportion, peaks_ratio, colour = c2phonation_o, linetype = c2phonation_o)) +
    geom_smooth() +
    facet_wrap(~ speaker, nrow = 2)
```

Yes, this clearly works.
