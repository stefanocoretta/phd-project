---
title: "Meta-analysis of the voicing effect in English"
author: "Stefano Coretta"
date: "07/12/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = normalizePath("../../"))
library(tidyverse)
theme_set(theme_minimal())
library(brms)
library(bayesplot)
cbbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
```

```{r data, message=FALSE}
estimates <- read_csv("./english/data/estimates.csv") %>%
  mutate_if(is.character, as.factor) %>%
  mutate(
    voice = factor(voice, levels = c("voiceless", "voiced")),
    n_syl = factor(n_syl, levels = c("mono", "di"))
  ) %>%
  na.omit()
```

```{r}
estimates %>%
  ggplot(aes(v_duration)) + geom_density()
```

The duration of vowels is bimodally distributed...

```{r}
estimates %>%
  ggplot(aes(v_duration, fill = word_pos)) + geom_density(alpha = 0.5) +
  scale_fill_manual(values = cbbPalette)
```

```{r}
estimates %>%
  ggplot(aes(v_duration, fill = word_pos, linetype = n_syl)) + geom_density(alpha = 0.8) +
  facet_wrap(~study) +
  scale_fill_manual(values = cbbPalette)
```

```{r}
get_prior(v_duration ~ voice * n_syl + word_pos + (1|study), data = estimates)
```

```{r}
priors <- c(
  set_prior("normal(200, 100)", class = "Intercept"),
  set_prior("normal(0, 50)", class = "b", coef = "n_syldi"),
  set_prior("normal(100, 50)", class = "b", coef = "voicevoiced"),
  set_prior("normal(0, 50)", class = "b", coef = "voicevoiced:n_syldi"),
  set_prior("normal(0, 100)", class = "b", coef = "word_posisolation"),
  set_prior("normal(0, 100)", class = "b", coef = "word_posmean"),
  set_prior("normal(0, 100)", class = "b", coef = "word_posmedial"),
  set_prior("normal(0, 50)", class = "sd"),
  set_prior("cauchy(0, 50)", class = "sigma")
)

ve_brm <- brm(
  v_duration ~
    voice *
    n_syl +
    word_pos +
    (1|study),
  data = estimates,
  prior = priors,
  cores = 2,
  seed = 8788
)
```

```{r}
summary(ve_brm)
```

```{r}
brms::pp_check(ve_brm, nsamples = 100)
```

```{r}
mcmc_trace(as.array(ve_brm), pars = "b_voicevoiced")
```

```{r}
mcmc_intervals(as.array(ve_brm), regex_pars = "b_")
```

```{r}
mcmc_areas(as.array(ve_brm), regex_pars = "b_")
```
