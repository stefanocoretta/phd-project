---
title: 'Processing EGG data: New methods for a multidimensional time-series assessment of vocal fold activity'
author: "Stefano Coretta"
date: "The University of Manchester"
institute: "Manchester Forum in Linguistics, 26th April 2018"
output:
  beamer_presentation:
    citation_package: natbib
    highlight: zenburn
    latex_engine: xelatex
fontsize: 12pt
bibliography: linguistics.bib
biblio-style: unified.bst
header-includes:
- \frenchspacing
- \usepackage{cleveref}
- \usetheme{metropolis}
- \titlegraphic{\includegraphics[height=1cm]{./graphics/logo.png}}
- \usecolortheme[snowy]{owl}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_knit$set(root.dir = normalizePath("./"))
library(tidyverse)
theme_set(theme_light())
cbPalette <- c("#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7", "#999999")
library(lmerTest)
library(itsadug)
```

```{r read-data, include=FALSE}
tracegram <- read_csv("./datasets/tracegram.csv") %>%
  separate(file, c("speaker", "phonation")) %>%
  mutate_if(is.character, as.factor) %>%
  mutate(
    phonation = factor(phonation, levels = c("modal", "breathy")),
    contact_quotient = degg_minimum - degg_maximum
  )

wavegram <- read_csv("./datasets/wavegram.csv") %>%
  separate(file, c("speaker", "phonation")) %>%
  mutate(
    phonation = ordered(phonation, levels = c("modal", "breathy")),
    speaker_phon = ordered(interaction(speaker, phonation))
  ) %>%
  mutate_if(is.character, as.factor) %>%
  filter(sequence < 8)

contrasts(wavegram$phonation) <- "contr.treatment"
contrasts(wavegram$speaker_phon) <- "contr.treatment"
```

## Background: Electroglottography

* EGG [@fabre1957; @scherer1987; @rothenberg1988]

    * estimation of vocal folds contact area (VFCA) based on impedance of high frequency current

* non-invasive

* relatively simple signal

## Background: Electroglottography

\begin{figure}
  \centering
  \includegraphics{./graphics/egg.jpg}
\end{figure}

## Background: Electroglottography

\begin{figure}
  \centering
  \includegraphics{./graphics/egg-setup.pdf}
\end{figure}

## Background: EGG signal

\begin{figure}
  \centering
  \includegraphics{./graphics/egg-signal.pdf}
\end{figure}

## Background: EGG signal

\begin{figure}
  \centering
  \includegraphics{./graphics/egg-phases.pdf}
\end{figure}

## Background: Contact quotient

\begin{figure}
  \centering
  \includegraphics{./graphics/egg-cq.pdf}
\end{figure}

## Background: Wavegrams [@herbst2010]

\begin{figure}
  \centering
  \includegraphics{./graphics/wavegram.jpeg}
\end{figure}

## Methods

* 4 phonetically trained BE speakers (1 F, 3 M)

* [ɑ] in modal and breathy voice
    * 10 × 2 = 20 tokens per speaker
    * 80 tokens

* equipment
    * Glottal Enterprises EG2-PCX2 unit
    * Movo LV4-O2 Lavalier microphone (sample rate 44100 Hz, 16-bit)

## Methods

* 500 ms portion centered around mid point of each token

* dEGG maxima and minima of each cycle within the 500 ms portion

    * CQ = minimum - maximum
    * tracegram

* wavegram data [@herbst2010]

    * generalised additive mixed models [@wood2006;@soskuthy2017;@van-rij2017]

## Results: CQ

\centering

```{r cq-density}
tracegram %>%
  ggplot(aes(contact_quotient, fill = phonation)) +
  geom_density(alpha = 0.7, size = 0) +
  facet_wrap(~ speaker, scales = "free") +
  geom_rug() +
  scale_fill_manual(values = cbPalette) +
  labs(
    title = "Density plots of CQ in modal and breathy phonation by speaker",
    x = "Contact quotient (CQ)"
  )
```

## Results: CQ

\tiny

```{r quotient-lmer}
quotient_lmer <- lmer(
    contact_quotient ~
        phonation +
        (1+phonation|speaker),
    data = tracegram
)

summary(quotient_lmer)
```

## Results: Tracegram

\centering

```{r tracegram, message=FALSE}
tracegram %>%
  ggplot(aes(time, colour = phonation, linetype = phonation)) +
  geom_smooth(aes(y = degg_maximum), se = F) +
  geom_smooth(aes(y = degg_minimum), se = F) +
  facet_wrap(~speaker) +
  scale_colour_manual(values = cbPalette) +
  coord_fixed(ratio = 1) +
  ylim(0, 1) +
  labs(
    title = "Tracegrams of modal and breathy phonation by speaker",
    x = "Time (normalised)",
    y = "Proportion of period"
  )
```

## Results: Wavegram GAM (modal)

```{r wavegram-gam, include=FALSE, cache=TRUE}
phonation_gam <- bam(
  amplitude ~
    phonation +
    s(sequence, k = 8) +
    s(sample) +
    s(sequence, by = phonation, k = 8) +
    s(sample, by = phonation) +
    ti(sequence, sample, k = 8) +
    ti(sequence, sample, by = phonation, k = 8) +
    s(sequence, speaker_phon, bs = "fs", m = 1, k = 8),
  data = wavegram,
  method = "ML"
)

phonation_gam_null <- bam(
    amplitude ~
#        phonation +
        s(sequence, k = 8) +
        s(sample) +
#        s(sequence, by = phonation, k = 8) + s(sample, by = phonation) +
        ti(sequence, sample, k = 8) +
#        ti(sequence, sample, by = phonation) +
        s(sequence, speaker_phon, bs = "fs", m = 1, k = 8),
    data = wavegram,
    method = "ML"
)
```

\centering

```{r wavegram-gam-plot-modal, cache=TRUE, dependson= "wavegram-gam"}
fvisgam(
    phonation_gam,
    view = c("sequence","sample"),
    cond = list(phonation = "modal"),
    rm.ranef = TRUE,
    print.summary = FALSE,
    zlim = c(0, 0.9)
)
```

## Results: Wavegram GAM (breathy)

\centering

```{r wavegram-gam-plot-breathy, cache=TRUE, dependson= "wavegram-gam"}
fvisgam(
    phonation_gam,
    view = c("sequence","sample"),
    cond = list(phonation = "breathy"),
    rm.ranef = TRUE,
    print.summary = FALSE,
    zlim = c(0, 0.9)
)
```

## Results: Wavegram GAM

\tiny

```{r wavegram-gam-compare}
compareML(phonation_gam_null, phonation_gam)
```

## Discussion

* CQ performed badly for speaker 03

* Tracegrams
    * non-resource-intensive method for visualising fold activity

* Wavegram GAMs
    * assessing fold activity data statistically

