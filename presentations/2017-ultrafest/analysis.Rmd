---
title: "Ultrafest analysis"
author: "Stefano Coretta"
date: "10/08/2017"
output: 
  html_document: 
    highlight: tango
    number_sections: yes
    theme: readable
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir=normalizePath("../../"))
library(tidyverse)
theme_set(theme_minimal())
library(rticulate)
library(stringr)
library(scales)
library(tidymv)
library(itsadug)
library(lmerTest)
library(effects)
library(sjPlot)
library(sjmisc)
library(sjlabelled)
options(contrasts = rep ("contr.treatment", 2))
```

# Import data

```{r tongues}
languages <- read_csv("voicing-effect/stimuli/languages.csv")
words <- read_csv("voicing-effect/stimuli/nonce.csv")

columns <- c(
    "speaker",
    "seconds",
    "rec.date",
    "prompt",
    "label",
    "TT.displacement.sm",
    "TT.velocity",
    "TT.velocity.abs",
    "TD.displacement.sm",
    "TD.velocity",
    "TD.velocity.abs"
)

aaa.files <- list.files(
    path = "./voicing-effect/results/ultrasound",
    pattern = "*-tongue-cart.tsv",
    full.names = TRUE
)

tongues <- read_aaa(
    aaa.files,
    columns, 
    na.rm = TRUE
) %>%
    mutate(word = word(prompt, 2)) %>%
    left_join(y = languages) %>%
    left_join(y = words) %>%
    mutate_if(is.character, as.factor) %>%
    group_by(speaker) %>%
    mutate(
        X.re = rescale(X),
        Y.re = rescale(Y)
    ) %>%
    ungroup() %>%
    mutate(
        vowel.ord = ordered(vowel, levels = c("a", "o", "u")),
        c2place.ord = ordered(c2place, levels = c("coronal", "velar")),
        c2phonation.ord = ordered(c2phonation, levels = c("voiceless", "voiced"))
    )

max <- tongues %>%
    filter(label %in% c("max_TT", "max_TD"), vowel != "u") %>%
    arrange(rec.date, fan.line) %>%
    create_event_start("rec.date")

max_it_12 <- max %>%
    filter(speaker %in% c("it01", "it02"))

max_pl_23 <- max %>%
    filter(speaker %in% c("pl02", "pl03"))

max_pl_34 <- max %>%
    filter(speaker %in% c("pl03", "pl04"))

aaa_files_clos <- list.files(
    path = "./voicing-effect/results/ultrasound",
    pattern = "*-tongue-clos-cart.tsv",
    full.names = TRUE
)

tongues_clos <- read_aaa(
    aaa_files_clos,
    columns, 
    na.rm = TRUE
) %>%
    mutate(word = word(prompt, 2)) %>%
    left_join(y = languages) %>%
    left_join(y = words) %>%
    mutate_if(is.character, as.factor) %>%
    group_by(speaker) %>%
    mutate(
        X.re = rescale(X),
        Y.re = rescale(Y)
    ) %>%
    ungroup() %>%
    mutate(
        vowel.ord = ordered(vowel, levels = c("a", "o", "u")),
        c2place.ord = ordered(c2place, levels = c("coronal", "velar")),
        c2phonation.ord = ordered(c2phonation, levels = c("voiceless", "voiced"))
    ) %>%
    arrange(rec.date, fan.line) %>%
    create_event_start("rec.date")
```

```{r vowels}
languages <- read_csv("./voicing-effect/stimuli/languages.csv")
words <- read_csv("./voicing-effect/stimuli/nonce.csv")

vowels <- list.files(path = "voicing-effect/results/durations",
                   pattern = "*-vowel-durations.csv",
                   full.names = TRUE) %>%
    map_df(~read_csv(., na = "--undefined--")) %>%
    left_join(y = languages) %>%
    left_join(y = words) %>%
    mutate_if(is.character, as.factor) %>%
    mutate(
        index = as.factor(index),
        c2phonation = factor(c2phonation, levels = c("voiceless", "voiced"))
    ) %>%
    filter(!(file == "it04-002" | file == "pl03-020")) # filter clear outliers

it_vow <- vowels %>%
    filter(speaker %in% c("it02", "it05"))

pl_vow <- vowels %>%
    filter(speaker %in% c("pl02", "pl05"))

it_vow_4 <- vowels %>%
    filter(language == "italian", speaker != "it05")
```

# Exploration

```{r coronal-it}
max %>%
    filter(c2place == "coronal", language == "italian") %>%
    plot_tongue(geom = "point", alpha = 0.5) +
    aes(colour = c2phonation) +
    facet_grid(vowel ~ speaker)
```

```{r velar-it}
max %>%
    filter(c2place == "velar", language == "italian") %>%
    plot_tongue(geom = "point", alpha = 0.5) +
    aes(colour = c2phonation) +
    facet_grid(vowel ~ speaker)
```

```{r coronal-pl}
max %>%
    filter(c2place == "coronal", language == "polish") %>%
    ggplot(aes(X, Y, colour = c2phonation)) +
    geom_point(alpha = 0.5) +
    facet_grid(vowel ~ speaker) +
    coord_fixed(1.5)
```

```{r coronal-pl-re}
max %>%
    filter(c2place == "coronal", language == "polish") %>%
    ggplot(aes(X.re, Y.re, colour = c2phonation)) +
    geom_point(alpha = 0.5) +
    facet_grid(speaker ~ vowel) +
    coord_fixed(0.7)
```

```{r velar-pl}
max %>%
    filter(c2place == "velar", language == "polish") %>%
    ggplot(aes(X, Y, colour = c2phonation)) +
    geom_point(alpha = 0.5) +
    facet_grid(vowel ~ speaker) +
    coord_fixed(0.7)
```

```{r velar-pl-re}
max %>%
    filter(c2place == "velar", language == "polish") %>%
    ggplot(aes(X.re, Y.re, colour = c2phonation)) +
    geom_point(alpha = 0.5) +
    facet_grid(speaker ~ vowel) +
    coord_fixed(0.7)
```

# Testing

Comparing fixed effects models works best with ML, otherwise you can use fREML with AIC for fixed effects, but if there is an AR1 model cannot use AIC, so need ML.

## Polish

```{r eval=FALSE}
pl.m1 <- bam(
    Y.re ~
        X.re +
        s(X.re, bs = "cr") +
        s(X.re, by = c2phonation.ord, bs = "cr") +
        s(X.re, by = c2place.ord, bs = "cr") +
        s(X.re, by = vowel.ord, bs = "cr") +
        s(X.re, rec.date, bs = "fs", xt = "cr", m = 1, k = 5) +
        s(X.re, speaker, bs = "fs", xt = "cr", m = 1, k = 5),
    data = max_pl_23,
    method = "fREML"
)

rho <- start_value_rho(pl.m1)

pl.m1.ar <- bam(
    Y.re ~
        X.re +
        s(X.re, bs = "cr") +
        s(X.re, by = c2phonation.ord, bs = "cr") +
        s(X.re, by = c2place.ord, bs = "cr") +
        s(X.re, by = vowel.ord, bs = "cr") +
        s(X.re, rec.date, bs = "fs", xt = "cr", m = 1, k = 5) +
        s(X.re, speaker, bs = "fs", xt = "cr", m = 1, k = 5),
    data = max_pl_23,
    method = "fREML",
    rho = rho,
    AR.start = max_pl_23$start.event
)

summary(pl.m1)

pl.m1.null <- bam(
    Y.re ~
        X.re +
        s(X.re, bs = "cr") +
        s(X.re, by = c2place.ord, bs = "cr") +
        s(X.re, by = vowel.ord, bs = "cr") +
        s(X.re, rec.date, bs = "fs", xt = "cr", m = 1, k = 5) +
        s(X.re, speaker, bs = "fs", xt = "cr", m = 1, k = 5),
    data = max_pl_23,
    method = "fREML"
)

compareML(pl.m1, pl.m1.null)
```

```{r eval=FALSE}
plot_smooth(
    pl.m1,
    view = "X.re",
    plot_all= "c2phonation.ord",
    cond = list("c2place.ord" = "coronal"),
    rug = FALSE
)
plot_diff(
    pl.m1,
    view = "X.re",
    comp = list(c2phonation.ord = c("voiceless", "voiced")),
    cond = list("c2place.ord" = "coronal")
)
```

```{r eval=FALSE}
plot_gamsd(
    pl.m1,
    view = "X.re",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
```

```{r eval=FALSE}
plot_gamsd(
    pl.m1.ar,
    view = "X.re",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
```

### PL02

```{r}
pl02_max <- filter(max, speaker == "pl02", X > -20)

pl02.m1 <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl02_max,
    method = "ML"
)

rho <- start_value_rho(pl02.m1)

pl02.m1.ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl02_max,
    method = "ML",
    rho = rho,
    AR.start = pl02_max$start.event
)

summary(pl02.m1)

pl02.m1.null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl02_max,
    method = "ML"
)

compareML(pl02.m1, pl02.m1.null)
```

```{r}
plot_gamsd(
    pl02.m1.ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
```

### PL03

```{r}
pl03_max <- filter(max, speaker == "pl03")

pl03.m1 <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl03_max,
    method = "fREML"
)

rho <- start_value_rho(pl03.m1)

pl03.m1.ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl03_max,
    method = "ML",
    rho = rho,
    AR.start = pl03_max$start.event
)

pl03.m1.ar.null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl03_max,
    method = "ML",
    rho = rho,
    AR.start = pl03_max$start.event
)

summary(pl03.m1)

pl03.m1.null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl03_max,
    method = "ML"
)

compareML(pl03.m1.ar, pl03.m1.ar.null)
```

```{r}
plot_gamsd(
    pl03.m1.ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "velar")
)
```

### PL04

```{r}
filter(max, speaker == "pl04") %>%
    ggplot(aes(X, Y, colour = c2phonation)) +
    geom_point(alpha = 0.5) +
    facet_grid(vowel ~ c2place)
```

```{r}
filter(max, speaker == "pl04", X > -30) %>%
    ggplot(aes(X, Y, colour = c2phonation)) +
    geom_point(alpha = 0.5) +
    facet_grid(vowel ~ c2place)
```

```{r}
pl04_max <- filter(max, speaker == "pl04", X > -30)

pl04.m1 <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl04_max,
    method = "fREML"
)

rho <- start_value_rho(pl04.m1)

pl04.m1.ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl04_max,
    method = "ML",
    rho = rho,
    AR.start = pl04_max$start.event
)

pl04.m1.ar.null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl04_max,
    method = "ML",
    rho = rho,
    AR.start = pl04_max$start.event
)

summary(pl04.m1.ar)

pl04.m1.null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl04_max,
    method = "fREML"
)

# compareML(pl04.m1, pl04.m1.null)
compareML(pl04.m1.ar, pl04.m1.ar.null)
```

```{r}
plot_gamsd(
    pl04.m1.ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)

ggsave("presentations/2017-ultrafest/pl04.pdf", width = 6, height = 4)
```

```{r}
acf_plot(resid(pl04.m1.ar), split_by=list(pl04_max$rec.date))
acf_resid(pl04.m1.ar, split_pred = "AR.start")
```

```{r eval=FALSE}
pl04_a <- filter(max, speaker == "pl04", vowel == "a")

pl04.m1 <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl04_a,
    method = "fREML"
)

rho <- start_value_rho(pl04.m1)

pl04.m1.ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl04_a,
    method = "ML",
    rho = rho,
    AR.start = pl04_a$start.event
)

pl04.m1.ar.null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl04_a,
    method = "ML",
    rho = rho,
    AR.start = pl04_a$start.event
)

summary(pl04.m1.ar)
compareML(pl04.m1.ar, pl04.m1.ar.null)
```

If only /a/ is used, no significance at all. With /o/ and X > -30, no significance, but with all X some significant difference at the very left end of the tongue.

```{r eval=FALSE}
plot_gamsd(
    pl04.m1.ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
```

### PL03-PL04

```{r pl34, eval=FALSE}
pl34.m1 <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5) +
        s(X, speaker, bs = "fs", xt = "cr", m = 1, k = 5),
    data = max_pl_34,
    method = "fREML"
)

rho <- start_value_rho(pl34.m1)

pl34.m1.ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5) +
        s(X, speaker, bs = "fs", xt = "cr", m = 1, k = 5),
    data = max_pl_34,
    method = "ML",
    rho = rho,
    AR.start = max_pl_34$start.event
)

pl34.m1.ar.null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5) +
        s(X, speaker, bs = "fs", xt = "cr", m = 1, k = 5),
    data = max_pl_34,
    method = "ML",
    rho = rho,
    AR.start = max_pl_34$start.event
)

summary(pl34.m1.ar)
compareML(pl34.m1.ar, pl34.m1.ar.null)
```

```{r eval=FALSE}
plot_gamsd(
    pl34.m1.ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "velar", speaker = "pl04")
)
```

The models with X, Y are not reliable because the tongue size differs a lot between speakers.

```{r pl34-re, eval=FALSE}
pl34.m1.re <- bam(
    Y.re ~
        X.re +
        s(X.re, bs = "cr") +
        s(X.re, by = c2phonation.ord, bs = "cr") +
        s(X.re, by = c2place.ord, bs = "cr") +
        s(X.re, by = vowel.ord, bs = "cr") +
        s(X.re, rec.date, bs = "fs", xt = "cr", m = 1, k = 5) +
        s(X.re, speaker, bs = "fs", xt = "cr", m = 1, k = 5),
    data = max_pl_34,
    method = "fREML"
)

rho <- start_value_rho(pl34.m1.re)

pl34.m1.ar.re <- bam(
    Y.re ~
        X.re +
        s(X.re, bs = "cr") +
        s(X.re, by = c2phonation.ord, bs = "cr") +
        s(X.re, by = c2place.ord, bs = "cr") +
        s(X.re, by = vowel.ord, bs = "cr") +
        s(X.re, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = max_pl_34,
    method = "ML",
    rho = rho,
    AR.start = max_pl_34$start.event
)

pl34.m1.ar.re.null <- bam(
    Y.re ~
        X.re +
        s(X.re, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X.re, by = c2place.ord, bs = "cr") +
        s(X.re, by = vowel.ord, bs = "cr") +
        s(X.re, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = max_pl_34,
    method = "ML",
    rho = rho,
    AR.start = max_pl_34$start.event
)

summary(pl34.m1.ar.re)
compareML(pl34.m1.ar.re, pl34.m1.ar.re.null)
```

```{r eval=FALSE}
plot_gamsd(
    pl34.m1.ar.re,
    view = "X.re",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
plot_gamsd(
    pl34.m1.ar.re,
    view = "X.re",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "velar")
)
```

## Italian

it01 and it02 have TRA at maximum displacement.

```{r eval=FALSE}
it.m1 <- bam(
    Y.re ~
        X.re +
        s(X.re, bs = "cr") +
        s(X.re, by = c2phonation.ord, bs = "cr") +
        s(X.re, by = c2place.ord, bs = "cr") +
        s(X.re, by = vowel.ord, bs = "cr") +
        s(X.re, rec.date, bs = "fs", xt = "cr", m = 1, k = 5) +
        s(X.re, speaker, bs = "fs", xt = "cr", m = 1, k = 5),
    data = max_it_12,
    method = "fREML"
)

rho <- start_value_rho(it.m1)

it.m1.ar <- bam(
    Y.re ~
        X.re +
        s(X.re, bs = "cr") +
        s(X.re, by = c2phonation.ord, bs = "cr") +
        s(X.re, by = c2place.ord, bs = "cr") +
        s(X.re, by = vowel.ord, bs = "cr") +
        s(X.re, rec.date, bs = "fs", xt = "cr", m = 1, k = 5) +
        s(X.re, speaker, bs = "fs", xt = "cr", m = 1, k = 5),
    data = max_it_12,
    method = "ML",
    rho = rho,
    AR.start = max_it_12$start.event
)

summary(it.m1.ar)

it.m1.ar.null <- bam(
    Y.re ~
        X.re +
        s(X.re, bs = "cr") +
#        s(X.re, by = c2phonation.ord, bs = "cr") +
        s(X.re, by = c2place.ord, bs = "cr") +
        s(X.re, by = vowel.ord, bs = "cr") +
        s(X.re, rec.date, bs = "fs", xt = "cr", m = 1, k = 5) +
        s(X.re, speaker, bs = "fs", xt = "cr", m = 1, k = 5),
    data = max_it_12,
    method = "ML",
    rho = rho,
    AR.start = max_it_12$start.event
)

it.m1.null <- bam(
    Y.re ~
        X.re +
        s(X.re, bs = "cr") +
        s(X.re, by = c2place.ord, bs = "cr") +
        s(X.re, by = vowel.ord, bs = "cr") +
        s(X.re, rec.date, bs = "fs", xt = "cr", m = 1, k = 5) +
        s(X.re, speaker, bs = "fs", xt = "cr", m = 1, k = 5),
    data = max_it_12,
    method = "ML"
)

compareML(it.m1.ar, it.m1.ar.null)
```

```{r eval=FALSE}
plot_gamsd(
    it.m1.ar,
    view = "X.re",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
```

### IT01

```{r}
it01_max <- filter(max, speaker == "it01")

it01.m1 <- bam(
    Y ~
        X.re +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it01_max,
    method = "fREML"
)

rho <- start_value_rho(it01.m1)

it01.m1.ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it01_max,
    method = "ML",
    rho = rho,
    AR.start = it01_max$start.event
)

summary(it01.m1.ar)

it01.m1.ar.null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it01_max,
    method = "ML",
    rho = rho,
    AR.start = it01_max$start.event
)

compareML(it01.m1.ar, it01.m1.ar.null)
```

```{r}
plot_gamsd(
    it01.m1.ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)

ggsave("presentations/2017-ultrafest/it01.pdf", width = 6, height = 4)
```

### IT02

```{r}
it02_max <- filter(max, speaker == "it02")

it02.m1 <- bam(
    Y ~
        X.re +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it02_max,
    method = "fREML"
)

rho <- start_value_rho(it02.m1)

it02.m1.ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it02_max,
    method = "ML",
    rho = rho,
    AR.start = it02_max$start.event
)

summary(it02.m1.ar)

it02.m1.ar.null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it02_max,
    method = "ML",
    rho = rho,
    AR.start = it02_max$start.event
)

compareML(it02.m1.ar, it02.m1.ar.null)
```

```{r}
plot_gamsd(
    it02.m1.ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
```

### IT03

IT03 has TRA in /a/, but not in /o/.

```{r}
it03_max <- filter(max, speaker == "it03", vowel == "a")

it03.m1 <- bam(
    Y ~
        X.re +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
#        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it03_max,
    method = "fREML"
)

rho <- start_value_rho(it03.m1)

it03.m1.ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
#        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it03_max,
    method = "ML",
    rho = rho,
    AR.start = it03_max$start.event
)

summary(it03.m1.ar)

it03.m1.ar.null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
#        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it03_max,
    method = "ML",
    rho = rho,
    AR.start = it03_max$start.event
)

compareML(it03.m1.ar, it03.m1.ar.null)
```

```{r}
plot_gamsd(
    it03.m1.ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
```

### IT04

TRA only in /a/.

```{r}
it04_max <- filter(max, speaker == "it04", vowel == "a", X > -15)

it04.m1 <- bam(
    Y ~
        X.re +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
#        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it04_max,
    method = "fREML"
)

rho <- start_value_rho(it04.m1)

it04.m1.ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
#        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it04_max,
    method = "ML",
    rho = rho,
    AR.start = it04_max$start.event
)

summary(it04.m1.ar)

it04.m1.ar.null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
#        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it04_max,
    method = "ML",
    rho = rho,
    AR.start = it04_max$start.event
)

compareML(it04.m1.ar, it04.m1.ar.null)
```

```{r}
plot_gamsd(
    it04.m1.ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
```

### IT05

```{r}
it05_max <- filter(max, speaker == "it05", vowel == "a")

it05.m1 <- bam(
    Y ~
        X.re +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it05_max,
    method = "fREML"
)

rho <- start_value_rho(it05.m1)

it05.m1.ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it05_max,
    method = "ML",
    rho = rho,
    AR.start = it05_max$start.event
)

summary(it05.m1.ar)

it05.m1.ar.null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it05_max,
    method = "ML",
    rho = rho,
    AR.start = it05_max$start.event
)

compareML(it05.m1.ar, it05.m1.ar.null)
```

```{r}
plot_gamsd(
    it05.m1.ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
```

# Italian tongue at closure

```{r}
tongues_clos %>%
    filter(c2place == "coronal", language == "italian") %>%
    plot_tongue(geom = "point", alpha = 0.5) +
    aes(colour = c2phonation) +
    facet_grid(vowel ~ speaker)
```


## IT01

```{r it01-clos}
it01_clos <- tongues_clos %>%
    filter(speaker == "it01", vowel != "u")
```

```{r it01-clos-gamm}
it01_clos_m1 <- bam(
    Y ~
        X.re +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it01_clos,
    method = "fREML"
)

rho <- start_value_rho(it01_clos_m1)

it01_clos_m1_ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it01_clos,
    method = "ML",
    rho = rho,
    AR.start = it01_clos$start.event
)

summary(it01_clos_m1_ar)

it01_clos_m1_ar_null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it01_clos,
    method = "ML",
    rho = rho,
    AR.start = it01_clos$start.event
)

compareML(it01_clos_m1_ar, it01_clos_m1_ar_null)
```

```{r plot-it01-clos-gamm}
plot_gamsd(
    it01_clos_m1_ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)

ggsave("presentations/2017-ultrafest/it01-clos.pdf", width = 6, height = 4)
```

## IT02

```{r it02-clos}
it02_clos <- tongues_clos %>%
    filter(speaker == "it02", vowel != "u")
```

```{r it02-clos-gamm}
it02_clos_m1 <- bam(
    Y ~
        X.re +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it02_clos,
    method = "fREML"
)

rho <- start_value_rho(it02_clos_m1)

it02_clos_m1_ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it02_clos,
    method = "ML",
    rho = rho,
    AR.start = it02_clos$start.event
)

summary(it02_clos_m1_ar)

it02_clos_m1_ar_null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it02_clos,
    method = "ML",
    rho = rho,
    AR.start = it02_clos$start.event
)

compareML(it02_clos_m1_ar, it02_clos_m1_ar_null)
```

```{r plot-it02-clos-gamm}
plot_gamsd(
    it02_clos_m1_ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
```

Both it01 and it02 show TRA at closure. It is difficult to quantify the difference compared to TRA at maximum displacement. Need a model to check that.



# Polish tongue at closure

## PL02

```{r pl02-clos}
pl02_clos <- tongues_clos %>%
    filter(speaker == "pl02", vowel != "u", X > -21)
```

```{r pl02-clos-gamm}
pl02_clos_m1 <- bam(
    Y ~
        X.re +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl02_clos,
    method = "fREML"
)

rho <- start_value_rho(pl02_clos_m1)

pl02_clos_m1_ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl02_clos,
    method = "ML",
    rho = rho,
    AR.start = pl02_clos$start.event
)

summary(pl02_clos_m1_ar)

pl02_clos_m1_ar_null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl02_clos,
    method = "ML",
    rho = rho,
    AR.start = pl02_clos$start.event
)

compareML(pl02_clos_m1_ar, pl02_clos_m1_ar_null)
```

```{r plot-pl02-clos-gamm}
plot_gamsd(
    pl02_clos_m1_ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
```

## PL04

```{r pl04-clos}
pl04_clos <- tongues_clos %>%
    filter(speaker == "pl04", vowel != "u")
```

```{r pl04-clos-gamm}
pl04_clos_m1 <- bam(
    Y ~
        X.re +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl04_clos,
    method = "fREML"
)

rho <- start_value_rho(pl04_clos_m1)

pl04_clos_m1_ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl04_clos,
    method = "ML",
    rho = rho,
    AR.start = pl04_clos$start.event
)

summary(pl04_clos_m1_ar)

pl04_clos_m1_ar_null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl04_clos,
    method = "ML",
    rho = rho,
    AR.start = pl04_clos$start.event
)

compareML(pl04_clos_m1_ar, pl04_clos_m1_ar_null)
```

```{r plot-pl04-clos-gamm}
plot_gamsd(
    pl04_clos_m1_ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)

ggsave("presentations/2017-ultrafest/pl04-clos.pdf", width = 6, height = 4)
```

# Comparison of Italian voiced at closure and maximum displacement

## IT01

```{r}
it01_voiced <- rbind(it01_max, it01_clos) %>%
    filter(c2phonation == "voiced") %>%
    mutate(
        position = ifelse(label %in% c("max_TT", "max_TD"), "maximum", "closure"),
        position_ord = ordered(position, levels = c("maximum", "closure"))
    ) %>%
    unite(item_no, seconds:rec.date) %>%
    filter(vowel != "u") %>%
    mutate_if(is.character, as.factor)
```

```{r it02-voiced-gamm}
it02_voiced_m1 <- bam(
    Y ~
        X.re +
        s(X, bs = "cr") +
        s(X, by = position_ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, item_no, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it01_voiced,
    method = "fREML"
)

rho <- start_value_rho(it02_voiced_m1)

it02_voiced_m1_ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = position_ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, item_no, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it01_voiced,
    method = "ML",
    rho = rho,
    AR.start = it01_voiced$start.event
)

summary(it02_voiced_m1_ar)

it02_voiced_m1_ar_null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, item_no, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it01_voiced,
    method = "ML",
    rho = rho,
    AR.start = it01_voiced$start.event
)

compareML(it02_voiced_m1_ar, it02_voiced_m1_ar_null)
```

```{r plot-it02-voiced-gamm}
plot_gamsd(
    it02_voiced_m1_ar,
    view = "X",
    comparison = list(position_ord = c("maximum", "closure")),
    conditions = list(c2place.ord = "coronal")
)

ggsave("presentations/2017-ultrafest/it01-voiced.pdf", width = 6, height = 4)
```

# Vowel durations

## Italian

```{r it-vow-all}
vowels %>%
    filter(language == "italian") %>%
    ggplot(aes(c2phonation, vowel.duration)) +
    geom_violin(draw_quantiles = 0.5) +
    facet_grid(. ~ speaker)
```

```{r it-vow-all-box}
vowels %>%
    filter(language == "italian") %>%
    ggplot(aes(c2phonation, vowel.duration)) +
    geom_boxplot() +
    facet_grid(. ~ speaker)
```

```{r it01-02-vowels}
vowels %>%
    filter(speaker %in% c("it01", "it02")) %>%
    ggplot(aes(c2phonation, vowel.duration)) +
    geom_boxplot() +
    facet_grid(. ~ speaker)
```

```{r it01-02-vowels-violin}
vowels %>%
    filter(speaker %in% c("it01", "it02")) %>%
    ggplot(aes(c2phonation, vowel.duration)) +
    geom_violin(draw_quantiles = 0.5) +
    facet_grid(. ~ speaker)
```

Vowels followed by voiceless consonants are shorter. The bimodal distribution of duration in the voiceless context in IT01 is very likely due to pre-aspiration.

The following test includes all italian speakers except IT05, because no TRA in IT05 (only slight).

```{r it-vow-lm}
it_vow_lm <- lmer(
    vowel.duration ~
        c2phonation +
#        c2place +
        vowel +
        sentence.duration +
        (1+c2phonation|speaker) +
        (1|word),
    data = filter(vowels, language == "italian", speaker != "it05")
)

summary(it_vow_lm)

it_vow_lm_null <- lmer(
    vowel.duration ~
#        c2phonation +
#        c2place +
        vowel +
        sentence.duration +
        (1+c2phonation|speaker) +
        (1|word),
    data = filter(vowels, language == "italian", speaker != "it05")
)

anova(it_vow_lm_null, it_vow_lm)
```

```{r it-vow-lm-plot}
plot(allEffects(it_vow_lm))
plot(fitted(it_vow_lm),residuals(it_vow_lm))
```

```{r it-vow-lm-2}
it_vow_lm <- lmer(
    vowel.duration ~
        c2phonation +
        c2place +
        vowel +
        sentence.duration +
        (1+c2phonation|speaker) +
        (1|word),
    data = it_vow_4
)

summary(it_vow_lm)

it_vow_lm_null <- lmer(
    vowel.duration ~
#        c2phonation +
        c2place +
        vowel +
        sentence.duration +
        (1+c2phonation|speaker) +
        (1|word),
    data = it_vow_4
)

anova(it_vow_lm_null, it_vow_lm)

it_vow_lm <- lmer(
    vowel.duration ~
        c2phonation +
        c2place +
        vowel +
        c2phonation:vowel +
        sentence.duration +
        (1+c2phonation|speaker) +
        (1|word),
    data = it_vow_4
)

summary(it_vow_lm)

it_vow_lm_null <- lmer(
    vowel.duration ~
        c2phonation +
        c2place +
        vowel +
        sentence.duration +
        (1+c2phonation|speaker) +
        (1|word),
    data = it_vow_4
)

anova(it_vow_lm_null, it_vow_lm)
```

```{r it-vow-lm-2-plot}
plot(allEffects(it_vow_lm))
plot(fitted(it_vow_lm),residuals(it_vow_lm))
qqnorm(resid(it_vow_lm))
```

## Polish

```{r pl-vow-all}
vowels %>%
    filter(language == "polish") %>%
    ggplot(aes(c2phonation, vowel.duration)) +
    geom_violin(draw_quantiles = 0.5) +
    facet_grid(. ~ speaker)
```

```{r pl-vow-all-box}
vowels %>%
    filter(language == "polish") %>%
    ggplot(aes(c2phonation, vowel.duration)) +
    geom_boxplot() +
    facet_grid(. ~ speaker)
```

```{r pl-vow-all-box-2}
vowels %>%
    filter(language == "polish", vowel != "u") %>%
    ggplot(aes(c2phonation, vowel.duration)) +
    geom_boxplot() +
    facet_grid(. ~ speaker)
```

```{r pl04-05-density}
vowels %>%
    filter(speaker %in% c("pl04", "pl05")) %>%
    ggplot(aes(vowel.duration, colour = c2phonation)) +
    geom_density() +
    facet_grid(. ~ speaker)
```

```{r pl04-05-density-2}
vowels %>%
    filter(speaker %in% c("pl04", "pl05"), !(word == "paga" | word == "pada"), vowel != "u") %>%
    ggplot(aes(vowel.duration, colour = c2phonation)) +
    geom_density() +
    facet_grid(. ~ speaker)
```

```{r pl04-05-box}
vowels %>%
    filter(speaker %in% c("pl04", "pl05"), !(word == "paga" | word == "pada"), vowel != "u") %>%
    ggplot(aes(c2phonation, vowel.duration)) +
    geom_boxplot() +
    facet_grid(. ~ speaker)
```

```{r pl03-04-vowels}
pl_vow %>%
    ggplot(aes(c2phonation, vowel.duration)) +
    geom_boxplot() +
    facet_grid(. ~ speaker)
```

```{r pl03-04-vowels-violin}
pl_vow %>%
    ggplot(aes(c2phonation, vowel.duration)) +
    geom_violin() +
    facet_grid(. ~ speaker)
```

```{r pl-vow-lm}
pl_vow_lm <- lmer(
    vowel.duration ~
        c2phonation +
        vowel +
#        c2place:vowel +
        sentence.duration +
        (1+c2phonation|speaker) +
        (1|word),
    data = filter(vowels, language == "polish")
)

summary(pl_vow_lm)

pl_vow_lm_null <- lmer(
    vowel.duration ~
#        c2phonation +
        vowel +
#        c2place:vowel +
        sentence.duration +
        (1+c2phonation|speaker) +
        (1|word),
    data = filter(vowels, language == "polish")
)

anova(pl_vow_lm_null, pl_vow_lm)
```

```{r pl-vow-lm-plot}
plot(allEffects(pl_vow_lm))
```

```{r pl-lm-res}
qqnorm(resid(pl_vow_lm))
```


```{r pl-vow-lm-2}
pl_vow_lm <- lmer(
    vowel.duration ~
        c2phonation +
        vowel +
        c2place +
        sentence.duration +
        (1+c2phonation|speaker) +
        (1|word),
    data = filter(vowels, language == "polish", vowel != "u")
)

summary(pl_vow_lm)

pl_vow_lm_null <- lmer(
    vowel.duration ~
#        c2phonation +
        vowel +
        c2place +
        sentence.duration +
        (1+c2phonation|speaker) +
        (1|word),
    data = filter(vowels, language == "polish", vowel != "u")
)

anova(pl_vow_lm_null, pl_vow_lm)
```

```{r pl-vow-lm-plot}
plot(allEffects(pl_vow_lm))
```

`c2phonation` is partially significant. No interactions came out as significant.

```{r pl-vow-lm-3}
pl_vow_lm <- lmer(
    vowel.duration ~
        c2phonation +
        vowel +
        c2place +
        sentence.duration +
        (1+c2phonation|speaker) +
        (1|word),
    data = filter(vowels, language == "polish")
)

summary(pl_vow_lm)

pl_vow_lm_null <- lmer(
    vowel.duration ~
#        c2phonation +
        vowel +
        c2place +
        sentence.duration +
        (1+c2phonation|speaker) +
        (1|word),
    data = filter(vowels, language == "polish")
)

anova(pl_vow_lm_null, pl_vow_lm)
```

```{r pl-vow-lm-3-plot}
plot(allEffects(pl_vow_lm))
plot(fitted(pl_vow_lm),residuals(pl_vow_lm))
qqnorm(resid(pl_vow_lm))

```

```{r pl-lm-slopes}
ranef(pl_vow_lm)$speaker
sjp.lmer(pl_vow_lm, type = "rs.ri", vars = "vowel.duration")
```

Voicing is a significant predictor, although one speaker pl05 has a very strong VE while the other three don't (theyh have a slightly opposite effect).

# Closure durations

## Polish

```{r}
vowels %>%
    filter(language == "polish") %>%
    ggplot(aes(c2phonation, closure.duration)) +
    geom_boxplot() +
    facet_grid(. ~ speaker)
```

```{r}
vowels %>%
    filter(language == "polish") %>%
    ggplot(aes(closure.duration, vowel.duration)) +
    geom_smooth(method = "lm") +
    facet_grid(. ~ speaker)
```

```{r}
pl_clos_lm <- lmer(
    vowel.duration ~
        closure.duration +
        vowel +
        sentence.duration +
        (1+closure.duration|speaker) +
        (1|word),
    data = filter(vowels, language == "polish")
)

summary(pl_clos_lm)

pl_clos_lm_null <- lmer(
    vowel.duration ~
#        closure.duration +
        vowel +
        sentence.duration +
        (1+closure.duration|speaker) +
        (1|word),
    data = filter(vowels, language == "polish")
)

anova(pl_clos_lm_null, pl_clos_lm)
```

```{r}
plot(allEffects(pl_clos_lm))
```

```{r pl-lm-slopes}
ranef(pl_clos_lm)$speaker
sjp.lmer(pl_clos_lm, type = "rs.ri", vars = "vowel.duration")
```

```{r}
pl_clos_lm <- lmer(
    vowel.duration ~
        c2.duration +
        vowel +
        sentence.duration +
        (1+c2.duration|speaker) +
        (1|word),
    data = filter(vowels, language == "polish")
)

summary(pl_clos_lm)

pl_clos_lm_null <- lmer(
    vowel.duration ~
#        closure.duration +
        vowel +
        sentence.duration +
        (1+closure.duration|speaker) +
        (1|word),
    data = filter(vowels, language == "polish")
)

anova(pl_clos_lm_null, pl_clos_lm)
```

Closure duration rather than consonant duration seems to be a slighlty better predictor (coefficient -0.38 vs -0.3).
No significant interactions.
