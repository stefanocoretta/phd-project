---
title: "Ultrafest analysis"
author: "Stefano Coretta"
date: "10/08/2017"
output: 
  html_document: 
    highlight: tango
    number_sections: yes
    theme: readable
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir=normalizePath("../../"))
library(tidyverse)
theme_set(theme_minimal())
library(rticulate)
library(stringr)
library(scales)
library(tidymv)
library(itsadug)
options(contrasts = rep ("contr.treatment", 2))
```

# Import data

```{r tongues}
languages <- read_csv("voicing-effect/stimuli/languages.csv")
words <- read_csv("voicing-effect/stimuli/nonce.csv")

columns <- c(
    "speaker",
    "seconds",
    "rec.date",
    "prompt",
    "label",
    "TT.displacement.sm",
    "TT.velocity",
    "TT.velocity.abs",
    "TD.displacement.sm",
    "TD.velocity",
    "TD.velocity.abs"
)

aaa.files <- list.files(
    path = "./voicing-effect/results/ultrasound",
    pattern = "*-tongue-cart.tsv",
    full.names = TRUE
)

tongues <- read_aaa(
    aaa.files,
    columns, 
    na.rm = TRUE
) %>%
    mutate(word = word(prompt, 2)) %>%
    left_join(y = languages) %>%
    left_join(y = words) %>%
    mutate_if(is.character, as.factor) %>%
    group_by(speaker) %>%
    mutate(
        X.re = rescale(X),
        Y.re = rescale(Y)
    ) %>%
    ungroup() %>%
    mutate(
        vowel.ord = ordered(vowel, levels = c("a", "o", "u")),
        c2place.ord = ordered(c2place, levels = c("coronal", "velar")),
        c2phonation.ord = ordered(c2phonation, levels = c("voiceless", "voiced"))
    )

max <- tongues %>%
    filter(label %in% c("max_TT", "max_TD"), vowel != "u") %>%
    arrange(rec.date, fan.line) %>%
    create_event_start("rec.date")

max_it_12 <- max %>%
    filter(speaker %in% c("it01", "it02"))

max_pl_23 <- max %>%
    filter(speaker %in% c("pl02", "pl03"))

max_pl_34 <- max %>%
    filter(speaker %in% c("pl03", "pl04"))

aaa_files_clos <- list.files(
    path = "./voicing-effect/results/ultrasound",
    pattern = "*-tongue-clos-cart.tsv",
    full.names = TRUE
)

tongues_clos <- read_aaa(
    aaa_files_clos,
    columns, 
    na.rm = TRUE
) %>%
    mutate(word = word(prompt, 2)) %>%
    left_join(y = languages) %>%
    left_join(y = words) %>%
    mutate_if(is.character, as.factor) %>%
    group_by(speaker) %>%
    mutate(
        X.re = rescale(X),
        Y.re = rescale(Y)
    ) %>%
    ungroup() %>%
    mutate(
        vowel.ord = ordered(vowel, levels = c("a", "o", "u")),
        c2place.ord = ordered(c2place, levels = c("coronal", "velar")),
        c2phonation.ord = ordered(c2phonation, levels = c("voiceless", "voiced"))
    ) %>%
    arrange(rec.date, fan.line) %>%
    create_event_start("rec.date")
```


# Exploration

```{r coronal-it}
max %>%
    filter(c2place == "coronal", language == "italian") %>%
    plot_tongue(geom = "point", alpha = 0.5) +
    aes(colour = c2phonation) +
    facet_grid(vowel ~ speaker)
```

```{r velar-it}
max %>%
    filter(c2place == "velar", language == "italian") %>%
    plot_tongue(geom = "point", alpha = 0.5) +
    aes(colour = c2phonation) +
    facet_grid(vowel ~ speaker)
```

```{r coronal-pl}
max %>%
    filter(c2place == "coronal", language == "polish") %>%
    ggplot(aes(X, Y, colour = c2phonation)) +
    geom_point(alpha = 0.5) +
    facet_grid(vowel ~ speaker) +
    coord_fixed(1.5)
```

```{r coronal-pl-re}
max %>%
    filter(c2place == "coronal", language == "polish") %>%
    ggplot(aes(X.re, Y.re, colour = c2phonation)) +
    geom_point(alpha = 0.5) +
    facet_grid(speaker ~ vowel) +
    coord_fixed(0.7)
```

```{r velar-pl}
max %>%
    filter(c2place == "velar", language == "polish") %>%
    ggplot(aes(X, Y, colour = c2phonation)) +
    geom_point(alpha = 0.5) +
    facet_grid(vowel ~ speaker) +
    coord_fixed(0.7)
```

```{r velar-pl-re}
max %>%
    filter(c2place == "velar", language == "polish") %>%
    ggplot(aes(X.re, Y.re, colour = c2phonation)) +
    geom_point(alpha = 0.5) +
    facet_grid(speaker ~ vowel) +
    coord_fixed(0.7)
```

# Testing

Comparing fixed effects models works best with ML, otherwise you can use fREML with AIC for fixed effects, but if there is an AR1 model cannot use AIC, so need ML.

## Polish

```{r eval=FALSE}
pl.m1 <- bam(
    Y.re ~
        X.re +
        s(X.re, bs = "cr") +
        s(X.re, by = c2phonation.ord, bs = "cr") +
        s(X.re, by = c2place.ord, bs = "cr") +
        s(X.re, by = vowel.ord, bs = "cr") +
        s(X.re, rec.date, bs = "fs", xt = "cr", m = 1, k = 5) +
        s(X.re, speaker, bs = "fs", xt = "cr", m = 1, k = 5),
    data = max_pl_23,
    method = "fREML"
)

rho <- start_value_rho(pl.m1)

pl.m1.ar <- bam(
    Y.re ~
        X.re +
        s(X.re, bs = "cr") +
        s(X.re, by = c2phonation.ord, bs = "cr") +
        s(X.re, by = c2place.ord, bs = "cr") +
        s(X.re, by = vowel.ord, bs = "cr") +
        s(X.re, rec.date, bs = "fs", xt = "cr", m = 1, k = 5) +
        s(X.re, speaker, bs = "fs", xt = "cr", m = 1, k = 5),
    data = max_pl_23,
    method = "fREML",
    rho = rho,
    AR.start = max_pl_23$start.event
)

summary(pl.m1)

pl.m1.null <- bam(
    Y.re ~
        X.re +
        s(X.re, bs = "cr") +
        s(X.re, by = c2place.ord, bs = "cr") +
        s(X.re, by = vowel.ord, bs = "cr") +
        s(X.re, rec.date, bs = "fs", xt = "cr", m = 1, k = 5) +
        s(X.re, speaker, bs = "fs", xt = "cr", m = 1, k = 5),
    data = max_pl_23,
    method = "fREML"
)

compareML(pl.m1, pl.m1.null)
```

```{r eval=FALSE}
plot_smooth(
    pl.m1,
    view = "X.re",
    plot_all= "c2phonation.ord",
    cond = list("c2place.ord" = "coronal"),
    rug = FALSE
)
plot_diff(
    pl.m1,
    view = "X.re",
    comp = list(c2phonation.ord = c("voiceless", "voiced")),
    cond = list("c2place.ord" = "coronal")
)
```

```{r eval=FALSE}
plot_gamsd(
    pl.m1,
    view = "X.re",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
```

```{r eval=FALSE}
plot_gamsd(
    pl.m1.ar,
    view = "X.re",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
```

### PL02

```{r}
pl02_max <- filter(max, speaker == "pl02", X > -20)

pl02.m1 <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl02_max,
    method = "ML"
)

rho <- start_value_rho(pl02.m1)

pl02.m1.ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl02_max,
    method = "ML",
    rho = rho,
    AR.start = pl02_max$start.event
)

summary(pl02.m1)

pl02.m1.null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl02_max,
    method = "ML"
)

compareML(pl02.m1, pl02.m1.null)
```

```{r}
plot_gamsd(
    pl02.m1.ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
```

### PL03

```{r}
pl03_max <- filter(max, speaker == "pl03")

pl03.m1 <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl03_max,
    method = "fREML"
)

rho <- start_value_rho(pl03.m1)

pl03.m1.ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl03_max,
    method = "ML",
    rho = rho,
    AR.start = pl03_max$start.event
)

pl03.m1.ar.null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl03_max,
    method = "ML",
    rho = rho,
    AR.start = pl03_max$start.event
)

summary(pl03.m1)

pl03.m1.null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl03_max,
    method = "ML"
)

compareML(pl03.m1.ar, pl03.m1.ar.null)
```

```{r}
plot_gamsd(
    pl03.m1.ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "velar")
)
```

### PL04

```{r}
filter(max, speaker == "pl04") %>%
    ggplot(aes(X, Y, colour = c2phonation)) +
    geom_point(alpha = 0.5) +
    facet_grid(vowel ~ c2place)
```

```{r}
filter(max, speaker == "pl04", X > -30) %>%
    ggplot(aes(X, Y, colour = c2phonation)) +
    geom_point(alpha = 0.5) +
    facet_grid(vowel ~ c2place)
```

```{r}
pl04_max <- filter(max, speaker == "pl04", X > -30)

pl04.m1 <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl04_max,
    method = "fREML"
)

rho <- start_value_rho(pl04.m1)

pl04.m1.ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl04_max,
    method = "ML",
    rho = rho,
    AR.start = pl04_max$start.event
)

pl04.m1.ar.null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl04_max,
    method = "ML",
    rho = rho,
    AR.start = pl04_max$start.event
)

summary(pl04.m1.ar)

pl04.m1.null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl04_max,
    method = "fREML"
)

# compareML(pl04.m1, pl04.m1.null)
compareML(pl04.m1.ar, pl04.m1.ar.null)
```

```{r}
plot_gamsd(
    pl04.m1.ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)

ggsave("presentations/2017-ultrafest/pl04.pdf", width = 6, height = 4)
```

```{r}
acf_plot(resid(pl04.m1.ar), split_by=list(pl04_max$rec.date))
acf_resid(pl04.m1.ar, split_pred = "AR.start")
```

```{r}
pl04_a <- filter(max, speaker == "pl04", vowel == "a")

pl04.m1 <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl04_a,
    method = "fREML"
)

rho <- start_value_rho(pl04.m1)

pl04.m1.ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl04_a,
    method = "ML",
    rho = rho,
    AR.start = pl04_a$start.event
)

pl04.m1.ar.null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl04_a,
    method = "ML",
    rho = rho,
    AR.start = pl04_a$start.event
)

summary(pl04.m1.ar)
compareML(pl04.m1.ar, pl04.m1.ar.null)
```

If only /a/ is used, no significance at all. With /o/ and X > -30, no significance, but with all X some significant difference at the very left end of the tongue.

```{r}
plot_gamsd(
    pl04.m1.ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
```

### PL03-PL04

```{r pl34, eval=FALSE}
pl34.m1 <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5) +
        s(X, speaker, bs = "fs", xt = "cr", m = 1, k = 5),
    data = max_pl_34,
    method = "fREML"
)

rho <- start_value_rho(pl34.m1)

pl34.m1.ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5) +
        s(X, speaker, bs = "fs", xt = "cr", m = 1, k = 5),
    data = max_pl_34,
    method = "ML",
    rho = rho,
    AR.start = max_pl_34$start.event
)

pl34.m1.ar.null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5) +
        s(X, speaker, bs = "fs", xt = "cr", m = 1, k = 5),
    data = max_pl_34,
    method = "ML",
    rho = rho,
    AR.start = max_pl_34$start.event
)

summary(pl34.m1.ar)
compareML(pl34.m1.ar, pl34.m1.ar.null)
```

```{r eval=FALSE}
plot_gamsd(
    pl34.m1.ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "velar", speaker = "pl04")
)
```

The models with X, Y are not reliable because the tongue size differs a lot between speakers.

```{r pl34-re, eval=FALSE}
pl34.m1.re <- bam(
    Y.re ~
        X.re +
        s(X.re, bs = "cr") +
        s(X.re, by = c2phonation.ord, bs = "cr") +
        s(X.re, by = c2place.ord, bs = "cr") +
        s(X.re, by = vowel.ord, bs = "cr") +
        s(X.re, rec.date, bs = "fs", xt = "cr", m = 1, k = 5) +
        s(X.re, speaker, bs = "fs", xt = "cr", m = 1, k = 5),
    data = max_pl_34,
    method = "fREML"
)

rho <- start_value_rho(pl34.m1.re)

pl34.m1.ar.re <- bam(
    Y.re ~
        X.re +
        s(X.re, bs = "cr") +
        s(X.re, by = c2phonation.ord, bs = "cr") +
        s(X.re, by = c2place.ord, bs = "cr") +
        s(X.re, by = vowel.ord, bs = "cr") +
        s(X.re, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = max_pl_34,
    method = "ML",
    rho = rho,
    AR.start = max_pl_34$start.event
)

pl34.m1.ar.re.null <- bam(
    Y.re ~
        X.re +
        s(X.re, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X.re, by = c2place.ord, bs = "cr") +
        s(X.re, by = vowel.ord, bs = "cr") +
        s(X.re, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = max_pl_34,
    method = "ML",
    rho = rho,
    AR.start = max_pl_34$start.event
)

summary(pl34.m1.ar.re)
compareML(pl34.m1.ar.re, pl34.m1.ar.re.null)
```

```{r eval=FALSE}
plot_gamsd(
    pl34.m1.ar.re,
    view = "X.re",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
plot_gamsd(
    pl34.m1.ar.re,
    view = "X.re",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "velar")
)
```

## Italian

it01 and it02 have TRA at maximum displacement.

```{r}
it.m1 <- bam(
    Y.re ~
        X.re +
        s(X.re, bs = "cr") +
        s(X.re, by = c2phonation.ord, bs = "cr") +
        s(X.re, by = c2place.ord, bs = "cr") +
        s(X.re, by = vowel.ord, bs = "cr") +
        s(X.re, rec.date, bs = "fs", xt = "cr", m = 1, k = 5) +
        s(X.re, speaker, bs = "fs", xt = "cr", m = 1, k = 5),
    data = max_it_12,
    method = "fREML"
)

rho <- start_value_rho(it.m1)

it.m1.ar <- bam(
    Y.re ~
        X.re +
        s(X.re, bs = "cr") +
        s(X.re, by = c2phonation.ord, bs = "cr") +
        s(X.re, by = c2place.ord, bs = "cr") +
        s(X.re, by = vowel.ord, bs = "cr") +
        s(X.re, rec.date, bs = "fs", xt = "cr", m = 1, k = 5) +
        s(X.re, speaker, bs = "fs", xt = "cr", m = 1, k = 5),
    data = max_it_12,
    method = "ML",
    rho = rho,
    AR.start = max_it_12$start.event
)

summary(it.m1.ar)

it.m1.ar.null <- bam(
    Y.re ~
        X.re +
        s(X.re, bs = "cr") +
#        s(X.re, by = c2phonation.ord, bs = "cr") +
        s(X.re, by = c2place.ord, bs = "cr") +
        s(X.re, by = vowel.ord, bs = "cr") +
        s(X.re, rec.date, bs = "fs", xt = "cr", m = 1, k = 5) +
        s(X.re, speaker, bs = "fs", xt = "cr", m = 1, k = 5),
    data = max_it_12,
    method = "ML",
    rho = rho,
    AR.start = max_it_12$start.event
)

it.m1.null <- bam(
    Y.re ~
        X.re +
        s(X.re, bs = "cr") +
        s(X.re, by = c2place.ord, bs = "cr") +
        s(X.re, by = vowel.ord, bs = "cr") +
        s(X.re, rec.date, bs = "fs", xt = "cr", m = 1, k = 5) +
        s(X.re, speaker, bs = "fs", xt = "cr", m = 1, k = 5),
    data = max_it_12,
    method = "ML"
)

compareML(it.m1.ar, it.m1.ar.null)
```

```{r}
plot_gamsd(
    it.m1.ar,
    view = "X.re",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
```

### IT01

```{r}
it01_max <- filter(max, speaker == "it01")

it01.m1 <- bam(
    Y ~
        X.re +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it01_max,
    method = "fREML"
)

rho <- start_value_rho(it01.m1)

it01.m1.ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it01_max,
    method = "ML",
    rho = rho,
    AR.start = it01_max$start.event
)

summary(it01.m1.ar)

it01.m1.ar.null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it01_max,
    method = "ML",
    rho = rho,
    AR.start = it01_max$start.event
)

compareML(it01.m1.ar, it01.m1.ar.null)
```

```{r}
plot_gamsd(
    it01.m1.ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)

ggsave("presentations/2017-ultrafest/it01.pdf", width = 6, height = 4)
```

### IT02

```{r}
it02_max <- filter(max, speaker == "it02")

it02.m1 <- bam(
    Y ~
        X.re +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it02_max,
    method = "fREML"
)

rho <- start_value_rho(it02.m1)

it02.m1.ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it02_max,
    method = "ML",
    rho = rho,
    AR.start = it02_max$start.event
)

summary(it02.m1.ar)

it02.m1.ar.null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it02_max,
    method = "ML",
    rho = rho,
    AR.start = it02_max$start.event
)

compareML(it02.m1.ar, it02.m1.ar.null)
```

```{r}
plot_gamsd(
    it02.m1.ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
```

# Italian tongue at closure

```{r}
tongues_clos %>%
    filter(c2place == "coronal", language == "italian") %>%
    plot_tongue(geom = "point", alpha = 0.5) +
    aes(colour = c2phonation) +
    facet_grid(vowel ~ speaker)
```


## IT01

```{r it01-clos}
it01_clos <- tongues_clos %>%
    filter(speaker == "it01", vowel != "u")
```

```{r it01-clos-gamm}
it01_clos_m1 <- bam(
    Y ~
        X.re +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it01_clos,
    method = "fREML"
)

rho <- start_value_rho(it01_clos_m1)

it01_clos_m1_ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it01_clos,
    method = "ML",
    rho = rho,
    AR.start = it01_clos$start.event
)

summary(it01_clos_m1_ar)

it01_clos_m1_ar_null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it01_clos,
    method = "ML",
    rho = rho,
    AR.start = it01_clos$start.event
)

compareML(it01_clos_m1_ar, it01_clos_m1_ar_null)
```

```{r plot-it01-clos-gamm}
plot_gamsd(
    it01_clos_m1_ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)

ggsave("presentations/2017-ultrafest/it01-clos.pdf", width = 6, height = 4)
```

## IT02

```{r it02-clos}
it02_clos <- tongues_clos %>%
    filter(speaker == "it02", vowel != "u")
```

```{r it02-clos-gamm}
it02_clos_m1 <- bam(
    Y ~
        X.re +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it02_clos,
    method = "fREML"
)

rho <- start_value_rho(it02_clos_m1)

it02_clos_m1_ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it02_clos,
    method = "ML",
    rho = rho,
    AR.start = it02_clos$start.event
)

summary(it02_clos_m1_ar)

it02_clos_m1_ar_null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it02_clos,
    method = "ML",
    rho = rho,
    AR.start = it02_clos$start.event
)

compareML(it02_clos_m1_ar, it02_clos_m1_ar_null)
```

```{r plot-it02-clos-gamm}
plot_gamsd(
    it02_clos_m1_ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
```

Both it01 and it02 show TRA at closure. It is difficult to quantify the difference compared to TRA at maximum displacement. Need a model to check that.



# Polish tongue at closure

## PL02

```{r pl02-clos}
pl02_clos <- tongues_clos %>%
    filter(speaker == "pl02", vowel != "u", X > -21)
```

```{r pl02-clos-gamm}
pl02_clos_m1 <- bam(
    Y ~
        X.re +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl02_clos,
    method = "fREML"
)

rho <- start_value_rho(pl02_clos_m1)

pl02_clos_m1_ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl02_clos,
    method = "ML",
    rho = rho,
    AR.start = pl02_clos$start.event
)

summary(pl02_clos_m1_ar)

pl02_clos_m1_ar_null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl02_clos,
    method = "ML",
    rho = rho,
    AR.start = pl02_clos$start.event
)

compareML(pl02_clos_m1_ar, pl02_clos_m1_ar_null)
```

```{r plot-pl02-clos-gamm}
plot_gamsd(
    pl02_clos_m1_ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
```

## PL04

```{r pl04-clos}
pl04_clos <- tongues_clos %>%
    filter(speaker == "pl04", vowel != "u")
```

```{r pl04-clos-gamm}
pl04_clos_m1 <- bam(
    Y ~
        X.re +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl04_clos,
    method = "fREML"
)

rho <- start_value_rho(pl04_clos_m1)

pl04_clos_m1_ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl04_clos,
    method = "ML",
    rho = rho,
    AR.start = pl04_clos$start.event
)

summary(pl04_clos_m1_ar)

pl04_clos_m1_ar_null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl04_clos,
    method = "ML",
    rho = rho,
    AR.start = pl04_clos$start.event
)

compareML(pl04_clos_m1_ar, pl04_clos_m1_ar_null)
```

```{r plot-pl04-clos-gamm}
plot_gamsd(
    pl04_clos_m1_ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)

ggsave("presentations/2017-ultrafest/pl04-clos.pdf", width = 6, height = 4)
```
