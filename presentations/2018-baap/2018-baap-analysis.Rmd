---
title: "2018 BAAP analysis"
author: "Stefano Coretta"
date: "05/03/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = normalizePath("../../"))
library(tidyverse)
theme_set(theme_minimal())
library(lme4)
library(effects)
library(mgcv)
library(itsadug)
library(tidymv)
library(rticulate)
```

# Data import

```{r read-data}
columns <- c(
  "speaker",
  "seconds",
  "rec_date",
  "prompt",
  "label",
  "TT_displacement_sm",
  "TT_velocity",
  "TT_velocity_abs",
  "TD_displacement_sm",
  "TD_velocity",
  "TD_velocity_abs"
)

speakers <- read_csv("./voicing-effect/data/datasets/speakers.csv")
stimuli <- read_csv("./voicing-effect/data/datasets/stimuli.csv")

splines <- list.files(
  path = "./presentations/2018-baap/datasets/ultrasound",
  pattern = "*-tongue-cart.tsv",
  full.names = TRUE
) %>%
  map_df(~read_aaa(., columns)) %>%
  mutate(word = word(prompt, 2)) %>%
  left_join(y = speakers) %>%
  left_join(y = stimuli) %>%
  mutate(
    c2_phonation = ordered(c2_phonation, levels = c("voiceless", "voiced")),
    vowel = ordered(vowel, levels = c("a", "o", "u")),
    c2_place = ordered(c2_place, levels = c("coronal", "velar")),
    vow_phon = as.ordered(interaction(vowel, c2_phonation)),
    c2_place_phon = as.ordered(interaction(c2_place, c2_phonation))
  ) %>%
  mutate_if(is.character, as.factor) %>%
  arrange(rec_date, fan_line) %>%
  create_event_start("rec_date")

splines_closure <- list.files(
  path = "./presentations/2018-baap/datasets/ultrasound",
  pattern = "*-tongue-clos-cart.tsv",
  full.names = TRUE
) %>%
  map_df(~read_aaa(., columns)) %>%
  mutate(word = word(prompt, 2)) %>%
  left_join(y = speakers) %>%
  left_join(y = stimuli) %>%
  mutate(
    c2_phonation = ordered(c2_phonation, levels = c("voiceless", "voiced")),
    vowel = ordered(vowel, levels = c("a", "o", "u")),
    c2_place = ordered(c2_place, levels = c("coronal", "velar")),
    vow_phon = as.ordered(interaction(vowel, c2_phonation)),
    c2_place_phon = as.ordered(interaction(c2_place, c2_phonation))
  ) %>%
  mutate_if(is.character, as.factor) %>%
  arrange(rec_date, fan_line) %>%
  create_event_start("rec_date")

# need to add contrast treatment

vowels <- list.files(
  path = "./presentations/2018-baap/datasets/acoustics/",
  pattern = "*-durations.csv",
  full.names = TRUE
) %>%
  map_df(~read_csv(., na = "--undefined--")) %>%
  left_join(y = speakers) %>%
  left_join(y = stimuli) %>%
  mutate(c2_phonation = factor(c2_phonation, levels = c("voiceless", "voiced"))) %>%
  mutate_if(is.character, as.factor)
```

# Data viz

## Vowel duration

```{r vowdur-dens}
vowels %>%
  ggplot(aes(vowel_duration, fill = c2_phonation, colour = c2_phonation)) +
  geom_density(alpha = 0.2) +
  facet_grid(~ language)
```

```{r vowdur-dens}
vowels %>%
  group_by(speaker) %>%
  mutate(vowel_duration = scale(vowel_duration)) %>%
  ggplot(aes(vowel_duration, fill = c2_phonation, colour = c2_phonation)) +
  geom_density(alpha = 0.2) +
  facet_grid(~ language)
```

```{r vowdur-box}
vowels %>%
  ggplot(aes(c2_phonation, vowel_duration)) +
  geom_boxplot() +
  facet_grid(~ language)
```

```{r vowdur-box-speakers}
vowels %>%
  ggplot(aes(c2_phonation, vowel_duration)) +
  geom_boxplot() +
  facet_wrap(~ speaker, ncol = 4, scales = "free")
```

```{r vowdur-box-speakers-vowels}
vowels %>%
  ggplot(aes(c2_phonation, vowel_duration, fill = vowel)) +
  geom_boxplot() +
  facet_wrap(~ speaker, ncol = 4, scales = "free")
```

```{r vowdur-norm}
vowels %>%
  group_by(speaker) %>%
  mutate(vowel_duration = scale(vowel_duration)) %>%
  ggplot(aes(c2_phonation, vowel_duration)) +
  geom_boxplot() +
  facet_grid(~ language)
```

```{r vowdur-norm-vowels}
vowels %>%
  group_by(speaker) %>%
  mutate(vowel_duration = scale(vowel_duration)) %>%
  ggplot(aes(vowel, vowel_duration, fill = c2_phonation)) +
  geom_boxplot() +
  facet_grid(~ language)
```

```{r it-vowdur-norm-vowels}
vowels %>%
  filter(language == "italian") %>%
  group_by(speaker) %>%
  mutate(vowel_duration = scale(vowel_duration)) %>%
  ggplot(aes(vowel, vowel_duration, fill = c2_phonation)) +
  geom_boxplot() +
  facet_wrap(~ speaker, ncol = 2)
```

```{r pl-vowdur-norm-vowels}
vowels %>%
  filter(language == "polish") %>%
  group_by(speaker) %>%
  mutate(vowel_duration = scale(vowel_duration)) %>%
  ggplot(aes(vowel, vowel_duration, fill = c2_phonation)) +
  geom_boxplot() +
  facet_wrap(~ speaker, ncol = 2)
```


## Ultrasound

```{r it-coronal-tongue}
splines %>%
  filter(
    language == "italian",
    label == "max_TT"
  ) %>%
  ggplot(aes(X, Y, colour = c2_phonation)) +
  geom_point(size = 0.5) +
  facet_grid(vowel ~ speaker) +
  coord_fixed(ratio = 1) +
  theme(legend.position = "top")
```

```{r it-coronal-tongue-fan}
splines %>%
  filter(
    language == "italian",
    label == "max_TT"
  ) %>%
  ggplot(aes(fan_line, Y, colour = c2_phonation)) +
  geom_point(size = 0.5) +
  facet_grid(vowel ~ speaker) +
  theme(legend.position = "top")
```

```{r it-velar-tongue}
splines %>%
  filter(
    language == "italian",
    label == "max_TD"
  ) %>%
  ggplot(aes(X, Y, colour = c2_phonation)) +
  geom_point(size = 0.5) +
  facet_grid(vowel ~ speaker) +
  coord_fixed(ratio = 1) +
  theme(legend.position = "top")
```

```{r it-velar-tongue-fan}
splines %>%
  filter(
    language == "italian",
    label == "max_TD"
  ) %>%
  ggplot(aes(fan_line, Y, colour = c2_phonation)) +
  geom_point(size = 0.5) +
  facet_grid(vowel ~ speaker) +
  theme(legend.position = "top")
```

```{r pl-coronal-tongue}
splines %>%
  filter(
    language == "polish",
    label == "max_TT"
  ) %>%
  ggplot(aes(X, Y, colour = c2_phonation)) +
  geom_point(size = 0.5) +
  facet_grid(vowel ~ speaker) +
  coord_fixed(ratio = 1) +
  theme(legend.position = "top")
```

```{r pl-velar-tongue}
splines %>%
  filter(
    language == "polish",
    label == "max_TD"
  ) %>%
  ggplot(aes(X, Y, colour = c2_phonation)) +
  geom_point(size = 0.5) +
  facet_grid(vowel ~ speaker) +
  coord_fixed(ratio = 1) +
  theme(legend.position = "top")
```

# Vowel duration

```{r vow-it-lm}
vowels_it <- filter(vowels, language == "italian")

vowels_it_lm <- lmer(
  vowel_duration ~
    c2_phonation +
    c2_place +
    vowel +
    c2_phonation:vowel +
    sentence_duration +
    (1+c2_phonation|speaker) +
    (1|word),
  data = vowels_it,
  REML = FALSE
)

vowels_it_lm_null <- lmer(
  vowel_duration ~
#    c2_phonation +
    c2_place +
    vowel +
#    c2_phonation:vowel +
    sentence_duration +
    (1+c2_phonation|speaker) +
    (1|word),
  data = vowels_it,
  REML = FALSE
)

anova(vowels_it_lm_null, vowels_it_lm)

summary(vowels_it_lm)
```

```{r vow-it-effects}
plot(allEffects(vowels_it_lm))
```

```{r vow-pl-lm}
vowels_pl <- filter(vowels, language == "polish")

vowels_pl_lm <- lmer(
  vowel_duration ~
    c2_phonation +
    c2_place +
    vowel +
    c2_phonation:vowel +
    c2_place:vowel +
    sentence_duration +
    (1+c2_phonation|speaker) +
    (1|word),
  data = vowels_pl,
  REML = FALSE
)

vowels_pl_lm_null <- lmer(
  vowel_duration ~
#    c2_phonation +
    c2_place +
    vowel +
#    c2_phonation:vowel +
    c2_place:vowel +
    sentence_duration +
    (1+c2_phonation|speaker) +
    (1|word),
  data = vowels_pl,
  REML = FALSE
)

anova(vowels_pl_lm_null, vowels_pl_lm)

summary(vowels_pl_lm)
```

```{r vow-pl-lm}
plot(allEffects(vowels_pl_lm))
```

```{r vowels-lm}
vowels_lm <- lmer(
  vowel_duration ~
    c2_phonation +
    language +
    c2_place +
    vowel +
    c2_phonation:vowel +
    language:vowel +
#    c2_phonation:language +
    sentence_duration +
    (1+c2_phonation|speaker) +
    (1|word),
  data = vowels,
  REML = FALSE
)
summary(vowels_lm)
```

```{r vowels-lm-effects}
plot(allEffects(vowels_lm))
```

```{r vowels-lm-ranef}
round(ranef(vowels_lm)$speaker, 2)
round(ranef(vowels_lm)$speaker$c2_phonationvoiced, 1)
round(coef(vowels_lm)$speaker[1:2], 1)
```



# Polar GAMs

## Italian maximum constriction

### IT01

```{r it01}
it01 <- filter(splines, speaker == "it01", label %in% c("max_TT", "max_TD"))
```

```{r it01-polar-gam}
it01_polar_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
#    vow_phon +
#    c2_place_phon +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
#    s(X, by = vow_phon, bs = "cr") +
#    s(X, by = c2_place_phon, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it01,
  method = "ML"
)
summary(it01_polar_gam)
```

No need for interactions.

```{r it01-polar-smooths}
plot_polar_smooths(
  it01_polar_gam,
  X,
  c2_phonation,
  facet_terms = c2_place + vowel
)
```

```{r it01-polar-gam-null}
it01_polar_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
    c2_place +
#    vow_phon +
#    c2_place_phon +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
#    s(X, by = vow_phon, bs = "cr") +
#    s(X, by = c2_place_phon, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it01,
  method = "ML"
)

compareML(it01_polar_gam_null, it01_polar_gam)
```

```{r it01-acf}
acf_plot(resid(it01_polar_gam), split_by = list(it01$rec_date))
```

```{r it01-ar}
rho <- start_value_rho(it01_polar_gam)

it01_polar_gam_ar <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it01,
  method = "ML",
  rho = rho,
  AR_start = it01$start.event
)
summary(it01_polar_gam_ar)

it01_polar_gam_ar_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it01,
  method = "ML",
  rho = rho,
  AR_start = it01$start.event
)

compareML(it01_polar_gam_ar_null, it01_polar_gam_ar)
```

```{r it01-ar-acf}
acf_resid(it01_polar_gam_ar, split_pred = "AR.start")
```

```{r it01-polar-ar-smooths}
plot_polar_smooths(
  it01_polar_gam_ar,
  X,
  c2_phonation,
  facet_terms = c2_place + vowel
) +
  labs(title = "IT01")
ggsave("./presentations/2018-baap/graphics/it01-uti.pdf", width = 7, height = 4)
```

### IT02

```{r it02}
it02 <- filter(splines, speaker == "it02", label %in% c("max_TT", "max_TD"), fan_line > 5, fan_line < 40)
```

```{r it02-polar-gam}
it02_polar_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
#    vow_phon +
#    c2_place_phon +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
#    s(X, by = vow_phon, bs = "cr") +
#    s(X, by = c2_place_phon, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it02,
  method = "ML"
)
summary(it02_polar_gam)
```

```{r it02-polar-smooth}
plot_polar_smooths(
  it02_polar_gam,
  X,
  c2_phonation,
  facet_terms = c2_place + vowel
) +
  labs(title = "IT02")
ggsave("./presentations/2018-baap/graphics/it02-uti.pdf", width = 7, height = 4)
```

```{r it02-polar-gam-null}
it02_polar_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
    c2_place +
#    vow_phon +
#    c2_place_phon +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
#    s(X, by = vow_phon, bs = "cr") +
#    s(X, by = c2_place_phon, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it02,
  method = "ML"
)

compareML(it02_polar_gam_null, it02_polar_gam)
```

```{r it02-acf}
acf_resid(it02_polar_gam, split_pred = list(it02$rec_date))
```

ACF looks fine.

### IT03

```{r it03}
it03 <- filter(splines, speaker == "it03", label %in% c("max_TT", "max_TD"), fan_line < 40, vowel == "a")
```

```{r it03-polar-gam}
it03_polar_gam <- polar_gam(
  Y ~
    c2_phonation +
#    vowel +
    c2_place +
#    vow_phon +
#    c2_place_phon +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
#    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
#    s(X, by = vow_phon, bs = "cr") +
#    s(X, by = c2_place_phon, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it03,
  method = "ML"
)
summary(it03_polar_gam)
```

```{r it03-polar-gam-null}
it03_polar_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
#    vowel +
    c2_place +
#    vow_phon +
#    c2_place_phon +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
#    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
#    s(X, by = vow_phon, bs = "cr") +
#    s(X, by = c2_place_phon, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it03,
  method = "ML"
)

compareML(it03_polar_gam_null, it03_polar_gam)
```

```{r it03-polar-smooth}
plot_polar_smooths(
  it03_polar_gam,
  X,
  c2_phonation,
  facet_terms = c2_place
)
```

```{r it03-ar}
rho <- start_value_rho(it03_polar_gam)

it03_polar_gam_ar <- polar_gam(
  Y ~
    c2_phonation +
#    vowel +
    c2_place +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
#    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it03,
  method = "ML",
  rho = rho,
  AR_start = it03$start.event
)
summary(it03_polar_gam_ar)

it03_polar_gam_ar_null <- polar_gam(
  Y ~
#    c2_phonation +
#    vowel +
    c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
#    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it03,
  method = "ML",
  rho = rho,
  AR_start = it03$start.event
)

compareML(it03_polar_gam_ar_null, it03_polar_gam_ar)
```

```{r it03-ar-acf}
acf_resid(it03_polar_gam_ar, split_pred = "AR.start")
```

```{r it03-polar-smooth}
plot_polar_smooths(
  it03_polar_gam_ar,
  X,
  c2_phonation,
  facet_terms = c2_place
)
```

IT03 has TRA at maximum displacement only in /a/.

### IT04

```{r it04}
it04 <- filter(splines, speaker == "it04", label %in% c("max_TT", "max_TD"))
```

```{r it04-polar-gam}
it04_polar_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
#    vow_phon +
#    c2_place_phon +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
#    s(X, by = vow_phon, bs = "cr") +
#    s(X, by = c2_place_phon, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it04,
  method = "ML"
)
summary(it04_polar_gam)
```

```{r it04-polar-gam-null}
it04_polar_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
    c2_place +
#    vow_phon +
#    c2_place_phon +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
#    s(X, by = vow_phon, bs = "cr") +
#    s(X, by = c2_place_phon, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it04,
  method = "ML"
)

compareML(it04_polar_gam_null, it04_polar_gam)
```

```{r it04-acf}
acf_resid(it04_polar_gam, split_pred = list(it04$rec_date))
```

## Polish maximum constriction

### PL02

```{r pl02}
pl02 <- filter(splines, speaker == "pl02", label %in% c("max_TT", "max_TD"))
```

```{r pl02-polar-gam}
pl02_polar_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
#    vow_phon +
#    c2_place_phon +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
#    s(X, by = vow_phon, bs = "cr") +
#    s(X, by = c2_place_phon, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl02,
  method = "ML"
)
summary(pl02_polar_gam)

pl02_polar_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
    c2_place +
#    vow_phon +
#    c2_place_phon +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
#    s(X, by = vow_phon, bs = "cr") +
#    s(X, by = c2_place_phon, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl02,
  method = "ML"
)

compareML(pl02_polar_gam_null, pl02_polar_gam)
```

```{r pl02-polar-smooth}
plot_polar_smooths(
  pl02_polar_gam,
  X,
  c2_phonation,
  facet_terms = c2_place + vowel
)
```

### PL03

```{r pl03}
pl03 <- filter(splines, speaker == "pl03", label %in% c("max_TT", "max_TD"))
```

```{r pl03-polar-gam}
pl03_polar_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
#    vow_phon +
#    c2_place_phon +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
#    s(X, by = vow_phon, bs = "cr") +
#    s(X, by = c2_place_phon, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl03,
  method = "ML"
)
summary(pl03_polar_gam)
```

```{r pl03-polar-gam-null}
pl03_polar_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
    c2_place +
#    vow_phon +
#    c2_place_phon +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
#    s(X, by = vow_phon, bs = "cr") +
#    s(X, by = c2_place_phon, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl03,
  method = "ML"
)
compareML(pl03_polar_gam_null, pl03_polar_gam)
```

```{r pl03-polar-smooth}
plot_polar_smooths(
  pl03_polar_gam,
  X,
  c2_phonation,
  facet_terms = c2_place + vowel
)
```

```{r it02-acf}
acf_resid(it02_polar_gam, split_pred = list(it02$rec_date))
```

ACF looks good.

### PL04

```{r pl04}
pl04 <- filter(splines, speaker == "pl04", label %in% c("max_TT", "max_TD"))
```

```{r pl04-polar-gam}
pl04_polar_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
#    vow_phon +
#    c2_place_phon +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
#    s(X, by = vow_phon, bs = "cr") +
#    s(X, by = c2_place_phon, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl04,
  method = "ML"
)
summary(pl04_polar_gam)

pl04_polar_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
    c2_place +
#    vow_phon +
#    c2_place_phon +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
#    s(X, by = vow_phon, bs = "cr") +
#    s(X, by = c2_place_phon, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl04,
  method = "ML"
)
compareML(pl04_polar_gam_null, pl04_polar_gam)
```

```{r pl04-polar-smooth}
plot_polar_smooths(
  pl04_polar_gam,
  X,
  c2_phonation,
  facet_terms = c2_place + vowel
) +
  labs(title = "PL04")
ggsave("./presentations/2018-baap/graphics/pl04-uti.pdf", width = 7, height = 4)
```

### PL05

```{r pl05}
pl05 <- filter(splines, speaker == "pl05", label %in% c("max_TT", "max_TD"))
```

```{r pl05-polar-gam}
pl05_polar_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
#    vow_phon +
#    c2_place_phon +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
#    s(X, by = vow_phon, bs = "cr") +
#    s(X, by = c2_place_phon, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl05,
  method = "ML"
)
summary(pl05_polar_gam)

pl05_polar_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
    c2_place +
#    vow_phon +
#    c2_place_phon +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
#    s(X, by = vow_phon, bs = "cr") +
#    s(X, by = c2_place_phon, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl05,
  method = "ML"
)

compareML(pl05_polar_gam_null, pl05_polar_gam)
```

```{r pl05-polar-smooths}
plot_polar_smooths(
  pl05_polar_gam,
  X,
  c2_phonation,
  facet_terms = c2_place + vowel
) +
  labs(title = "PL05")
ggsave("./presentations/2018-baap/graphics/pl05-uti.pdf", width = 5, height = 4)
```

```{r pl05-acf}
acf_resid(pl05_polar_gam, split_pred = list(pl05$rec_date))
```

ACF is fine.

## Italian closure

### IT01

```{r it01-clos}
it01_clos <- filter(splines_closure, speaker == "it01")
```

```{r it01-clos-polar-gam}
it01_clos_polar_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
#    vow_phon +
#    c2_place_phon +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
#    s(X, by = vow_phon, bs = "cr") +
#    s(X, by = c2_place_phon, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it01_clos,
  method = "ML"
)
summary(it01_clos_polar_gam)
```

No need for interactions.

```{r it01-clos-polar-gam-null}
it01_clos_polar_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it01_clos,
  method = "ML"
)

compareML(it01_clos_polar_gam_null, it01_clos_polar_gam)
```

```{r it01-clos-polar-smooth}
plot_polar_smooths(
  it01_clos_polar_gam,
  X,
  c2_phonation,
  facet_terms = c2_place + vowel
)
```

TRA at closure.

### IT02

```{r it02-clos}
it02_clos <- filter(splines_closure, speaker == "it02", fan_line > 5, fan_line < 40)
```

```{r it02-clos-polar-gam}
it02_clos_polar_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
#    vow_phon +
#    c2_place_phon +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
#    s(X, by = vow_phon, bs = "cr") +
#    s(X, by = c2_place_phon, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it02_clos,
  method = "ML"
)
summary(it02_clos_polar_gam)
```

```{r it02-clos-polar-gam-null}
it02_clos_polar_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it02_clos,
  method = "ML"
)

compareML(it02_clos_polar_gam_null, it02_clos_polar_gam)
```

```{r it02-clos-polar-smooth}
plot_polar_smooths(
  it02_clos_polar_gam,
  X,
  c2_phonation,
  facet_terms = c2_place + vowel
)
```

TRA at closure but not great improvement (p < 0.05).

### IT03

```{r it03-clos}
it03_clos <- filter(splines_closure, speaker == "it03")
```

```{r it03-clos-polar-gam}
it03_clos_polar_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
#    vow_phon +
#    c2_place_phon +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
#    s(X, by = vow_phon, bs = "cr") +
#    s(X, by = c2_place_phon, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it03_clos,
  method = "ML"
)
summary(it03_clos_polar_gam)

it03_clos_polar_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
    c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = it03_clos,
  method = "ML"
)

compareML(it03_clos_polar_gam_null, it03_clos_polar_gam)
```

```{r it03-clos-polar-smooth}
plot_polar_smooths(
  it03_clos_polar_gam,
  X,
  c2_phonation,
  facet_terms = c2_place + vowel
)
```

No TRA at closure.

### IT04

```{r it04-clos}
it04_clos <- filter(splines_closure, speaker == "it04")
```

```{r it04-clos-polar-gam}
it04_clos_polar_gam <- polar_gam(
  Y ~
    c2_phonation +
#    vowel +
    c2_place +
#    vow_phon +
#    c2_place_phon +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
#    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
#    s(X, by = vow_phon, bs = "cr") +
#    s(X, by = c2_place_phon, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = filter(it04_clos, vowel == "a"),
  method = "ML"
)
summary(it04_clos_polar_gam)

it04_clos_polar_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
#    vowel +
    c2_place +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
#    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = filter(it04_clos, vowel == "a"),
  method = "ML"
)

compareML(it04_clos_polar_gam_null, it04_clos_polar_gam)
```

```{r it04-clos-polar-smooth}
plot_polar_smooths(
  it04_clos_polar_gam,
  X,
  c2_phonation,
  facet_terms = c2_place
)
```

TRA at closure in /a/ but only according model summary and not model comparison.

## Polish closure

### PL05

```{r pl05-clos}
pl05_clos <- filter(splines_closure, speaker == "pl05")
```

```{r pl05-clos-polar-gam}
pl05_clos_polar_gam <- polar_gam(
  Y ~
    c2_phonation +
    vowel +
    c2_place +
    vow_phon +
    c2_place_phon +
    s(X, bs = "cr") +
    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, by = vow_phon, bs = "cr") +
    s(X, by = c2_place_phon, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl05_clos,
  method = "ML"
)
summary(pl05_clos_polar_gam)
```

```{r pl05-clos-polar-gam-null}
pl05_clos_polar_gam_null <- polar_gam(
  Y ~
#    c2_phonation +
    vowel +
    c2_place +
    vow_phon +
    c2_place_phon +
    s(X, bs = "cr") +
#    s(X, by = c2_phonation, bs = "cr") +
    s(X, by = vowel, bs = "cr") +
    s(X, by = c2_place, bs = "cr") +
    s(X, by = vow_phon, bs = "cr") +
    s(X, by = c2_place_phon, bs = "cr") +
    s(X, rec_date, bs = "fs", xt = "cr", m = 1),
  data = pl05_clos,
  method = "ML"
)

compareML(pl05_clos_polar_gam_null, pl05_clos_polar_gam)
```

```{r pl05-clos-polar-smooth}
plot_polar_smooths(
  pl05_clos_polar_gam,
  X,
  c2_phonation,
  facet_terms = c2_place + vowel
)
```

No TRA at closure.
