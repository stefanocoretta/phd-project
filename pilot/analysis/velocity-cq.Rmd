---
title: "Velocity and Closed Quotient"
author: "Stefano Coretta"
date: \today
output: 
  pdf_document: 
    fig_caption: yes
    fig_height: 3.5
    fig_width: 5
    latex_engine: xelatex
    number_sections: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir=normalizePath("../../"))
library(purrr)
library(readr)
library(tidyr)
library(dplyr)
library(ggplot2)
theme_set(theme_bw())
library(stringr)
```

# Data import

```{r read-files}
columns <- c(
    "speaker",
    "time",
    "rel.time",
    "rec.date",
    "prompt",
    "label",
    "TT.displacement.sm",
    "TT.velocity",
    "TT.velocity.abs",
    "TD.displacement.sm",
    "TD.velocity",
    "TD.velocity.abs"
    )

velocity <- list.files(path = "./pilot/results",
                   pattern = "*-velocity.csv",
                   full.names = TRUE) %>%
    map_df(~read_tsv(., col_names = columns, na = "*"))

languages <- read_csv("./pilot/stimuli/languages.csv")
words <- read_csv("./pilot/stimuli/nonce.csv")

velocity <- velocity %>%
    mutate(word = word(prompt, 2)) %>%
    left_join(y = languages) %>%
    left_join(y = words) %>%
    mutate_if(is.character, as.factor)

preceding <- ""
counter = 0
repetition <- as.numeric()
for (item in velocity$word) {
    if (item != preceding) {
        counter <- counter + 1
        repetition <- c(repetition, counter)
        preceding <- item
    } else {
        repetition <- c(repetition, counter)
    }
}

velocity <- cbind(velocity, repetition) %>%
    mutate(repetition = as.factor(repetition))

velocity.coronal <- filter(velocity, c2place == "coronal")
velocity.velar <- filter(velocity, c2place == "velar")

degg.word <- list.files(path = "./pilot/results",
                   pattern = "*-degg-tracing-word.csv",
                   full.names = TRUE) %>%
    map_df(~read_csv(.)) %>%
    mutate(closed.quotient = minimum - maximum)

degg.word <- left_join(degg.word, languages) %>%
    left_join(y = words) %>%
    mutate_if(is.character, as.factor)

degg.word.it <- filter(degg.word, language == "italian")
degg.word.pl <- filter(degg.word, language == "polish")
```

# Velocity plots

```{r coronal-velocity-plot}
ggplot(velocity.coronal, aes(rel.time, TT.velocity.abs)) +
    geom_line() +
    facet_grid(speaker ~ c2phonation + vowel)
```

```{r velar-velocity-plot}
ggplot(velocity.velar, aes(rel.time, TD.velocity.abs)) +
    geom_line() +
    facet_grid(speaker ~ c2phonation + vowel)
```

```{r velocity-plot}
ggplot(velocity, aes(rel.time, TD.velocity.abs)) +
    geom_line() +
    facet_grid(speaker + c2place ~ c2phonation + vowel)
```

## Closed quotient

```{r}
filter(degg.word, closed.quotient < 1, closed.quotient > 0) %>%
ggplot(aes(rel.time, closed.quotient)) +
    geom_point() +
    facet_grid(speaker + c2place ~ c2phonation + vowel)
```

