---
title: "Spline plotting and SSANOVA"
author: "Stefano Coretta"
date: "27/12/2016"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir=normalizePath("../"))
library(tidyr)
library(dplyr)
library(ggplot2)
theme_set(theme_bw())
library(gss)
library(stringr)
```

Before importing the data, we need to specify the column names for the data set header, since the raw data does not have a header. The number of splines is always 42 (saved as `num.splines`). `first.columns` is a factor containing the names of columns that are not the splines coordinates columns. Finally, we can concatenate `first.columns` with the names of the splines coordinates which is generated by the `paste0` function in the format `X_1, Y_1, X_2, Y_2, X_n, ...` (the underscore `_` will be useful for separating the axis from the fan number).

```{r}
num.splines = 42
first.columns <- c(
    "subject",
    "seconds",
    "rec.date",
    "prompt",
    "label",
    "TD.displacement",
    "TT.displacement",
    "TD.displacement.sm",
    "TD.velocity",
    "TD.velocity.abs",
    "TT.displacement.sm",
    "TT.velocity",
    "TT.velocity.abs"
    )
columns <- c(first.columns,
             paste0(rep(c("X", "Y"), num.splines),
                    "_",
                    rep(1:num.splines, each = 2)
                    )
             )
```

We can now read in the file.

```{r}
raw.data <- read.delim("pilot/results/SC01_export.txt", header = FALSE,
                    na.string = '*', col.names = columns
                    )

raw.data <- unique(raw.data)

stimuli <- read.csv("pilot/stimuli/nonce.csv")
```

The following code applies tidy formatting to the data frame. It uses functions from the `tidyr` library.

```{r}
splines <- raw.data %>%
    gather(spline, coordinate, X_1:Y_42) %>%
    separate(spline, c("axis", "fan"), convert = TRUE) %>%
    spread(axis, coordinate)
```

We can finally plot splines grouped by prompt.

```{r, eval=FALSE, include=FALSE}
ggplot(splines, aes(x = X, y = Y, group = prompt)) + stat_smooth(size = 1) +
    geom_smooth(se = FALSE) + coord_fixed(ratio = 1)
```

Now we can create a separate data frame where the observasional unit is each word and the variables are the consonantal getures (target, maximum closure, release).

```{r}
cons.gestures <- raw.data %>%
    select(subject:label) %>%
    separate(label, c("gesture", "tongue.area")) %>%
    spread(gesture, seconds) %>%
    select(subject:tongue.area, target, max, release) %>%
    mutate(word = as.factor(word(prompt, 2))) %>%
    left_join(y = stimuli)
```





