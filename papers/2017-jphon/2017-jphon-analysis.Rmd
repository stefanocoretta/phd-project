---
title: "Vowel duration and tongue root advancement in Italian and Polish"
author: "Stefano Coretta"
date: "18/09/2017"
output:
  pdf_document: 
    latex_engine: xelatex
    number_sections: yes
  html_document:
    highlight: tango
    number_sections: yes
    theme: readable
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = normalizePath("../../"))
library(tidyverse)
theme_set(theme_minimal())
library(rticulate) # https://github.com/stefanocoretta/rticulate
library(stringr)
library(scales)
library(tidymv) # https://github.com/stefanocoretta/tidymv
library(itsadug)
library(lmerTest)
library(effects)
library(sjPlot)
options(contrasts = rep("contr.treatment", 2))
```

# Import data

`tongues` contains splines coordinates at maximum displacement, `tongues_clos` has splines coordinates at acoustic closure, and `vowels` has durational data.

```{r data}
languages <- read_csv("voicing-effect/stimuli/languages.csv")
words <- read_csv("voicing-effect/stimuli/nonce.csv")

columns <- c(
    "speaker",
    "seconds",
    "rec.date",
    "prompt",
    "label",
    "TT.displacement.sm",
    "TT.velocity",
    "TT.velocity.abs",
    "TD.displacement.sm",
    "TD.velocity",
    "TD.velocity.abs"
)

aaa_files <- list.files(
    path = "papers/2017-jphon/results/tongues",
    pattern = "*-tongue-cart.tsv",
    full.names = TRUE
)

tongues <- read_aaa(
    aaa_files,
    columns, 
    na.rm = TRUE
) %>%
    mutate(word = word(prompt, 2)) %>%
    left_join(y = languages) %>%
    left_join(y = words) %>%
    mutate_if(is.character, as.factor) %>%
    group_by(speaker) %>%
    mutate(
        X.re = rescale(X),
        Y.re = rescale(Y)
    ) %>%
    ungroup() %>%
    mutate(
        vowel.ord = ordered(vowel, levels = c("a", "o", "u")),
        c2place.ord = ordered(c2place, levels = c("coronal", "velar")),
        c2phonation.ord = ordered(c2phonation, levels = c("voiceless", "voiced"))
    ) %>%
    filter(label %in% c("max_TT", "max_TD"), vowel != "u") %>%
    arrange(rec.date, fan.line) %>%
    create_event_start("rec.date")

aaa_files_clos <- list.files(
    path = "papers/2017-jphon/results/tongues",
    pattern = "*-tongue-clos-cart.tsv",
    full.names = TRUE
)

tongues_clos <- read_aaa(
    aaa_files_clos,
    columns, 
    na.rm = TRUE
) %>%
    mutate(word = word(prompt, 2)) %>%
    left_join(y = languages) %>%
    left_join(y = words) %>%
    mutate_if(is.character, as.factor) %>%
    group_by(speaker) %>%
    mutate(
        X.re = rescale(X),
        Y.re = rescale(Y)
    ) %>%
    ungroup() %>%
    mutate(
        vowel.ord = ordered(vowel, levels = c("a", "o", "u")),
        c2place.ord = ordered(c2place, levels = c("coronal", "velar")),
        c2phonation.ord = ordered(c2phonation, levels = c("voiceless", "voiced"))
    ) %>%
    filter(vowel != "u") %>%
    arrange(rec.date, fan.line) %>%
    create_event_start("rec.date")

vowels <- list.files(path = "papers/2017-jphon/results/durations",
                   pattern = "*-vowel-durations.csv",
                   full.names = TRUE) %>%
    map_df(~read_csv(., na = "--undefined--")) %>%
    left_join(y = languages) %>%
    left_join(y = words) %>%
    mutate_if(is.character, as.factor) %>%
    mutate(
        index = as.factor(index),
        c2phonation = factor(c2phonation, levels = c("voiceless", "voiced"))
    ) %>%
    filter(!(file == "it04-002" | file == "pl03-020")) # filter obvious outliers
```

# Vowel duration

```{r duration-lm}
vow_lm <- lmer(
    vowel.duration ~
        c2phonation +
        c2place +
        vowel +
        sentence.duration +
        (1+c2phonation|speaker) +
        (1|word),
    data = filter(vowels)
)

summary(vow_lm)

vow_lm_null <- lmer(
    vowel.duration ~
#        c2phonation +
        c2place +
        vowel +
        sentence.duration +
        (1+c2phonation|speaker) +
        (1|word),
    data = filter(vowels)
)

anova(vow_lm_null, vow_lm)
```

```{r duration-lm-slopes}
ranef(vow_lm)$speaker
sjp.lmer(vow_lm, type = "rs.ri", vars = "vowel.duration", show.legend = T)
```

## Italian

```{r it-duration-lm}
it_vow_lm <- lmer(
    vowel.duration ~
        c2phonation +
        c2place +
        vowel +
        c2phonation:vowel +
        sentence.duration +
        (1+c2phonation|speaker) +
        (1|word),
    data = filter(vowels, language == "italian")
)

summary(it_vow_lm)

it_vow_lm_null <- lmer(
    vowel.duration ~
#        c2phonation +
        c2place +
        vowel +
        sentence.duration +
        (1+c2phonation|speaker) +
        (1|word),
    data = filter(vowels, language == "italian")
)

anova(it_vow_lm_null, it_vow_lm)
```

```{r it-duration-lm-plots}
plot(fitted(it_vow_lm),residuals(it_vow_lm))
qqnorm(resid(it_vow_lm))
plot(allEffects(it_vow_lm))
```

```{r it-duration-lm-slopes}
ranef(it_vow_lm)$speaker
sjp.lmer(it_vow_lm, type = "rs.ri", vars = "vowel.duration", show.legend = T)
```

## Polish

```{r pl-duration-lm}
pl_vow_lm <- lmer(
    vowel.duration ~
        c2phonation +
        vowel +
        c2place +
        sentence.duration +
        (1+c2phonation|speaker) +
        (1|word),
    data = filter(vowels, language == "polish")
)

summary(pl_vow_lm)

pl_vow_lm_null <- lmer(
    vowel.duration ~
#        c2phonation +
        vowel +
        c2place +
        sentence.duration +
        (1+c2phonation|speaker) +
        (1|word),
    data = filter(vowels, language == "polish")
)

anova(pl_vow_lm_null, pl_vow_lm)
```

```{r pl-duration-lm-plots}
plot(fitted(pl_vow_lm),residuals(pl_vow_lm))
qqnorm(resid(pl_vow_lm))
plot(allEffects(pl_vow_lm))
```

```{r pl-duration-lm-slopes}
ranef(pl_vow_lm)$speaker
sjp.lmer(pl_vow_lm, type = "rs.ri", vars = "vowel.duration", show.legend = T)
```

```{r pl-duration-lm-2}
pl_vow_lm_2 <- lmer(
    vowel.duration ~
        c2phonation +
        vowel +
        c2place +
        sentence.duration +
        (1|speaker) +
        (1|word),
    data = filter(vowels, language == "polish", speaker != "pl05")
)

summary(pl_vow_lm_2)

pl_vow_lm_null_2 <- lmer(
    vowel.duration ~
#        c2phonation +
        vowel +
        c2place +
        sentence.duration +
        (1|speaker) +
        (1|word),
    data = filter(vowels, language == "polish", speaker != "pl05")
)

anova(pl_vow_lm_null_2, pl_vow_lm_2)
```

```{r pl-duration-lm-2-plots}
plot(fitted(pl_vow_lm_2),residuals(pl_vow_lm_2))
qqnorm(resid(pl_vow_lm_2))
plot(allEffects(pl_vow_lm_2))
```

# Tongue root advancement at maximum displacement

## Italian

### IT01

```{r it01-tra}
it01_max <- filter(tongues, speaker == "it01")

it01_gamm <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it01_max,
    method = "fREML"
)

rho <- start_value_rho(it01_gamm)

it01_gamm_ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it01_max,
    method = "ML",
    rho = rho,
    AR.start = it01_max$start.event
)

summary(it01_gamm_ar)

it01_gamm_ar_null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it01_max,
    method = "ML",
    rho = rho,
    AR.start = it01_max$start.event
)

compareML(it01_gamm_ar_null, it01_gamm_ar)
```

```{r it01-tra-plot}
plot_gamsd(
    it01_gamm_ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
ggsave("it01-tra-plot.pdf", width = 7, height = 5, path = "./papers/2017-jphon/fig")
```

### IT02

```{r it02-tra}
it02_max <- filter(tongues, speaker == "it02")

it02_gamm <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it02_max,
    method = "fREML"
)

rho <- start_value_rho(it02_gamm)

it02_gamm_ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it02_max,
    method = "ML",
    rho = rho,
    AR.start = it02_max$start.event
)

summary(it02_gamm_ar)

it02_gamm_ar_null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it02_max,
    method = "ML",
    rho = rho,
    AR.start = it02_max$start.event
)

compareML(it02_gamm_ar_null, it02_gamm_ar)
```

```{r it02-tra-plot}
plot_gamsd(
    it02_gamm_ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
ggsave("it02-tra-plot.pdf", width = 7, height = 5, path = "./papers/2017-jphon/fig")
```


### IT03

```{r it03-tra}
it03_max <- filter(tongues, speaker == "it03") %>%
    mutate(c2phon_vowel = as.ordered(interaction(c2phonation.ord, vowel.ord)))

it03_gamm <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, by = c2phon_vowel, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it03_max,
    method = "fREML"
)

rho <- start_value_rho(it03_gamm)

it03_gamm_ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, by = c2phon_vowel, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it03_max,
    method = "ML",
    rho = rho,
    AR.start = it03_max$start.event
)

summary(it03_gamm_ar)

it03_gamm_ar_null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
#        s(X, by = c2phon_vowel, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it03_max,
    method = "ML",
    rho = rho,
    AR.start = it03_max$start.event
)

compareML(it03_gamm_ar_null, it03_gamm_ar)
```

```{r it03-tra-plot}
plot_gamsd(
    it03_gamm_ar,
    view = "X",
    comparison = list(c2phon_vowel = c("voiceless.a", "voiced.a")),
    conditions = list(c2place.ord = "coronal")
)
ggsave("it03-tra-plot.pdf", width = 7, height = 5, path = "./papers/2017-jphon/fig")
```

### IT04

```{r it04-tra}
it04_max <- filter(tongues, speaker == "it04", X > -20) %>%
    mutate(c2phon_vowel = as.ordered(interaction(c2phonation.ord, vowel.ord)))

it04_gamm <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
#        s(X, by = c2phon_vowel, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it04_max,
    method = "fREML"
)

rho <- start_value_rho(it04_gamm)

it04_gamm_ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
#        s(X, by = c2phon_vowel, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it04_max,
    method = "ML",
    rho = rho,
    AR.start = it04_max$start.event
)

summary(it04_gamm_ar)

it04_gamm_ar_null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
#        s(X, by = c2phon_vowel, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it04_max,
    method = "ML",
    rho = rho,
    AR.start = it04_max$start.event
)

compareML(it04_gamm_ar_null, it04_gamm_ar)

summary(it04_gamm_ar_null)
```

```{r it04-tra-plot}
plot_gamsd(
    it04_gamm_ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
ggsave("it04-tra-plot.pdf", width = 7, height = 5, path = "./papers/2017-jphon/fig")
```

## Polish

### PL02

```{r pl02-tra}
pl02_max <- filter(tongues, speaker == "pl02", X > -20)

pl02_gamm <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl02_max,
    method = "ML"
)

rho <- start_value_rho(pl02_gamm)

pl02_gamm_ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl02_max,
    method = "ML",
    rho = rho,
    AR.start = pl02_max$start.event
)

summary(pl02_gamm_ar)

pl02_gamm_ar_null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl02_max,
    method = "ML",
    rho = rho,
    AR.start = pl02_max$start.event
)

compareML(pl02_gamm_ar_null, pl02_gamm_ar)
```

```{r pl02-tra-plot}
plot_gamsd(
    pl02_gamm_ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
ggsave("pl02-tra-plot.pdf", width = 7, height = 5, path = "./papers/2017-jphon/fig")
```

### PL04

```{r pl04-tra}
pl04_max <- filter(tongues, speaker == "pl04", X > -25)

pl04_gamm <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl04_max,
    method = "ML"
)

rho <- start_value_rho(pl04_gamm)

pl04_gamm_ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl04_max,
    method = "ML",
    rho = rho,
    AR.start = pl04_max$start.event
)

summary(pl04_gamm_ar)

pl04_gamm_ar_null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl04_max,
    method = "ML",
    rho = rho,
    AR.start = pl04_max$start.event
)

compareML(pl04_gamm_ar_null, pl04_gamm_ar)
```

```{r pl04-tra-plot}
plot_gamsd(
    pl04_gamm_ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
ggsave("pl04-tra-plot.pdf", width = 7, height = 5, path = "./papers/2017-jphon/fig")
```

### PL03

```{r pl03-tra}
pl03_max <- filter(tongues, speaker == "pl03") %>%
    mutate(c2phon_vowel = as.ordered(interaction(c2phonation.ord, vowel.ord)))

pl03_gamm <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
#        s(X, by = c2phon_vowel, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl03_max,
    method = "ML"
)

rho <- start_value_rho(pl03_gamm)

pl03_gamm_ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
#        s(X, by = c2phon_vowel, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl03_max,
    method = "ML",
    rho = rho,
    AR.start = pl03_max$start.event
)

summary(pl03_gamm_ar)

pl03_gamm_ar_null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl03_max,
    method = "ML",
    rho = rho,
    AR.start = pl03_max$start.event
)

compareML(pl03_gamm_ar_null, pl03_gamm_ar)
```

```{r pl03-tra-plot}
plot_gamsd(
    pl03_gamm_ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
ggsave("pl03-tra-plot.pdf", width = 7, height = 5, path = "./papers/2017-jphon/fig")
```

### PL05

```{r pl05-tra}
pl05_max <- filter(tongues, speaker == "pl05")

pl05_gamm <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl05_max,
    method = "ML"
)

rho <- start_value_rho(pl05_gamm)

pl05_gamm_ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl05_max,
    method = "ML",
    rho = rho,
    AR.start = pl05_max$start.event
)

summary(pl05_gamm_ar)

pl05_gamm_ar_null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl05_max,
    method = "ML",
    rho = rho,
    AR.start = pl05_max$start.event
)

compareML(pl05_gamm_ar_null, pl05_gamm_ar)
```

```{r pl05-tra-plot}
plot_gamsd(
    pl05_gamm_ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
ggsave("pl05-tra-plot.pdf", width = 7, height = 5, path = "./papers/2017-jphon/fig")
```

# Tongue root advancement at closure

## Italian

### IT01

```{r it01-tra-clos}
it01_clos <- filter(tongues_clos, speaker == "it01")

it01_gamm <- bam(
    Y ~
        X.re +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it01_clos,
    method = "fREML"
)

rho <- start_value_rho(it01_gamm)

it01_gamm_ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it01_clos,
    method = "ML",
    rho = rho,
    AR.start = it01_clos$start.event
)

summary(it01_gamm_ar)

it01_gamm_ar_null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it01_clos,
    method = "ML",
    rho = rho,
    AR.start = it01_clos$start.event
)

compareML(it01_gamm_ar_null, it01_gamm_ar)
```

```{r it01-tra-clos-plot}
plot_gamsd(
    it01_gamm_ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
```

### IT02

```{r it02-tra-clos}
it02_clos <- filter(tongues_clos, speaker == "it02")

it02_gamm <- bam(
    Y ~
        X.re +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it02_clos,
    method = "fREML"
)

rho <- start_value_rho(it02_gamm)

it02_gamm_ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it02_clos,
    method = "ML",
    rho = rho,
    AR.start = it02_clos$start.event
)

summary(it02_gamm_ar)

it02_gamm_ar_null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it02_clos,
    method = "ML",
    rho = rho,
    AR.start = it02_clos$start.event
)

compareML(it02_gamm_ar_null, it02_gamm_ar)
```

```{r it02-tra-clos-plot}
plot_gamsd(
    it02_gamm_ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
```

### IT03

```{r it03-tra-clos}
it03_clos <- filter(tongues_clos, speaker == "it03")

it03_gamm <- bam(
    Y ~
        X.re +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it03_clos,
    method = "fREML"
)

rho <- start_value_rho(it03_gamm)

it03_gamm_ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it03_clos,
    method = "ML",
    rho = rho,
    AR.start = it03_clos$start.event
)

summary(it03_gamm_ar)

it03_gamm_ar_null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it03_clos,
    method = "ML",
    rho = rho,
    AR.start = it03_clos$start.event
)

compareML(it03_gamm_ar_null, it03_gamm_ar)
```

```{r it03-tra-clos-plot}
plot_gamsd(
    it03_gamm_ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
```

## Polish

### PL02

```{r pl02-tra-clos}
pl02_clos <- filter(tongues_clos, speaker == "pl02", X > -20)

pl02_gamm <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl02_clos,
    method = "ML"
)

rho <- start_value_rho(pl02_gamm)

pl02_gamm_ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl02_clos,
    method = "ML",
    rho = rho,
    AR.start = pl02_clos$start.event
)

summary(pl02_gamm_ar)

pl02_gamm_ar_null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl02_clos,
    method = "ML",
    rho = rho,
    AR.start = pl02_clos$start.event
)

compareML(pl02_gamm_ar_null, pl02_gamm_ar)
```

```{r pl02-tra-clos-plot}
plot_gamsd(
    pl02_gamm_ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
```

### PL04

```{r pl04-tra-clos}
pl04_clos <- filter(tongues_clos, speaker == "pl04", X > -25)

pl04_gamm <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl04_clos,
    method = "ML"
)

rho <- start_value_rho(pl04_gamm)

pl04_gamm_ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl04_clos,
    method = "ML",
    rho = rho,
    AR.start = pl04_clos$start.event
)

summary(pl04_gamm_ar)

pl04_gamm_ar_null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl04_clos,
    method = "ML",
    rho = rho,
    AR.start = pl04_clos$start.event
)

compareML(pl04_gamm_ar_null, pl04_gamm_ar)
```

```{r pl04-tra-clos-plot}
plot_gamsd(
    pl04_gamm_ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
```

### PL05

```{r pl05-tra-clos}
pl05_clos <- filter(tongues_clos, speaker == "pl05")

pl05_gamm <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl05_clos,
    method = "ML"
)

rho <- start_value_rho(pl05_gamm)

pl05_gamm_ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl05_clos,
    method = "ML",
    rho = rho,
    AR.start = pl05_clos$start.event
)

summary(pl05_gamm_ar)

pl05_gamm_ar_null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, rec.date, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl05_clos,
    method = "ML",
    rho = rho,
    AR.start = pl05_clos$start.event
)

compareML(pl05_gamm_ar_null, pl05_gamm_ar)
```

```{r pl05-tra-clos-plot}
plot_gamsd(
    pl05_gamm_ar,
    view = "X",
    comparison = list(c2phonation.ord = c("voiceless", "voiced")),
    conditions = list(c2place.ord = "coronal")
)
```

# Comparison tongue at closure and maximum displacement

## IT01

```{r it01-voiced-data}
it01_voiced <- rbind(it01_max, it01_clos) %>%
    filter(c2phonation == "voiced") %>%
    mutate(
        position = ifelse(label %in% c("max_TT", "max_TD"), "maximum", "closure"),
        position_ord = ordered(position, levels = c("maximum", "closure"))
    ) %>%
    unite(item_no, seconds:rec.date) %>%
    mutate_if(is.character, as.factor)
```

```{r it01-voiced}
it01_voiced_gamm <- bam(
    Y ~
        X.re +
        s(X, bs = "cr") +
        s(X, by = position_ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, item_no, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it01_voiced,
    method = "fREML"
)

rho <- start_value_rho(it01_voiced_gamm)

it01_voiced_gamm_ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = position_ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, item_no, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it01_voiced,
    method = "ML",
    rho = rho,
    AR.start = it01_voiced$start.event
)

summary(it01_voiced_gamm_ar)

it01_voiced_gamm_ar_null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, item_no, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it01_voiced,
    method = "ML",
    rho = rho,
    AR.start = it01_voiced$start.event
)

compareML(it01_voiced_gamm_ar_null, it01_voiced_gamm_ar)
```

```{r it01-voiced-plot}
plot_gamsd(
    it01_voiced_gamm_ar,
    view = "X",
    comparison = list(position_ord = c("maximum", "closure")),
    conditions = list(c2place.ord = "coronal")
)
ggsave("it01-voiced-plot.pdf", width = 7, height = 5, path = "./papers/2017-jphon/fig")
```

## IT02

```{r it02-voiced-data}
it02_voiced <- rbind(it02_max, it02_clos) %>%
    filter(c2phonation == "voiced") %>%
    mutate(
        position = ifelse(label %in% c("max_TT", "max_TD"), "maximum", "closure"),
        position_ord = ordered(position, levels = c("maximum", "closure"))
    ) %>%
    unite(item_no, seconds:rec.date) %>%
    mutate_if(is.character, as.factor)
```

```{r it02-voiced}
it02_voiced_gamm <- bam(
    Y ~
        X.re +
        s(X, bs = "cr") +
        s(X, by = position_ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, item_no, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it02_voiced,
    method = "fREML"
)

rho <- start_value_rho(it02_voiced_gamm)

it02_voiced_gamm_ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = position_ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, item_no, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it02_voiced,
    method = "ML",
    rho = rho,
    AR.start = it02_voiced$start.event
)

summary(it02_voiced_gamm_ar)

it02_voiced_gamm_ar_null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, item_no, bs = "fs", xt = "cr", m = 1, k = 5),
    data = it02_voiced,
    method = "ML",
    rho = rho,
    AR.start = it02_voiced$start.event
)

compareML(it02_voiced_gamm_ar_null, it02_voiced_gamm_ar)
```

```{r it02-voiced-plot}
plot_gamsd(
    it02_voiced_gamm_ar,
    view = "X",
    comparison = list(position_ord = c("maximum", "closure")),
    conditions = list(c2place.ord = "coronal")
)
```

## PL05

```{r pl05-voiced-data}
pl05_voiced <- rbind(pl05_max, pl05_clos) %>%
    filter(c2phonation == "voiced") %>%
    mutate(
        position = ifelse(label %in% c("max_TT", "max_TD"), "maximum", "closure"),
        position_ord = ordered(position, levels = c("maximum", "closure"))
    ) %>%
    unite(item_no, seconds:rec.date) %>%
    mutate_if(is.character, as.factor)
```

```{r pl05-voiced}
pl05_voiced_gamm <- bam(
    Y ~
        X.re +
        s(X, bs = "cr") +
        s(X, by = position_ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, item_no, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl05_voiced,
    method = "fREML"
)

rho <- start_value_rho(pl05_voiced_gamm)

pl05_voiced_gamm_ar <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
        s(X, by = position_ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, item_no, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl05_voiced,
    method = "ML",
    rho = rho,
    AR.start = pl05_voiced$start.event
)

summary(pl05_voiced_gamm_ar)

pl05_voiced_gamm_ar_null <- bam(
    Y ~
        X +
        s(X, bs = "cr") +
#        s(X, by = c2phonation.ord, bs = "cr") +
        s(X, by = c2place.ord, bs = "cr") +
        s(X, by = vowel.ord, bs = "cr") +
        s(X, item_no, bs = "fs", xt = "cr", m = 1, k = 5),
    data = pl05_voiced,
    method = "ML",
    rho = rho,
    AR.start = pl05_voiced$start.event
)

compareML(pl05_voiced_gamm_ar_null, pl05_voiced_gamm_ar)
```

```{r pl05-voiced-plot}
plot_gamsd(
    pl05_voiced_gamm_ar,
    view = "X",
    comparison = list(position_ord = c("maximum", "closure")),
    conditions = list(c2place.ord = "coronal")
)
ggsave("pl05-voiced-plot.pdf", width = 7, height = 5, path = "./papers/2017-jphon/fig")
```

# Summary

Italian has TRA at closure and maximum displacement. Polish does not have TRA, except for pl05. Italian TR at closure is less advanced than at maximum displacement.

Italian vowels are 22 msec longer if followed by voiced stops. Polish vowels are 8 msec longer if followed by voiced stops, but pl05 has a bigger estimate.
