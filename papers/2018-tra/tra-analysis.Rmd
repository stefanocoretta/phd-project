---
title: "Tongue root position"
author: "Stefano Coretta"
date: "05/12/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = normalizePath("../../"))
library(tidyverse)
theme_set(theme_minimal())
library(coretta2018itapol)
data("kinematics_series")
data("kinematics")
library(mgcv)
library(tidymv)
library(itsadug)
library(lme4)

tra_series <- kinematics_series %>%
  filter(c1_phonation == "voiceless", proportion > 0) %>%
  mutate(
    c2_phonation = factor(c2_phonation, levels = c("voiceless", "voiced")),
    trp = -TR_displacement_sm,
    c2_phonation_o = ordered(c2_phonation,  levels = c("voiceless", "voiced"))
  ) %>%
  mutate_if(is.character, as.factor) %>%
  arrange(rec_date, proportion) %>%
  create_event_start("rec_date")

contrasts(tra_series$c2_phonation_o) <- "contr.treatment"

kines <- kinematics %>%
  filter(c1_phonation == "voiceless", label == "closure_", TR_displacement_sm > 10) %>%
  mutate(
    c2_phonation = factor(c2_phonation, levels = c("voiceless", "voiced")),
    trp = -TR_displacement_sm
  ) %>%
  mutate_if(is.character, as.factor)
```

# Tongue root position

```{r trp-language}
tra_series %>%
  ggplot(aes(proportion, trp, colour = c2_phonation)) +
  geom_smooth() +
  facet_grid(~ language)
```

```{r trp-speakers}
tra_series %>%
  ggplot(aes(proportion, trp, colour = c2_phonation)) +
  geom_smooth(method = "loess") +
  facet_wrap(~ speaker, scales = "free")
```

```{r tra-gam}
tra_gam <- bam(
  trp ~
    c2_phonation_o +
    s(speech_rate_c) +
    s(proportion) +
    s(proportion, by = c2_phonation_o) +
    ti(proportion, speech_rate_c) +
    s(proportion, speaker, bs = "fs", m = 1),
  data = tra_series
)

rho <- start_value_rho(tra_gam)

tra_gam_ar <- bam(
  trp ~
    c2_phonation_o +
    s(speech_rate_c) +
    s(proportion) +
    s(proportion, by = c2_phonation_o) +
    ti(proportion, speech_rate_c) +
    s(proportion, speaker, bs = "fs", m = 1),
  data = tra_series,
  method = "ML",
  rho = rho,
  AR.start = tra_series$start.event
)

tra_gam_ar_0 <- bam(
  trp ~
    # c2_phonation_o +
    s(speech_rate_c) +
    s(proportion) +
    # s(proportion, by = c2_phonation_o) +
    ti(proportion, speech_rate_c) +
    s(proportion, speaker, bs = "fs", m = 1),
  data = tra_series,
  method = "ML",
  rho = rho,
  AR.start = tra_series$start.event
)

compareML(tra_gam_ar_0, tra_gam_ar)
```

```{r tra-gam-plot}
plot_smooths(tra_gam_ar, proportion, c2_phonation_o)
```

# Tongue root at closure and vowel duration

```{r}
kines %>%
  ggplot(aes(v1_duration, trp)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm")
```

```{r}
tra_lm <- lmer(
  v1_duration ~
    trp +
    c2_phonation +
    speech_rate_c +
    # trp:c2_phonation +
    trp:speech_rate_c +
    vowel +
    (1|speaker) +
    (1|item),
  data = kines,
  REML = FALSE
)

summary(tra_lm)
```

