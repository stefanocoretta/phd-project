---
title: "Modelling electroglottographic data with wavegrams and generalised additive mixed models"
author: "Stefano Coretta"
output:
  lingr::lingr_article:
    citation_package: natbib
    fig_caption: yes
bibliography: linguistics
biblio-style: unified
mainfont: Lato
fontsize: 11pt
papersize: a4
indent: true
geometry: margin=1in
header-includes:
- \usepackage{cleveref}
params:
  version: 0.1.9000
  version-date: "2019/04/30"
---

```{r setup, include=FALSE}
library(here)
knitr::opts_chunk$set(echo = FALSE, include = FALSE)
knitr::opts_knit$set(root.dir = here())
library(tidyverse)
theme_set(theme_minimal())
# library(coretta2017egg)
# data("wavegram_p")
# library(coretta2018itapol)
# data("wavegram")
```

```{r load-data}
load("./papers/2019-wavegam/data/cache/wavegam.Rdata")
```

# Introduction

\begin{figure}
  \centering
  \includegraphics{./img/egg-setup.pdf}
  \caption{A schematics of the electroglottograph. A transverse section of the neck is shown with open glottis (on the left) and closed glottis (on the right). The electric field passing through the neck is represented by lines. When the vocal folds are apart, the opening distorts the electric field and impedance increases.}
  \label{f:egg-setup}
\end{figure}

The position of the vocal folds within the oral tract makes their investigation difficult.
Direct observation of the activity of the larynx via invasive methods, like laryngeoscopy, brings with it a series of practical drawbacks.
Among other methods for obtaining information on glottal activity is electroglottography.
Electroglottography, or EGG \citep{fabre1957}, is a technique that measures the degree of contact between the vocal folds (the Vocal Folds Contact Area, VFCA).
A high frequency low voltage electrical current is sent through two electrodes which are in contact with the surface of the neck, one on each side of the thyroid cartilage (\Cref{f:egg-setup}).
Impedance of this current is modulated by the VFCA, and greater vocal folds contact creates less impedance.
The amplitude is inversely correlated with VFCA and impedance, so that higher amplitude values indicate a greater contact area \citep{titze1990}.
The EGG unit registers the current impedance and converts it to relative amplitude values.
The time-developing amplitude signal thus provides us with information on the changes in VFCA, i.e. on properties of vocal folds vibration (voicing).

\begin{figure}
  \centering
  \includegraphics{./img/degg-signal.pdf}
  \caption{The electroglottographic signal (EGG) with corresponding first derivative (dEGG).}
  \label{f:egg}
\end{figure}

A glottal cycle can be described in terms of two phases \citep{childers1985, hampala2016}: (a) a contacting phase, in which the vocal folds are approaching each other, (b) a de-contacting phase, in which the vocal folds move apart from each other.
Transversal to this two-phase description, the glottal cycle can be described in terms of whether the glottis is closed or not.
According to this classification, the cycle can be divided into (1) a closed phase, in which the glottis is completely closed and glottal flow is 0 (in some contexts this phase could be absent, like in breathy voicing), and (2) an open phase, in which there is no complete contact between the vocal folds.
The timing of these phases can be approximated from the EGG signal, as demonstrated by both experimental and modelling work \citep{hampala2016}.
An example EGG signal is provided in \Cref{f:egg}.
<!-- cited in Hampala 2016 -->
<!-- point the reader to Hampala for figure on movements of the vocal folds -->

Two important landmarks of glottal movement are the closing instant (the timepoint of glottal complete closure) and the opening instant (the moment in which the glottis first opens).
These points delimit the open and closed phases of a glottal cycle.
The ratio of the closed phase relative to the total cycle duration, the closed quotient, has been used as an index of phonation type.
Modal voice has higher close quotient values than breathy voice, and lower values than creaky voice.
One method for the detection of the closing and opening instants is based on the first derivative of the EGG signal (the dEGG, see \Cref{f:egg}).
\citet{herbst2017}, however, showed that this method returns values that are just a surrogate of the actual articulatory movements, due to the complex anatomy of the vocal folds, and that there are no clear contacting and decontact instants, but rather intervals.
\citet{herbst2017} call this EGG-based closed quotient the 'contact quotient' and recommend to keep it distinct from the closed quotient obtained from direct observation of the vocal folds.

As an alternative to the contact quotient, \citet{herbst2010} propose the wavegram, a visualisation method which does not reduce the EGG signal to a single value and thus suffers less from the limitations of the contact quotient.
The wavegram exploits information from the whole signal to obtain an image of vocal folds activity.
A wavegram is a 3D representation of the EGG signal developing in time.
Its structure is similar to that of a classical phonetic spectrogram.
The *x*-axis indicates the temporal sequence of individual glottal cycles.
The *y*-axis represents the time within each glottal cycle, normalised between 0 and 1.
Finally, the normalised amplitude of the signal corresponds to different colour intensities.
Differences in intensity along the *x*-axis indicate changes in glottal activity.
The procedure for constructing a wavegram is given in \Cref{f:wavegram}.
A wavegram can be produced for the EGG signal and for any of its transformations, like the dEGG.

\begin{figure}
  \centering
  \includegraphics{./img/wavegram.png}
  \caption{The wavegram. Created by Christian T. Herbst under a CC BY-SA 3.0 license.}
  \label{f:wavegram}
\end{figure}

A possible limitation of the wavegram method is that it is intended for a qualitative analysis based on visual inspection.
However, wavegram data can be modelled using generalised additive models (GAMs, \citealt{hastie1986, zuur2012, wood2017}).
GAMs are a family of generalised models which can fit non-linear effects by additive combinations of smoothing splines.
The flexibility of GAMs allows researchers to generate a fitted wavegram based on data from multiple repetitions of a single speaker and from multiple speakers.
Random effects can also be included to account for idiosyncratic differences.
Moreover, the potential for overfitting is reduced by a smoothing penalty parameter, which constraints the maximum number of basis functions used to construct the smoothing splines.
This paper introduces wavegram GAMs as a way to quantitatively assess wavegram data.
First, results from a pilot study which informally evaluates the proposed method are presented (\Cref{s:pilot}).
\Cref{s:voicing} illustrates how to conduct a wavegram GAM analysis of dEGG data through a practical example in which the wavegrams of vowels followed by voiceless and voiced stops are compared.
Finally, \Cref{s:limits} discusses limitations of the current implementation of the method and future directions.

# Pilot study
\label{s:pilot}

Synchronised audio and EGG data were obtained from 5 trained phoneticians, who were asked to produce sustained tokens of /a/ with modal and breathy voice.
The data was collected using a Glottal Enterprises EG2-PCX2 electroglottograph and a Movo LV4-O2 Lavalier microphone, at a sample rate of 44100 Hz (16-bit).
The acquisition of the signals was controlled with Audacity running on a MacBook Pro (Retina, 13-inch, Mid 2014).
The placement of the electrodes strap was checked with the height indicator on the EGG unit.
Each participant uttered 10 consecutive tokens of a sustained /a/ in modal voice, followed by 10 tokens of a sustained breathy /a/.
All subsequent data processing was performed in Praat \citep{boersma2018}.
The onset and offset of each token were detected with an automatic procedure which finds voiced and unvoiced intervals (`To TextGrid (vuv)`).
The dEGG wavegram data was extracted from the first 8 glottal cycles of a 500 ms window, centred around the mid-point of each token.
A glottal cycle was arbitrarily defined as the interval between two consecutive EGG minima (cf. with \citealt{herbst2010} for an alternative algorythm).
From each glottal cycle, the relative amplitude of the dEGG signal was extracted every 10 samples.

A generalised additive mixed model (GAMM) was fitted to the data to statistically assess differences in vocal fold activity between modal and breathy voicing (see \citealt{soskuthy2017} and \citealt{wieling2018} for a practical introduction to fitting GAMs in R).
The following terms were included: the amplitude of the dEGG signal as the outcome variable, an interaction factor with language and phonation as a parametric term, a smooth over the glottal cycle index to model average changes of the dEGG signal across glottal cycles, and a smooth over the normalised time of the sample within the glottal cycle (as the proportion of the time relative to the duration of the glottal cycle) to model average changes of the dEGG signal within the glottal cycle; two difference smooths over normalised time of the glottal cycle onset and normalised sample time using a by-variable with the language/phonation factor; a tensor product interaction between normalised cycle time and normalised sample time to model changes of glottal activity through time, and the same tensor product interaction with a language/phonation by-variable to model phonation-driven differences in changes of glottal activity.
Finally, inter-speaker differences were modelled with a by-speaker factor smooth over normalised cycle time.
A first-order autoregressive (AR1) model was included to deal with the relatively high auto-correlation in the residuals.

\Cref{f:surface-p} shows the modelled wavegrams of modal and breathy tokens.
Since the tokens were produced with sustained phonation, no appreciable change within each wavegram can be observed.
However, the comparison of the wavegram of modal voice with that of breathy voice reveals differences between the two phonation types.
As a general trend, the dEGG maximum and dEGG minimum are achieved later within the glottal cycle in breathy voicing relative to modal voicing.
Moreover, differences in velocity of closing and opening movements of the vocal folds are signalled by the relative widths of the red-coloured bands (around the dEGG maximum) and the blue-coloured bands (around the dEGG minimum).
While in modal voicing the blue band is wider, the red band is in breathy voicing, indicating that the velocity into and out of the beginning of the closed phase is slower in breathy voicing.
According to the approximate significance of the smooth terms, phonation has an effect on the shape of the wavegram as expected (*F*(14.681) = 3.187, Ref.EDF = 19.027, *p* < 0.001).

```{r surface-p, include=TRUE, fig.cap = "Fitted wavegram of modal and breathy phonation (Section 2). The horizontal lines represent the dEGG maximum (solid line) and minimum (dashed line).", fig.lp="f:", out.extra="width=\\linewidth"}
lines <- tibble(
  intercept = c(0.31, 0.35, 0.77, 0.875),
  phonation_o = ordered(c("modal", "breathy", "modal", "breathy"), levels = c("modal", "breathy")),
  line = c("solid", "solid", "dashed", "dashed")
)

wavegam_p_ar_pred %>%
  ggplot(aes(sequence, sample, z = fit)) +
  geom_raster(aes(fill = fit)) +
  geom_contour(colour = "white", size = 0.1) +
  geom_hline(data = lines, aes(yintercept = intercept), linetype = lines$line) +
  facet_grid(~ phonation_o) +
  scale_fill_distiller(palette = "RdYlBu") +
  labs(
    x = "Glottal cycle index",
    y = "Normalised cycle duration",
    fill = "Normalised dEGG\namplitude"
  ) +
  theme(panel.grid = element_blank())
```

# Wavegram GAM analysis of vowels followed by voiceless vs. voiced stops
\label{s:voicing}

This section further illustrates the use of wavegram GAMs by discussing a dynamic analysis of changes in vocal folds activity during the production of vowels followed by voiceless vs. voiced stops in Italian and Polish.
EGG data was obtained from 9 Italian speakers and 6 Polish speakers.
A detailed description of the experimental materials and procedures is given in \citet{coretta2018j}.
Trochaic words with the form C\textsubscript{1}V\textsubscript{1}C\textsubscript{2}V\textsubscript{2} were used, where C\textsubscript{1} = /p/, V\textsubscript{1} = /a, o, u/, C\textsubscript{2} = /t, d, k, g/, and V\textsubscript{2} = V\textsubscript{1} (e.g. /pata/, /pada/, /poto/, etc.).
Processing and analysis of the EGG data were the same as with the pilot study (\Cref{s:pilot}), with the exception that data was extracted from every glottal cycle within the whole duration of the first vowel of the word stimuli.
The vocalic onset and offset were identified as the appearance and disappearance of higher formant structure respectively \citep{machac2009}.
Vowel duration was then normalised between 0 and 1 for analysis.

```{r surface, include=TRUE, fig.cap = "Fitted wavegram of vowels followed by voiceless and voiced stops in Italian and Polish (Section 3).", fig.lp="f:", out.extra="width=\\linewidth"}
contexts <- c(
  `Italian.voiceless` = "Italian (voiceless)",
  `Italian.voiced` = "Italian (voiced)",
  `Polish.voiceless` = "Polish (voiceless)",
  `Polish.voiced` = "Polish (voiced)"
)

lines <- tibble(
  intercept = c(0.65, 0.77, 0.8, 0.8),
  lang_voice = factor(c("Italian.voiceless", "Polish.voiceless", "Italian.voiced", "Polish.voiced"), levels = c("Italian.voiceless", "Italian.voiced", "Polish.voiceless", "Polish.voiced"))
)

wavegam_ar_pred %>%
  ggplot(aes(sequence_prop, sample, z = fit)) +
  geom_raster(aes(fill = fit)) +
  geom_contour(colour = "white", size = 0.1) +
  geom_vline(data = lines, aes(xintercept = intercept), linetype = "dashed", alpha = 0.5) +
  facet_wrap(~ lang_voice, labeller = as_labeller(contexts)) +
  scale_x_continuous(breaks = seq(0, 1, 0.2)) +
  scale_fill_distiller(palette = "RdYlBu") +
  labs(
    x = "Normalised vowel duration",
    y = "Normalised cycle duration",
    fill = "Normalised dEGG\namplitude"
  ) +
  theme(panel.grid = element_blank())
```

The same GAM specification as in the pilot study was used to model changes in glottal activity.
Normalised vowel duration was used instead of glottal cycle index.
\Cref{f:surface} shows the modelled wavegrams of vowels followed by voiceless (left) and voiced stops (right), in Italian (top) and Polish (bottom).
The pilot study showed that a widening of the wavegram dEGG maximum band (red) with concomitant shrinkage of the dEGG minimum band (blue) signals greater glottal opening.
The change in band width corresponds to changes in velocity of the execution of the contacting and decontacting movements.
An interesting aspect of modelled glottal activity concerns the first half of the vowels.
The change in the wavegram indicates a process of decreasing glottal opening (from a breathier to a more modal phonation).
The greater glottal spread observed at vowel onset could be related to the residual glottal spread of the preceding voiceless stop /p/.
This means that the phonation at vowel onset is breathier and becomes more modal during the production of the vowel, stabilising itself at about 20% of the vowel duration.

Focusing now on the second half of the vowel, the wavegrams in \Cref{f:surface} show a pattern that is symmetrical to that observed in the first half.
Namely, glottal opening increases towards the end of the vowel.
The magnitude of the change, however, is greater in vowels followed by voiceless stops (left panels) than those followed by voiced stops.
The earlier and greater glottal spreading in vowels followed by voiceless stops could be implemented in anticipation of the open glottis required in the production of voiceless stops.

The wavegrams of vowels followed by voiceless stops also suggest an effect of language (the GAM terms with a by-language factor return *p*-values below 0.001).
The change in activity before voiceless stops is initiated earlier in Italian (at around 65% into the vowel) than in Polish (at about 80%).
The approximate time of the change onset is represented by the vertical dashed lines in \Cref{f:surface}.
On the other hand, activity in vowels followed by voiced stops is similar in the two languages.

The observed greater increase in glottal opening during the production of vowels followed by voiceless stops in Italian is compatible with the reported presence of pre-aspiration (breathy or voiceless) in Italian geminate stops \citep{stevens2004, stevens2004a, stevens2010, stevens2010b, stevens2014a}.
Increased glottal spreading during vocal fold vibration can be interpreted as a precursor of voiceless pre-aspiration.
An enough opened glottis can generate enough glottal airflow so as to equalise sub-glottal and supra-glottal pressure, at which point vocal fold vibration cannot be supported any longer \citep{berg1958, rothenberg1967, ohala2011}.
The outcome is voiceless glottal frication, or, in other words, voiceless pre-aspiration.

The patterns of glottal spreading observed here fit with proposed mechanisms of emergence and prevention of emergence of (voiceless) pre-aspiration.
<!-- first talk about emergence with subsequent delay of closure and then talk about early closure to prevent preaspiration and how this fits with longer closures of voiceless stops -->
There are, however, varieties of English with pre-aspiration in stops and fricatives \citep{gordeeva2007, nance2013, hejna2015a}.
The question arises as to how glottal spreading in vowels in the context of voiceless stops can lead to the emergence of pre-aspiration in some cases.
One of the common conceptions is that pre-aspiration arises when closure duration decreases while glottal spread remains.
<!-- references in Stevens 2014 -->
\citet{nichasaide1985}, however, claims that the appearance of pre-aspiration (in the form of glottal spread before stop closure) diachronically precedes closure shortening.
\citet{stevens2014} further present experimental evidence from Italian that pre-aspiration and closure shorting are independent.
Moreover, the presence of pre-aspiration increased the total duration of the VC sequence.
It is known that voiceless stops have longer closure durations than voiced stops.
\citet{lisker1974} argues that, in English voiceless stops, closure occurs not long after the spreading gesture is initiated in order to avoid the emergence of full pre-aspiration.

What can be learnt from this is that, once breathiness/pre-aspiration arises, there are two possible scenarios: according to one possible path, as noted by \citet{lisker1974}, pre-aspiration is prevented by achieving stop closure earlier (thus increasing the stop closure duration); according to the other path, pre-aspiration can be enhanced, with subsequent closure shortening, as in the arguments by \citet{nichasaide1985} and \citet{stevens2014}.
