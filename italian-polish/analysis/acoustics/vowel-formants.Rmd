---
title: "Vowel formants and fundamental frequency"
author: "Stefano Coretta"
date: "12/02/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = normalizePath("../../../"))
library(tidyverse)
theme_set(theme_minimal())
library(lme4)
library(effects)
library(sjPlot)
library(coretta2018itapol)
library(mgcv)
data("formants_series")
data("token_measures")
```

# Data import

```{r}
vowels <- formants_series %>%
  select(speaker:f0) %>%
  left_join(y = token_measures %>% select(-time)) %>%
  mutate_if(is.character, as.factor)

f1_dur <- vowels %>%
  filter(time == 5)
```

# Exploration

```{r}
vowels %>%
  filter(language == "Italian") %>%
  ggplot(aes(time, f1, colour = c2_phonation)) +
  geom_smooth(method = "loess") +
  facet_grid(c2_place ~ vowel)
```

```{r}
vowels %>%
  filter(language == "Italian") %>%
  ggplot(aes(time, f2, colour = c2_phonation)) +
  geom_smooth(method = "loess") +
  facet_grid(c2_place ~ vowel)
```

```{r}
formants %>%
  filter(language == "italian") %>%
  ggplot(aes(time, f3, colour = c2_phonation)) +
  geom_smooth() +
  facet_grid(c2_place ~ vowel)
```

```{r}
formants %>%
  filter(language == "italian") %>%
  ggplot(aes(x = time, colour = c2_phonation)) +
  geom_smooth(aes(y = f1)) +
  geom_smooth(aes(y = f2)) +
  facet_grid(c2_place ~ vowel)
```

```{r}
vowels %>%
  filter(language == "polish") %>%
  ggplot(aes(x = time.x, colour = c2_phonation)) +
  geom_smooth(aes(y = f1)) +
  geom_smooth(aes(y = f2)) +
  facet_grid(. ~ vowel)
```

```{r}
for (i in 1:9) {
  print(vowels %>%
  filter(time.x == i, language == "italian", vowel != "u") %>%
  ggplot(aes(f2, f1, colour = c2_phonation)) +
  geom_point() +
  facet_grid(c2_place ~ vowel) +
  scale_x_reverse(lim = c(max(vowels$f2), min(vowels$f2))) +
  scale_y_reverse(lim = c(max(vowels$f1), min(vowels$f1)))
  )
}
```

```{r}
for (i in 1:9) {
  print(formants %>%
  filter(time == i, language == "polish", vowel != "u") %>%
  ggplot(aes(f2, f1, colour = c2_phonation)) +
  geom_point() +
  facet_grid(c2_place ~ vowel) +
  scale_x_reverse(lim = c(max(formants$f2), min(formants$f2))) +
  scale_y_reverse(lim = c(max(formants$f1), min(formants$f1)))
  )
}
```

```{r height-duration}
vowels %>%
  group_by(file, item) %>%
  summarise(
    f1 = mean(f1),
    vowel_duration = mean(vowel_duration)
  ) %>%
  ggplot(aes(f1, vowel_duration)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm")
```

```{r}
f1_dur_lm <- lmer(
  v1_duration ~
    f1 *
    vowel +
    speech_rate_c +
    (1|speaker) +
    (1|item),
  data = f1_dur
)
summary(f1_dur_lm)
```

```{r}
plot(allEffects(f1_dur_lm))
```

```{r}
plot_model(f1_dur_lm, order.terms = 1:6)
```

```{r}
plot_model(f1_dur_lm, type = "pred", terms = c("f1", "vowel"))
```

# Multivariate GAM

```{r f12-gam}
f12_gam <- gam(
  list(
    f1 ~ s(time, by = vowel, k = 5),
    f2 ~ s(time, by = vowel, k = 5)
  ),
  data = vowels,
  family = mvn()
)

summary(f12_gam)
```

